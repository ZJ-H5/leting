"use strict";angular.module("app").directive("appLeftColumn",["cache","server","$state",function(e,t,a){return{restrict:"EA",replace:!0,templateUrl:"view/template/public/leftColumn.html",scope:{data:"="},link:function(e){var a=window.localStorage;t.server().zjprojectprojectListdo({},function(t){!0===t.result?(t.data&&t.data.length>0&&(e.leftdata=t.data,a.getItem("a")||a.setItem("a",e.leftdata[0].id)),e.$apply()):alert(t.message)})}}}]).directive("appLeft",["cache","$http","server","$cookieStore","$state",function(e,t,a,r,o){return{restrict:"EA",replace:!0,templateUrl:"view/template/public/left.html",scope:{data:"="},link:function(e){var t=window.localStorage;a.server().zjprojectprojectListdo({},function(a){!0===a.result?(e.leftdata=a.data,t.getItem("a")||t.setItem("a",e.leftdata[0].id),e.$apply()):alert(a.message)},function(e){}),e.leftClick=function(e){t.setItem("a",e),t.getItem("f")?o.go(t.getItem("f"),{projectid:e}):t.getItem("j")?o.go(t.getItem("j"),{projectid:e}):o.go(t.getItem("b"),{projectid:e})}}}}]).directive("leftSystem",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/leftSystem.html",scope:{data:"="},link:function(e){var a=window.localStorage;t.server().zjprojectprojectListdo({},function(t){!0===t.result?(e.leftdata=t.data,a.getItem("a")||a.setItem("a",e.leftdata[0].id),e.$apply()):alert(t.message)})}}}]).directive("attention",["server",function(e){return{restrict:"E",templateUrl:"view/template/public/attention.html",replace:!0,scope:{params:"@list"},link:function(t){t.params=JSON.parse(t.params),t.useparams=t.params,t.acctionName=!1;var a=function(a,r){e.server().zjsharedtransferconqueryFollowdo({dataId:t.useparams.projectId,userId:t.useparams.createUser},function(e){e.result&&(t.statusId=e.data.id,"1"==e.data.status?t.acctionName=!0:t.acctionName=!1,t.$apply(),r&&a(e.data.id))})};a(),t.acctionClick=function(r){a(),!0===t.acctionName?e.server().zjsharedtransfercondestroydo({id:r},function(e){e.result?t.acctionName=!1:t.acctionName=!0,t.$apply()}):e.server().lgcMainInfosharedtransferconSave(JSON.parse(t.params),function(e){e.result?t.acctionName=!0:t.acctionName=!1,t.$apply()})}}}}]).directive("topInformation",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/topInformation.html",scope:{params:"@listtop"},link:function(e){e.params=JSON.parse(e.params),t.server().zjprojectdeleteById({id:e.params.projectId,userId:e.params.createUser},function(t){!0===t.result&&(e.project2=t.data.project,e.$apply())})}}}]).directive("topPactInformation",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/topPactInformation.html",scope:{params:"@list",pacts:"="},link:function(e){function a(){e.firstParentState=!1,t.server().zjpactinfoaddSavedo({propertyId:e.roomId,createUser:e.createUser},function(t){!0===t.result?(e.Pact=!1,alert(t.message)):(e.Pact=!0,alert(t.message)),e.$apply()})}e.no="暂无数据",e.params=JSON.parse(e.params),t.server().zjroomqueryPropertyDetaileddo({roomId:e.params.roomId},function(t){!0===t.result&&(e.patcData=t.data,e.statusId=e.patcData.id,e.pacts=e.patcData.status,console.log(e.pacts),"2"==e.patcData.status||null===e.patcData.status?e.Pact=!0:e.Pact=!1),e.$apply()}),e.useparams=e.params,e.acctionName=!1;var r=function(a,r){t.server().zjsharedtransferconqueryFollowdo({dataId:e.useparams.projectId,userId:e.useparams.createUser},function(t){t.result&&("1"==t.data.status?e.acctionName=!0:e.acctionName=!1,e.$apply(),r&&a(t.data.id))})};r(),e.acctionClick=function(a){r(),!0===e.acctionName?t.server().zjsharedtransfercondestroydo({id:a},function(t){t.result?e.acctionName=!1:e.acctionName=!0,e.$apply()}):t.server().lgcMainInfosharedtransferconSave(JSON.parse(e.params),function(t){t.result?e.acctionName=!0:e.acctionName=!1,e.$apply()})},e.imgHost=e.useparams.imgHost,e.createUser=e.useparams.createUser,e.roomId=e.useparams.roomId,e.firstParentState=!0,e.doApplyPact=function(){confirm("申请制作合同",function(){e.firstParentState&&a()})}}}}]).directive("rightInformation",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/rightInformation.html",scope:{params:"@listtop"},link:function(e){e.params=JSON.parse(e.params),t.server().zjprojectdeleteById({id:e.params.projectId,userId:e.params.createUser},function(t){!0===t.result&&(e.project2=t.data.project,e.$apply())})}}}]).directive("rightInformationTwo",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/rightInformationTwo.html",scope:{params:"@listtop"},link:function(e){e.params=JSON.parse(e.params),e.useparams=e.params,t.server().zjroomessentialInformationdo({roomId:e.useparams.roomId},function(t){!0===t.result&&(e.room=t.data.room,e.$apply())})}}}]).directive("roomInformation",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/roomInformation.html",scope:{params:"@listtop"},link:function(e){e.no="-",e.params=JSON.parse(e.params),t.server().basicInformation({roomId:e.params.roomId},function(t){!0===t.result?(e.informations=t.data.surveyCount,e.attachment=t.data.attachment,e.$apply()):alert(t.message)})}}}]).directive("roomAttachment",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/roomAttachment.html",scope:{params:"@listtop"},link:function(e){e.no="-",e.params=JSON.parse(e.params),t.server().surveyingList({roomId:e.params.roomId,type:2},function(t){!0===t.result?(e.surveyingList=t.data,e.$apply()):alert(t.message)})}}}]).directive("roomSurveying",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/roomSurveying.html",scope:{params:"@listtop",length:"="},link:function(e){e.no="-",e.params=JSON.parse(e.params),e.imgHost=e.params.imgHost,t.server().basicInformation({roomId:e.params.roomId},function(t){!0===t.result?(e.informations=t.data.surveyCount,e.attachment=t.data.attachment,e.length=e.attachment.length||0,e.$apply()):alert(t.message)})}}}]).directive("addFollow",["cache","server","dict","$http","$rootScope",function(e,t,a,r,o){return{restrict:"E",replace:!0,templateUrl:"view/template/public/addFollow.html",scope:{params:"@listtop",length:"="},link:function(e){function s(){t.server().zjfollowuplistdo({projectId:"1"==e.projectflag?e.useparams.projectId:e.useparams.roomId,type:e.projectflag},function(t){if(!0===t.result){if(t.data.length>0){e.showMes=t.data,e.showMes.sort(function(e,t){return new Date(t.createTime).getTime()-new Date(e.createTime).getTime()});for(var r=0;r<t.data.length;r++)n((new Date).getTime())-n(t.data[r].createTime)<=1?t.data[r].createTime="刚刚":n((new Date).getTime())-n(t.data[r].createTime)<=2?t.data[r].createTime="2分钟前":n((new Date).getTime())-n(t.data[r].createTime)<=3?t.data[r].createTime="3分钟前":t.data[r].createTime=a.timeConverter(t.data[r].createTime);e.$apply()}}else alert(t.message)},function(e){alert(e)})}e.no="-",e.localhostimg=o.localhostimg,e.params=JSON.parse(e.params),e.useparams=e.params,e.imgHost=e.useparams.imgHost,e.projectflag=e.useparams.projectflag,e.headImg=t.server().headImg;var n=function(e){var t=new Date(e),a=["01","02","03","04","05","06","07","08","09","10","11","12"];return t.getFullYear()+a[t.getMonth()]+(t.getDate()<10?"0"+t.getDate():t.getDate())+(t.getHours()<10?"0"+t.getHours():t.getHours())+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())};s(),e.fileArr=[],e.fileNameChanged=function(t){var a=new FormData,o=t.target;if(o.files[0]){var s=o.files[0],n=s.name.slice(s.name.lastIndexOf(".")+1).toUpperCase();if("PNG"!=n&&"JPEG"!=n&&"JPG"!=n)return o.value="",alert("请上传正确格式的图片"),!1;a.append("multipartFile",s),r({method:"POST",url:e.imgHost+"attachment/fielUpload.do",data:a,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(t){o.value="",t.data.result?e.fileArr.push(t.data.data):alert(t.message)}),e.$apply()}},e.fileArrDel=function(t){e.fileArr.splice(t,1)},e.issue=function(a){if(!a)return void alert("描述不能为空！");e.attachments=[],e.fileArr&&e.fileArr.forEach(function(t,a){e.attachments[a]={filePath:e.fileArr[a].filePath,fileName:e.fileArr[a].fileName,size:e.fileArr[a].size}}),t.server().zjfollowupaddSavedo({type:e.projectflag,dataId:"1"==e.projectflag?e.useparams.projectId:e.useparams.roomId,depict:a||"",createUser:e.useparams.createUser,attachment:JSON.stringify(e.attachments)||""},function(t){!0===t.result?(alert("发布成功！"),e.textareaVal="",e.fileArr=[],e.$apply(),s()):alert(t.message)},function(e){alert(e)})},e.delete=function(a,r){t.server().zjfollowupdeleteByIddo({id:a},function(t){!0===t.result?confirm("确认删除这条信息吗？",function(){e.showMes.splice(r,1),e.$apply()}):alert(t.message)},function(e){alert(e)})}}}}]).directive("addFollowAlert",["cache","server","dict","$http","$rootScope",function(e,t,a,r,o){return{restrict:"E",replace:!0,templateUrl:"view/template/public/addFollowAlert.html",scope:{params:"@listtop",length:"=",action:"=",myFollow:"&",myLocation:"&"},link:function(e){e.localhostimg=o.localhostimg,e.no="-",e.params=JSON.parse(e.params),e.useparams=e.params,e.imgHost=e.params.imgHost,e.projectflag=e.useparams.projectflag,"1"==e.projectflag?(e.projectName="项目",e.projectId=e.useparams.projectId):(e.projectName="产品",e.roomId=e.useparams.roomId),e.action.reset=function(t,a){e.genjingId=t,e.genjingtype=a,$(".hopbntfollow").dialog()},e.fileArr=[],e.fileNameChanged=function(t){var a=new FormData,o=t.target;if(o.files[0]){var s=o.files[0],n=s.name.slice(s.name.lastIndexOf(".")+1).toUpperCase();if("PNG"!=n&&"JPEG"!=n&&"JPG"!=n)return o.value="",alert("请上传正确格式的图片"),!1;a.append("multipartFile",s),r({method:"POST",url:e.imgHost+"attachment/fielUpload.do",data:a,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(t){o.value="",t.data.result?e.fileArr.push(t.data.data):alert(t.message)}),console.log(e.fileArr),e.$apply()}},e.fileArrDel=function(t){e.fileArr.splice(t,1)},e.issue=function(a,r){if(!e.followinfo)return void alert("描述不能为空！");a?e.projectflag=2:a=e.useparams.projectId,e.projectflag=r?1:2,e.attachments=[],e.fileArr&&e.fileArr.forEach(function(t,a){e.attachments[a]={filePath:e.fileArr[a].filePath,fileName:e.fileArr[a].fileName,size:e.fileArr[a].size}}),t.server().zjfollowupaddSavedo({type:e.projectflag,dataId:a,depict:e.followinfo||"",createUser:e.useparams.createUser,attachment:JSON.stringify(e.attachments)||""},function(t){!0===t.result?confirm("发布成功！",function(){$(".hopbntfollow").fadeOut(200),e.textareaVal="",e.fileArr=[],e.followinfo="","1"==e.useparams.locationflag&&e.myLocation(),"1"==e.useparams.reloadajax&&e.myFollow(),e.$apply()}):alert(t.message)},function(e){alert(e)})}}}}]).directive("ownerShow",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/ownerShow.html",scope:{params:"@listtop",length:"="},link:function(e){function a(e,t){var a={title:{text:""},tooltip:{},animationDurationUpdate:1500,animationEasingUpdate:"quinticInOut",label:{normal:{show:!0,textStyle:{fontSize:12}}},legend:{x:"center",show:!1,data:["家人","朋友","亲戚"]},series:[{type:"graph",layout:"force",symbolSize:50,focusNodeAdjacency:!0,roam:!0,categories:[{name:"家人",itemStyle:{normal:{color:"#009800"}}},{name:"朋友",itemStyle:{normal:{color:"#4592FF"}}},{name:"亲戚",itemStyle:{normal:{color:"#3592F"}}}],label:{normal:{show:!0,textStyle:{fontSize:14}}},force:{repulsion:1e3},edgeSymbolSize:[4,50],edgeLabel:{normal:{show:!0,textStyle:{fontSize:12},formatter:"{c}"}},data:e,links:t,lineStyle:{normal:{opacity:.9,width:1,curveness:0}}}]};r.setOption(a)}e.no="-",e.params=JSON.parse(e.params),e.imgHost=e.params.imgHost,e.useparams=e.useparams,e.projectId=e.params.projectId,e.roomId=e.params.roomId,e.uhshifts={relationShip:"业权人",relationPersion:""},t.server().zjownershipqueryOwnerAndRecievedo({holderId:e.roomId},function(t){if(!0===t.result){if(t.data){e.data=t.data,e.data&&e.data.forEach(function(t,a){switch(e.data[a].isType=e.data[a].recieveType,e.data[a].recieveType){case 1:e.data[a].recieveType="业权人收款";break;case 2:e.data[a].recieveType="其他人代收款";break;case 3:e.data[a].recieveType="未满18岁监护人待收款";break;case 4:e.data[a].recieveType="关联其他业权人收款"}});for(var a=0;a<t.data.length;a++)e.data[a].indx=a;e.$apply()}}else alert(t.message)}),e.editInformation=function(r,o){e.usedata=[],e.links=[],t.server().zjownershipqueryOwnerRelationShipdo({id:r},function(t){if(!0===t.result){e.relationdata=t.data,e.relation=t.data.relation,e.uhshifts.relationPersion=e.relationdata.holderName,e.relation.unshift(e.uhshifts);for(var r=0;r<e.relation.length;r++)e.usedata[r]={name:e.relation[r].relationPersion,category:0===r?0:1,draggable:!0},e.links[r]={source:0,target:r+1,category:0,value:e.relation[r].relationShip};a(e.usedata,e.links)}else alert(t.message)})},e.makecoll=function(r,o){e.usedata=[],e.links=[],t.server().zjmakecollectionsqueryRelationShipdo({id:r},function(t){if(!0===t.result){e.relationdata=t.data,e.relation=t.data.relation,e.uhshifts.relationPersion=e.relationdata.holderName,e.relation.unshift(e.uhshifts);for(var r=0;r<e.relation.length;r++)e.usedata[r]={name:e.relation[r].relationPersion,category:0===r?0:1,draggable:!0},e.links[r]={source:0,target:r+1,category:0,value:e.relation[r].relationShip};a(e.usedata,e.links)}else alert(t.message)})};var r=echarts.init(document.getElementById("main"))}}}]).directive("compensateShow",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/compensateShow.html",scope:{params:"@listtop",length:"="},link:function(e){e.no="-",e.params=JSON.parse(e.params),e.imgHost=e.params.imgHost,t.server().zjbuiltinfogetCompensatePlando({propertyId:e.params.roomId},function(t){!0===t.result&&t.data.length>0?(e.topData=t.data,e.$apply()):alert(t.message)})}}}]).directive("enclosureShow",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/enclosureShow.html",scope:{params:"@listtop",length:"="},link:function(e){e.no="-",e.params=JSON.parse(e.params),e.imgHost=e.params.imgHost,e.useparams=e.params;Promise.all([function(){return new Promise(function(a,r){t.server().enclorurelist({propertyId:e.useparams.roomId},function(t){!0===t.result&&t.data?(a(t.data),e.$apply()):alert(t.message)})})}()]).then(function(t){e.total=0,e.list=t[0],e.list.forEach(function(t,a){e.total+=e.list[a].propertyAttachments.length}),e.$apply()},function(e){}),e.DownSave=function(a){var r=t.server().host,o=r+"propertyAttachment/attachmentDownload.do";e.link=o+"?id="+a}}}}]).directive("examineShow",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/examineShow.html",scope:{params:"@listtop"},link:function(e){e.no="-",e.params=JSON.parse(e.params),e.useparams=e.params,e.hostname=e.useparams.imgHost,t.server().surveyingInformationById({roomId:e.useparams.roomId},function(t){!0===t.result?(e.surveyInfo=t.data,e.singleList=t.data.singleList,e.surveyList=t.data.surveyList,e.housesImg=t.data.housesImg,e.$apply()):alert(t.message)})}}}]).directive("examineImgShow",["cache","server",function(e,t){return{restrict:"E",replace:!0,templateUrl:"view/template/public/examineImgShow.html",scope:{params:"@listtop"},link:function(e){e.no="-",e.params=JSON.parse(e.params),e.useparams=e.params,e.hostname=e.params.imgHost,t.server().surveyingInformationById({roomId:e.useparams.roomId},function(t){!0===t.result?(e.housesImg=t.data.housesImg,e.$apply()):alert(t.message)})}}}]).directive("follow",["cache","server","$state","$http","$sce",function(e,t,a,r,o){return{restrict:"E",replace:!0,templateUrl:"view/template/public/follow.html",scope:{params:"@listtop",action:"=",myFollow:"&",myLocation:"&"},controller:function(e){},link:function(e){function a(t,a,o,s,n){a.append("multipartFile",o),r({method:"POST",url:e.imgHost+"attachment/fielUpload.do",data:a,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(a){t.value="",a.data.result?(a.data.data.flag=s,a.data.data.type=n,e.fileArr.unshift(a.data.data)):alert(a.message)}),e.$apply()}if(e.no="-",e.useparams=JSON.parse(e.params),e.imgHost=e.useparams.imgHost,e.flag=!1,e.projectflag=e.useparams.projectflag,e.userId=t.server().userId,e.myMobFlag=e.useparams.myMobFlag,e.add={peopel:"",peopelproject:""},e.addflag={peopel:!1,peopelproject:!1},e.myMobFlag){var s=function(a){return e.dimArr=[],new Promise(function(r,o){t.server().zjtaskqueryRoomNamedo2({userId:e.userId,param:a,projectId:e.projectuserId},function(t){t.result?(e.dimArr=t.data,r(t.data),e.$apply()):alert(t.message)})})},n=function(a){return e.personarr=[],new Promise(function(r,o){t.server().zjtaskqueryUserNamedo({projectId:e.projectId,realname:a},function(t){t.result?(e.personarr=t.data,r(t.data),e.$apply()):alert(t.message)})})};e.addfocus=function(t,a){a?n(t).then(function(t){t.length>0?e.personarrFlag=!0:e.personarrFlag=!1,e.addflag.person=!1,e.$apply()}):(s(t).then(function(t){t.length>0?e.dimArrFlag=!0:e.dimArrFlag=!1,e.addflag.peopel=!1,e.$apply()}),e.addflag.peopel=!1)},e.addblur=function(t,a){a?setTimeout(function(){e.personarrFlag=!1,e.add.person?e.addflag.person=!1:e.addflag.person=!0,e.$apply()},200):setTimeout(function(){e.dimArrFlag=!1,e.add.peopel?e.addflag.peopel=!1:e.addflag.peopel=!0,e.$apply()},200)},e.addchange=function(t,a){console.log(t),a?(n(t).then(function(t){t.length>0?e.personarrFlag=!0:e.personarrFlag=!1,e.$apply()}),e.addflag.person=!1):(s(t).then(function(t){t.length>0?e.dimArrFlag=!0:e.dimArrFlag=!1,e.$apply()}),e.addflag.peopel=!1)},e.alertliAdd=function(t,a){a?(e.add.person=e.personarr[t].realname,e.personArr=e.personarr[t].id):(e.add.peopel=e.dimArr[t].splitJointName,e.peopelArr=e.dimArr[t].id)},e.addfocusproject=function(a){a||(e.projectuserId=null),t.server().zjprojectprojectVaguedo({searchKeys:a},function(t){t.result?(e.dimArrproject=t.data,e.$apply()):alert(t.message)})},e.addchangeproject=function(a){a||(e.projectuserId=null),t.server().zjprojectprojectVaguedo({searchKeys:a},function(t){t.result?(e.dimArrproject=t.data,e.$apply()):alert(t.message)})},e.addblurproject=function(t){setTimeout(function(){e.dimArrproject=[],e.$apply()},200)},e.alertliAddproject=function(t){e.projectuserId=e.dimArrproject[t].id,e.add.peopelproject=e.dimArrproject[t].projectName}}e.action.reset=function(a){e.genjingId=a,t.server().signListProblem({},function(t){t.result?(e.signListP=t.data,e.flag=!1,e.$apply()):alert(t.message)}),t.server().zjsettingsquerySettingsTypedo({type:e.useparams.questiontype},function(t){t.result?(e.questionArr=t.data,e.flag=!1,e.$apply()):alert(t.message)}),$(".hopbntshare2").dialog()},e.myFunc=function(t,a){e.listSecondP=[];for(var r=0;r<e.signListP.length;r++)e.signListP[r].id==e.myselect&&e.listSecondP.push(e.signListP[r].stage);"[]"!=JSON.stringify(e.listSecondP[0])&&(e.flag=!0)},e.fileArr=[],e.fileNameChanged=function(e,t){var r=new FormData,o=e.target;if(o.files[0]){var s=o.files[0],n=s.name.slice(s.name.lastIndexOf(".")+1).toUpperCase();if("photos"==t){if("PNG"!=n&&"JPEG"!=n&&"JPG"!=n)return o.value="",alert("请上传正确的图片格式"),!1;a(o,r,s,t,1)}else if("video"==t){if("MP4"!=n&&"MPEG"!=n&&"MPG"!=n)return o.value="",alert("请上传 .mp4 .mpeg .mpg格式的视频"),!1;a(o,r,s,t,2)}}},e.trustSrc=function(t){return o.trustAsResourceUrl(e.imgHost+t)},e.playauto=function(t){e.playurl=t,$(".other").dialog(),console.log($("#otherplay"))},e.stopplay=function(){},e.fileArrDel=function(t){e.fileArr.splice(t,1)},e.advice="",e.depict="",e.solution="",e.addInformation=function(a){a||(a=e.useparams.projectId),e.myMobFlag&&(a=e.peopelArr),e.attachments=[],e.fileArr&&e.fileArr.forEach(function(t,a){e.attachments[a]={filePath:e.fileArr[a].filePath,fileName:e.fileArr[a].fileName,size:e.fileArr[a].size,type:e.fileArr[a].type}}),t.server().addInformation({typeValue:e.projectflag,dataId:a,orderSignType:e.myselect,orderSignName:e.myselect2,settingsId:e.question,advice:e.advice,depict:e.depict,solution:e.solution,attachments:JSON.stringify(e.attachments)||"",createUser:e.useparams.createUser},function(t){!0===t.result?($(".hopbntshare2").fadeOut(200),alert("发布成功",function(){e.advice="",e.depict="",e.solution="",e.questionArr=[],e.signListP=[],e.fileArr=[],e.add.peopelproject="",e.add.peopel="",e.dimArrproject=[],e.personarr=[],"1"==e.useparams.locationflag&&e.myLocation(),"1"==e.useparams.reloadajax&&e.myFollow()}),e.$apply()):alert(t.message)})}}}}]).directive("followPage",["cache","server","$state","$http","$sce",function(e,t,a,r,o){return{restrict:"E",replace:!0,templateUrl:"view/template/public/followPage.html",scope:{params:"@listtop",action:"=",myFollow:"&",myLocation:"&"},link:function(e){function a(t,a,o,s,n){a.append("multipartFile",o),r({method:"POST",url:e.imgHost+"attachment/fielUpload.do",data:a,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(a){t.value="",a.data.result?(a.data.data.flag=s,a.data.data.type=n,e.fileArr.unshift(a.data.data)):alert(a.message)}),e.$apply()}e.no="-",e.useparams=JSON.parse(e.params),e.imgHost=e.useparams.imgHost,e.flag=!1,e.projectflag=e.useparams.projectflag,e.roomId=e.useparams.roomId,e.genjingId=e.useparams.roomId,t.server().zjsettingsquerySettingsTypedo({type:e.useparams.questiontype},function(t){t.result?(e.questionArr=t.data,e.flag=!1,e.$apply()):alert(t.message)}),t.server().signListProblem({},function(t){t.result?(e.signListP=t.data,e.flag=!1,e.$apply()):alert(t.message)}),e.myFunc=function(){e.listSecondP=[];for(var t=0;t<e.signListP.length;t++)e.signListP[t].id==e.myselect&&e.listSecondP.push(e.signListP[t].stage);"[]"!=JSON.stringify(e.listSecondP[0])&&(e.flag=!0)},e.fileArr=[],e.fileNameChanged=function(e,t){var r=new FormData,o=e.target;if(o.files[0]){var s=o.files[0],n=s.name.slice(s.name.lastIndexOf(".")+1).toUpperCase();if("photos"==t){if("PNG"!=n&&"JPEG"!=n&&"JPG"!=n)return o.value="",alert("请上传正确的图片格式"),!1;a(o,r,s,t,1)}else if("video"==t){if("MP4"!=n&&"MPEG"!=n&&"MPG"!=n)return o.value="",alert("请上传 .mp4 .mpeg .mpg格式的视频"),!1;a(o,r,s,t,2)}}},e.trustSrc=function(t){return o.trustAsResourceUrl(e.imgHost+t)},e.playauto=function(t){e.playurl=t,$(".other").dialog(),console.log($("#otherplay"))},e.stopplay=function(){},e.fileArrDel=function(t){e.fileArr.splice(t,1)},e.advice="",e.depict="",e.solution="",e.addInformation=function(a){e.attachments=[],e.fileArr&&e.fileArr.forEach(function(t,a){e.attachments[a]={filePath:e.fileArr[a].filePath,fileName:e.fileArr[a].fileName,size:e.fileArr[a].size,type:e.fileArr[a].type}}),t.server().addInformation({typeValue:e.projectflag,dataId:e.roomId,orderSignType:e.myselect,orderSignName:e.myselect2,settingsId:e.question,advice:e.advice,depict:e.depict,solution:e.solution,attachments:JSON.stringify(e.attachments)||"",createUser:e.useparams.createUser},function(t){!0===t.result?($(".hopbntshare2").fadeOut(200),alert("发布成功",function(){e.advice="",e.depict="",e.solution="",e.question="",e.myselect="",e.myselect2="",e.fileArr=[],"1"==e.useparams.locationflag&&e.myLocation(),"1"==e.useparams.reloadajax&&e.myFollow()}),e.$apply()):alert(t.message)})}}}}]).directive("followShow",["cache","server","$state","$http",function(e,t,a,r){return{restrict:"E",replace:!0,templateUrl:"view/template/public/followShow.html",scope:{params:"@listtop",action:"=",myFollow:"&",myLocation:"&"},link:function(e){function a(){t.server().informationDetail({typeValue:2,dataId:roomId},function(t){!0===t.result&&(e.data=t.data,e.$apply())},function(){})}e.no="-",e.useparams=JSON.parse(e.params),e.imgHost=e.useparams.imgHost,e.flag=!1,e.projectflag=e.useparams.projectflag,e.roomId=e.useparams.roomId,e.genjingId=e.useparams.roomId,a(),e.daletetrack=function(e){var r=e;console.log(r),confirm("确认删除这条追踪信息?",function(){t.server().deltranckinfo({id:r,userId:createUser},function(e){alert(e.message,function(){a(),$(".delbox").addClass("disnone")})})})}}}}]).directive("transfer",["cache","server","$state","$http",function(e,t,a,r){return{restrict:"E",replace:!0,templateUrl:"view/template/public/transfer.html",scope:{params:"@listtop",transferclick:"=",myFollow:"&",myLocation:"&"},link:function(e){function a(e,t){}function r(r){t.server().initrolelist({searchKeys:e.searchKeys||"",pageNo:e.conf_1.currentPage||"1",pageSize:e.conf_1.itemPageLimit},function(t){if(!0===t.result){e.rolelist=t.data.rows;for(var o=0;o<e.rolelist.length;o++)for(var s=0;s<e.userJson.length;s++)e.rolelist[o].id===e.userJson[s]&&(e.rolelist[o].isFlag=!0);a(r||e.projectId,e.rolelist),e.total=t.data.total,e.conf_1.total=t.data.pageCount,e.conf_1.counts=t.data.total,e.$broadcast("categoryLoaded"),e.$apply()}else alert(t.message)},function(e){})}e.no="-",e.useparams=JSON.parse(e.params),e.imgHost=e.useparams.imgHost,e.createUser=e.useparams.createUser,e.projectId=e.useparams.projectId,e.conf_1={total:6,currentPage:1,itemPageLimit:6,isSelectPage:!0,isLinkPage:!1},e.seach=function(){r(e.projectId)},e.$watch("conf_1.currentPage + conf_1.itemPageLimit+searchKeys",function(t){r(e.projectId)}),e.typeFlag=!0,e.userJson=[],e.transferclick.reset=function(t,a){$(".hchakantwo").dialog(),e.typeFlag=t;for(var o in e.rolelist)e.rolelist[o].isFlag=!1;if(e.userJson=[],a){e.rows=a;var s=!0,n=!1,i=void 0;try{for(var l,c=e.rows[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var p=l.value;p.status_1&&(e.projectId=p.id)}}catch(e){n=!0,i=e}finally{try{!s&&c.return&&c.return()}finally{if(n)throw i}}}r(e.projectId)},e.addrole=function(t,a){var r=e.rolelist[t].isFlag;console.log(e.rolelist),e.rolelist[t].isFlag=!r,e.rolelist[t].isFlag?e.userJson.push(a):e.userJson.splice(t,1)},e.addAllotRole=function(a,r){if(r){var o=!0,s=!1,n=void 0;try{for(var i,l=r[Symbol.iterator]();!(o=(i=l.next()).done);o=!0){var c=i.value;c.status_1&&(e.projectId=c.id)}}catch(e){s=!0,n=e}finally{try{!o&&l.return&&l.return()}finally{if(s)throw n}}}return e.projectId?0==e.userJson.length?void alert("请选择角色"):void(a?(e.userJson?e.userJson:alert("请选择要转移的角色"),t.server().zjsharedtransferaddTransferdo({userId:e.userJson.join(","),projectId:e.projectId,createUser:e.createUser},function(t){!0===t.result?(e.userJson=[],$(".hchakantwo").fadeOut(200),alert("转移成功")):alert(t.message)})):(e.userJson?e.userJson:alert("请选择要共享的角色"),t.server().zjsharedtransferaddShareddo({userIdJson:e.userJson.join(","),projectId:e.projectId,createUser:e.createUser},function(t){!0===t.result?($(".hchakantwo").fadeOut(200),e.userJson=[],alert("共享成功")):alert(t.message)}))):void alert("没有找到对应的项目")}}}}]).directive("gezhong",["cache","server","$state","$http",function(e,t,a,r){return{restrict:"E",replace:!0,templateUrl:"view/template/public/transfer.html",scope:{params:"@listtop",transferclick:"=",myFollow:"&",myLocation:"&"},link:function(e){function a(a){t.server().initrolelist({searchKeys:e.searchKeys,pageNo:e.conf_1.currentPage,pageSize:e.conf_1.itemPageLimit},function(t){!0===t.result?(e.rolelist=t.data.rows,e.total=t.data.total,e.conf_1.total=t.data.pageCount,e.conf_1.counts=t.data.total,e.$apply(),e.$broadcast("categoryLoaded2")):alert(t.message)})}e.no="-",e.useparams=JSON.parse(e.params),e.imgHost=e.useparams.imgHost,e.createUser=e.useparams.createUser,e.projectId=e.useparams.projectId,e.conf_1={total:6,currentPage:1,itemPageLimit:6,isSelectPage:!0,isLinkPage:!1},e.seach=function(){a(e.projectId)},e.$watch("conf_1.currentPage + conf_1.itemPageLimit+searchKeys",function(t){a(e.searchKeys)})}}}]).directive("applypact",["cache","server","$state","$http","$rootScope",function(e,t,a,r,o){return{restrict:"E",replace:!0,templateUrl:"view/template/public/applypact.html",scope:{params:"@list"},link:function(e){function a(){t.server().zjpactinfoaddSavedo({propertyId:e.roomId,createUser:e.createUser},function(t){!0===t.result?(e.Pact=!1,alert(t.message)):(e.Pact=!0,alert(t.message)),e.$apply()})}e.useparams=JSON.parse(e.params),e.imgHost=e.useparams.imgHost,e.createUser=e.useparams.createUser,e.roomId=e.useparams.roomId,"0"==o.sbstauts?e.Pact=!0:e.Pact=!1,e.doApplyPact=function(){confirm("申请制作合同",function(){a()})}}}}]).directive("deleteProject",["cache","server","$state","$http",function(e,t,a,r){return{restrict:"E",replace:!0,templateUrl:"view/template/public/deleteProject.html",scope:{params:"@list"},link:function(e){e.useparams=JSON.parse(e.params),e.imgHost=e.useparams.imgHost,e.createUser=e.useparams.createUser,e.projectId=e.useparams.projectId,e.flag=!0,e.deleteProject=function(r){confirm("确认删除项目?",function(){t.server().delProject({userId:e.createUser,projectId:e.projectId},function(t){!0===t.result?(alert("项目已提交至审核",function(){e.flag=!1,a.go("projectmanagement")}),e.$apply()):(e.flag=!0,alert(t.message))})})}}}}]);