"use strict";angular.module("app").controller("annexCtrl",["$http","$rootScope","$scope","dict","server","$state",function(e,t,a,r,s,i){function d(){s.server().filelist({projectId:o},function(e){!0===e.result?(a.data=e.data,a.length=e.data.length,console.log(a.data),a.$apply()):alert(e.message)},function(e){})}function n(t,r){var i=new FormData;a.filename=t.name,i.append("multipartFile",t),e({method:"POST",url:a.hostname+"attachment/fielUpload.do",data:i,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){a.data=e.data.data,a.fileName=a.data.fileName,a.filePath=a.data.filePath,a.size=a.data.size,s.server().savefile({fileName:a.fileName,fileUrl:a.filePath,fileSize:a.size,dataId:o,createUser:l},function(e){!0===e.result?(d(),a.count++,a.count==r&&alert(e.message),a.$apply()):alert(e.message)},function(e){})})}a.projectId=i.params.projectid;var o=a.projectId,l=s.server().userId;s.server().userId;a.hostname=s.server().imgHost,a.list={projectId:i.params.projectid,createUser:s.server().userId,toUserId:s.server().userId,type:3,status:1},a.listtop={roomId:i.params.projectid,projectId:i.params.projectid,paciId:a.pactId,createUser:s.server().userId,imgHost:s.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},d(),a.addannex=function(e){a.count=0;for(var t=0;t<e.length;t++)n(e[t],e.length)},a.downloadprojectfile=function(e){var t=a.hostname+"attachment/fileDownload.do";a.link=t+"?id="+e},a.deletefifle=function(e){console.log(e),s.server().deletefifle({id:e},function(e){!0===e.result?(alert(e.message,function(){d()}),a.$apply()):alert(e.message)},function(e){})}}]).controller("compensationRulesCtrl",["$http","$scope","server","dict",function(e,t,a,r){var s="261e554de2f3493ebed1e4b6567818d1",i=a.server().userId,d=a.server().userId;t.flagc=!0,t.flagp=!0,t.whetherOrNot=!0,a.server().compensationlist({projectId:s},function(e){!0===e.result?(t.data=e.data,t.$apply()):alert(e.message)},function(e){}),t.add=function(e,a){t.name=e,t.id=a},a.server().ruleslist({},function(e){!0===e.result?(t.compensateType=e.data.compensateType,t.compensate=e.data.compensateProject,t.rebuildTypes=e.data.rebuildTypes,t.$apply()):alert(e.message)},function(e){}),t.projectselect=function(e){a.server().projectlist({parentId:e},function(e){!0===e.result?(t.sublevel=e.data,t.whetherOrNot=0,t.$apply()):alert(e.message)},function(e){})},t.whether=function(e){for(var a=0;a<t.sublevel.length;a++)e==t.sublevel[a].id&&(t.whetherOrNot=t.sublevel[a].whetherOrNot)},t.mianflag=!0,t.addbuilding=function(e,r,s,d){a.server().addbuild({typeId:t.id,type:0,compensationId:t.typeid,childId:t.projectid,rank:s,rankRemaker:d,replacementRatio:e,buildType:t.buildid,pricesMode:null,compensationPrice:null,remaker:r,createUser:i,compensateProjectId:null},function(e){!0===e.result?(alert(e.message),t.mianflag=!1,t.rank="",t.rankRemaker="",t.replacementRatio="",t.remaker="",window.location.reload(),t.$apply()):(t.rank="",t.rankRemaker="",t.replacementRatio="",t.remaker="",alert(e.message))},function(e){}),t.rank="",t.rankremaker="",t.replacementratio="",t.remaker="",t.typeid="",t.projectid="",t.buildid=""},t.addTypeName=function(e){a.server().addtype({projectId:s,createUser:i,name:e},function(e){!0===e.result?(alert(e.message),t.$apply()):alert(e.message)},function(e){})},t.pricetype=1,t.ok=function(){console.log(t.pricetype)},t.compensatesel=function(e){a.server().projectlist({parentId:e},function(e){!0===e.result?t.$apply():alert(e.message)},function(e){})},t.savepricelist=function(e,r,s){a.server().addbuild({typeId:t.id,type:1,compensationId:t.typeid,childId:t.projectid,rank:t.rank,rankRemaker:t.rankremaker,replacementRatio:null,buildType:null,pricesMode:t.pricetype,compensationPrice:e,remaker:r,createUser:i,compensateProjectId:t.compensateid},function(e){!0===e.result?(alert(e.message),t.mianflag=!1,window.location.reload(),t.$apply()):(t.rank="",t.rankRemaker="",t.replacementRatio="",t.remaker="",alert(e.message))},function(e){}),t.rank="",t.rankremaker="",t.replacementratio="",t.remaker="",t.typeid="",t.projectid="",t.buildid=""},t.checkinfo=function(e,r,s,i){$("."+e).dialog(),t.name=r,t.id=s,console.log(i),a.server().checkinfolist({id:i},function(e){console.log(e),!0===e.result?(t.data=e.data,console.log(e.data),t.remaker=e.data.remaker?e.data.remaker:"",t.compensationPrice=e.data.compensationPrice,t.$apply()):alert(e.message)},function(e){})},t.editinfo=function(e,r,s,i,d){t.rid=i,t.typeid=d,0==e?($(".hopruleopenedit").dialog(),t.id=s,a.server().editinfobuild({id:i},function(e){if(!0===e.result){console.log(e.data.rulesMap),t.builddata=e.data.rulesMap,t.rebuildTypes=e.data.rebuildTypes,t.typeid=t.builddata.compensationId,t.comid=t.builddata.compensateProjectId;for(var r=0;r<t.compensateType.length;r++)t.builddata.compensationId==t.compensateType[r].id&&(t.cname=t.compensateType[r].compensateName);a.server().projectlist({parentId:t.builddata.compensationId},function(e){if(!0===e.result){t.sublevel=e.data;for(var a=0;a<t.sublevel.length;a++)t.builddata.childId==t.sublevel[a].id&&(t.sublevelcompensatename=t.sublevel[a].sublevelCompensateName);t.$apply()}else alert(e.message)},function(e){});for(var r=0;r<t.rebuildTypes.length;r++)t.builddata.buildType==t.rebuildTypes[r].id&&(t.rebuildtype=t.rebuildTypes[r].shemaName,console.log(t.rebuildtype));t.$apply()}else alert(e.message)},function(e){})):($(".hopbntshareedit").dialog(),t.name=r,t.id=s,a.server().editinfoprice({id:i},function(e){if(!0===e.result){t.pricedata=e.data.rulesMap,t.comid=t.pricedata.compensateProjectId,t.compensateProject=e.data.compensateProject,console.log(t.compensateProject),t.compensateType=e.data.compensateType,t.compensateProjectId=t.pricedata.compensateProjectId,t.typeid=t.pricedata.compensationId,t.buildid=t.pricedata.buildType;for(var r=0;r<t.compensateProject.length;r++)t.compensateProjectId==t.compensateProject[r].id&&(t.pName=t.compensateProject[r].compensateName,console.log(t.pName));for(var r=0;r<t.compensateType.length;r++)t.pricedata.compensationId==t.compensateType[r].id&&(t.cname=t.compensateType[r].compensateName);a.server().projectlist({parentId:t.pricedata.compensationId},function(e){if(!0===e.result){t.sublevel=e.data;for(var a=0;a<t.sublevel.length;a++)t.pricedata.childId==t.sublevel[a].id&&(t.sublevelcompensatename=t.sublevel[a].sublevelCompensateName);t.$apply()}else alert(e.message)},function(e){}),t.$apply()}else alert(e.message)},function(e){}))},t.updatepricelist=function(e,r,s,n){console.log(t.comid),a.server().updatepricelist({id:t.rid,typeId:t.id,type:1,compensationId:t.typeid,childId:t.sid,rank:s||null,rankRemaker:n,replacementRatio:null,buildType:null,pricesMode:t.pricetype,compensationPrice:e,remaker:r||null,createUser:i,compensateProjectId:t.comid,updateUser:d},function(e){!0===e.result?(alert(e.message),t.mianflag=!1,t.$apply()):(t.rank="",t.rankRemaker="",t.replacementRatio="",t.remaker="",alert(e.message))},function(e){}),t.rank="",t.rankremaker="",t.replacementratio="",t.remaker="",t.typeid="",t.projectid="",t.buildid="",t.comid=""},t.updatabuild=function(e,r,s,i){console.log(t.typeid),console.log(t.builddata.replacementRatio),a.server().updatepricelist({id:t.rid,typeId:t.id,type:0,compensationId:t.typeid,childId:t.sid,rank:s,rankRemaker:i,replacementRatio:e,buildType:t.buildid,pricesMode:null,compensationPrice:null,remaker:r,updateUser:d,compensateProjectId:null},function(e){!0===e.result?(alert(e.message),t.mianflag=!1,t.$apply()):(t.rank="",t.rankRemaker="",t.replacementRatio="",t.remaker="",alert(e.message))},function(e){}),t.rank="",t.rankremaker="",t.replacementratio="",t.remaker="",t.typeid="",t.projectid="",t.buildid=""},t.deleteinfo=function(e){confirm("确认删除该条信息",function(){a.server().deletecom({id:e,userId:i},function(e){!0===e.result?(alert("删除成功"),t.$apply()):alert(e.message)},function(e){})}),console.log(e)}}]).controller("projectcompensationRulesCtrl",["$http","$scope","server","$state","dict","$location","$rootScope",function(e,t,a,r,s,i,d){function n(){t.typeid="",t.sid="",t.rank="",t.rankremaker="",t.replacementratio="",t.buildid="",t.remaker="",t.compensateid="",t.priceType=1,t.price="",t.compensateid="",t.status=!1,t.restrictedArea="",t.whetherOrNot=0,t.isRestricted=1,t.updateRestrictedArea="",$(".saveDisabled").removeAttr("disabled")}function o(){a.server().compensationlist({projectId:l},function(e){console.log(e),!0===e.result?(t.dataInfo=e.data,t.dataInfo.forEach(function(e,a){t.dataInfo[a].flag=a}),t.$apply()):alert(e.message)},function(e){})}t.projectId=r.params.projectid;var l=t.projectId,c=a.server().userId,p=a.server().userId;t.flagc=!0,t.flagp=!0,t.whetherOrNot=0,t.status=!1,t.isRestricted=1;a.server().userId;t.list={projectId:r.params.projectid,createUser:a.server().userId,toUserId:a.server().userId,type:3,status:1},t.listtop={roomId:r.params.projectid,projectId:r.params.projectid,paciId:t.pactId,createUser:a.server().userId,imgHost:a.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},t.cancel=function(){n()},t.editRule=function(e,a,r){$("."+e).dialog(),t.ruleName=a,t.ruleId=r},t.editRuleName=function(e){a.server().ruleNameUpdate({name:t.ruleName,id:e,updateUser:p,projectId:l},function(e){!0===e.result?(alert(e.message,function(){o()}),t.$apply()):alert(e.message)},function(e){})},t.releteRule=function(e,r){confirm("确定删除"+e+"?",function(){a.server().ruleDelete({id:r,userId:c},function(e){console.log(e),!0===e.result?(alert(e.message,function(){o()}),t.$apply()):alert(e.message)},function(e){})})},o(),t.add=function(e,a,r){$("."+e).dialog(),t.leixingname=a,t.id=r},a.server().ruleslist({},function(e){!0===e.result?(t.compensateType=e.data.compensateType,t.compensate=e.data.compensateProject,t.rebuildTypes=e.data.rebuildTypes,t.$apply()):alert(e.message)},function(e){}),t.compensateSelect=function(e){t.compensate.forEach(function(a,r){a.id==e&&(1==a.status?t.status=!0:(t.status=!1,t.updateRestrictedArea="",t.restrictedArea="",t.isRestricted=""))})},t.projectselect=function(e){a.server().projectlist({parentId:e},function(e){!0===e.result?(t.sublevel=e.data,t.whetherOrNot=0,t.$apply()):alert(e.message)},function(e){})},t.whether=function(e){for(var a=0;a<t.sublevel.length;a++)e==t.sublevel[a].id&&(t.whetherOrNot=t.sublevel[a].whetherOrNot)},t.mianflag=!0,t.addbuilding=function(e,r,s,i){$(".saveDisabled").attr("disabled","disabled"),a.server().addbuild({typeId:t.id,type:0,compensationId:t.typeid,childId:t.sid,rank:s,rankRemaker:i,replacementRatio:e,buildType:t.buildid,pricesMode:null,compensationPrice:null,remaker:r,createUser:c,compensateProjectId:null},function(e){!0===e.result?(alert(e.message),$(".hopaddruleopen").fadeOut(300),$("body").css({overflow:"auto","padding-right":0}),$(".hopmainopen").hide(),$(".saveDisabled").removeAttr("disabled"),n(),t.$apply(),o()):alert(e.message,function(){n(),$(".saveDisabled").removeAttr("disabled"),t.$apply()})},function(e){alert(data.message,function(){n(),$(".saveDisabled").removeAttr("disabled"),t.$apply()})})},t.addTypeName=function(e){a.server().addtype({projectId:l,createUser:c,name:e},function(e){!0===e.result?(alert(e.message),t.typeName="",o(),t.$apply()):alert(e.message)},function(e){})},t.priceType=1,t.compensatesel=function(e){a.server().projectlist({parentId:e},function(e){!0===e.result?t.$apply():alert(e.message)},function(e){})},t.rank="",t.rankremaker="",t.savepricelist=function(e,r,s,i){$(".saveDisabled").attr("disabled","disabled"),0==t.isRestricted&&(t.restrictedArea=""),a.server().addbuild({typeId:t.id,type:1,compensationId:t.typeid,childId:t.sid,rank:s,rankRemaker:i,replacementRatio:null,buildType:null,pricesMode:t.priceType,compensationPrice:e,remaker:r,createUser:c,isRestricted:t.isRestricted,restrictedArea:t.restrictedArea,compensateProjectId:t.compensateid},function(e){!0===e.result?(alert(e.message),$(".hopaddruleopen").fadeOut(300),$("body").css({overflow:"auto","padding-right":0}),$(".hopmonetopen").hide(),$(".saveDisabled").removeAttr("disabled"),n(),o(),t.$apply()):alert(e.message,function(){n(),$(".saveDisabled").removeAttr("disabled"),t.$apply()})},function(e){alert(data.message,function(){n(),$(".saveDisabled").removeAttr("disabled"),t.$apply()})})},t.checkinfo=function(e,r){"0"==t.dataInfo[r].rules[e].type?$(".hopruleopen").dialog():$(".hopbntshare").dialog(),t.hopruleopenname=t.dataInfo[r].name,t.id=t.dataInfo[r].id,a.server().checkinfolist({id:t.dataInfo[r].rules[e].id},function(e){!0===e.result?(t._data=e.data,t.remaker=e.data.remaker?e.data.remaker:"",t.compensationPrice=e.data.compensationPrice,t.pricesMode=e.data.pricesMode,t.$apply()):alert(e.message)},function(e){})},t.editinfo=function(e,r,s,i,d){t.rid=i,0==e?($(".hopruleopenedit").dialog(),t.hopruleopeneditname=r,t.id=s,a.server().editinfobuild({id:i},function(e){console.log(e),!0===e.result?(t.builddata=e.data.rulesMap,t.rebuildTypes=e.data.rebuildTypes,t.typeid=t.builddata.compensationId,t.sid=t.builddata.childId,a.server().projectlist({parentId:t.typeid},function(e){!0===e.result?(t.sublevel=e.data,t.$apply()):alert(e.message)},function(e){}),t.buildid=t.builddata.buildType,t.$apply()):alert(e.message,function(){$(".hopruleopenedit").hide()})},function(e){})):($(".hopbntshareedit").dialog(),t.hopbntshareeditname=r,t.id=s,a.server().editinfoprice({id:i},function(e){!0===e.result?(console.log(e.data.rulesMap),t.pricedata=e.data.rulesMap,t.compensateProject=e.data.compensateProject,t.comid=t.pricedata.compensateProjectId,t.typeid=t.pricedata.compensationId,t.sid=t.pricedata.childId,t.isupdateRestricted=t.pricedata.isRestricted,t.status=1==t.isupdateRestricted||0==t.isupdateRestricted,t.updateRestrictedArea=t.pricedata.restrictedArea,a.server().projectlist({parentId:t.pricedata.compensationId},function(e){!0===e.result?(t.sublevel=e.data,t.$apply()):alert(e.message)},function(e){}),t.$apply()):alert(e.message,function(){$(".hopbntshareedit").hide()})},function(e){}))},t.updatepricelist=function(e,r,s,i){$(".saveDisabled").attr("disabled","disabled"),0==t.isupdateRestricted&&(t.updateRestrictedArea=""),a.server().updatepricelist({id:t.rid,typeId:t.id,type:1,compensationId:t.typeid,childId:t.sid,rank:s||null,rankRemaker:i,replacementRatio:null,buildType:null,pricesMode:t.pricedata.pricesMode,compensationPrice:e,remaker:r||null,createUser:c,isRestricted:t.isupdateRestricted,restrictedArea:t.updateRestrictedArea,compensateProjectId:t.comid,updateUser:p},function(e){!0===e.result?(alert(e.message),t.mianflag=!1,$("#editsuccessprice").hide(),$(".saveDisabled").removeAttr("disabled"),n(),o(),t.$apply()):alert(e.message,function(){t.mianflag=!1,$("#editsuccessprice").hide(),$(".saveDisabled").removeAttr("disabled"),n(),o(),t.$apply()})},function(e){alert(data.message,function(){t.mianflag=!1,$("#editsuccessprice").hide(),$(".saveDisabled").removeAttr("disabled"),n(),o(),t.$apply()})})},t.updatabuild=function(e,r,s,i){$(".saveDisabled").attr("disabled","disabled"),a.server().updatepricelist({id:t.rid,typeId:t.id,type:0,compensationId:t.typeid,childId:t.sid,rank:s,rankRemaker:i,replacementRatio:e,buildType:t.buildid,pricesMode:null,compensationPrice:null,remaker:r,updateUser:p,compensateProjectId:null},function(e){!0===e.result?(alert(e.message,function(){t.mianflag=!1,$(".hopruleopenedit").hide(),$(".saveDisabled").removeAttr("disabled"),o(),n()}),t.$apply()):alert(e.message,function(){n(),$(".hopruleopenedit").hide(),$(".saveDisabled").removeAttr("disabled"),t.$apply()})},function(e){alert(data.message,function(){n(),$(".hopruleopenedit").hide(),$(".saveDisabled").removeAttr("disabled"),t.$apply()})})},t.deleteinfo=function(e){confirm("确认删除该条信息",function(){a.server().deletecom({id:e,userId:c},function(e){!0===e.result?(alert(e.message,function(){o()}),t.$apply()):alert(e.message)},function(e){})})}}]).controller("projectcommissionreleaseCtrl",["$http","$scope","server","$state","dict","$rootScope",function(e,t,a,r,s,i){function d(){t.wzIssuingNode="",t.wzCommission="",t.wzRemarks="",t.process="",t.process2="",t.standard="",t.zhIntegratedName="",t.typeValue=1,t.zhCommission="",t.zhRemarks="",t.checkData.ruletabsel="",t.checkData.ruletabselone="",t.checkData.ruletabselTwo="",t.checkData.ruletabselThree="",$(".saveDisabled").removeAttr("disabled")}function n(){a.server().ctillegalcommissionrule({projectId:t.projectId},function(e){t.weijian=e.data,t.$apply()},function(){})}function o(){a.server().ctintegratedservices({projectId:t.projectId},function(e){t.yewu=e.data,t.yewu.forEach(function(e,a){t.yewu[a].types=1==t.yewu[a].type?"签约节点":"测绘数据"}),t.$apply()})}function l(){a.server().ctommissionrules({projectId:t.projectId},function(e){t.rulesdata=e.data,t.$apply()})}t.projectId=r.params.projectid,t.typeValue=1;var c=a.server().userId;t.list={projectId:r.params.projectid,createUser:a.server().userId,toUserId:a.server().userId,type:3,status:1},t.listtop={roomId:r.params.projectid,projectId:r.params.projectid,paciId:t.pactId,createUser:a.server().userId,imgHost:a.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},t.qyCancel=function(){window.location.reload(),$(".saveDisabled").removeAttr("disabled")},t.clearData=function(){d(),$(".saveDisabled").removeAttr("disabled")},n(),o(),t.serviceslook=function(e,r,s){$("."+s).dialog(),a.server().servicefindbyid({id:e,userId:c,type:r},function(e){t.services=e.data,t.$apply()})},t.serviceseditor=function(e,r){$("."+r).dialog(),t.id=e.id,a.server().servicedupdate({id:t.id},function(e){t.services=e.data.synthesize,t.stage=e.data.sign.stage,t.sublevelStage=e.data.sign.sublevelStage,t.surveyList=e.data.survey.surveyList,t.typeList=e.data.survey.typeList,t.projectId=e.data.synthesize.projectId,t.typeValue2=t.services.type,1==t.typeValue2?(t.ruletabsel=t.services.paymentStandardOne,a.server().servisign({parentId:t.ruletabsel},function(e){t.singe=e.data,t.$apply()}),t.onesel=t.services.paymentStandardTwo):2==t.typeValue2&&(t.threesel=t.services.paymentStandardTwo,t.twosel=t.services.paymentStandardOne),t.$apply(),t.editsaveservices=function(){$(".saveDisabled").attr("disabled","disabled");var e="",r="",s="";1==t.typeValue2?(s=1,e=t.ruletabsel,r=t.onesel):2==t.typeValue2&&(s=2,e=t.twosel,r=t.threesel),a.server().servicesavedata({id:t.id,projectId:t.projectId,updateUser:c,integratedName:t.services.integratedName,paymentStandardOne:e,paymentStandardTwo:r,type:s,commission:t.services.commission,unit:s,remarks:t.services.remarks},function(e){alert(e.message,function(){$(".saveDisabled").removeAttr("disabled"),o(),t.$apply()})})}},function(){})},t.servicesdel=function(e){t.servicesid=e.id,confirm("你确定要删除?",function(){a.server().servicedeldata({id:t.servicesid,userId:c},function(e){alert(e.message),o(),t.$apply()})})},t.isflag1=!0,t.changeColor=function(){1==t.typeValue?(t.isflag1=!0,t.isflag2=!1):(t.isflag1=!1,t.isflag2=!0)},t.clear=function(e){1==e?(t.twosel="",t.threesel="",t.checkData.ruletabselTwo="",t.checkData.ruletabselThree=""):2==e&&(t.checkData.ruletabsel="",t.checkData.ruletabselone="",t.ruletabsel="",t.onesel="")},a.server().serviceinitAdd({},function(e){t.stage=e.data.sign,t.surveyList=e.data.survey.surveyList,t.typeList=e.data.survey.typeList}),t.checktab=function(e){a.server().servisign({parentId:e},function(e){t.singe=e.data,t.$apply()})};var p="",u="",m="";t.saveZHYW=function(){$(".saveDisabled").attr("disabled","disabled"),1==t.typeValue?(m=1,p=t.checkData.ruletabsel,u=t.checkData.ruletabselone,t.unit=1):2==t.typeValue&&(m=2,p=t.checkData.ruletabselTwo,u=t.checkData.ruletabselThree,t.unit=2),a.server().ctintegratedaddsave({projectId:t.projectId,createUser:c,integratedName:t.zhIntegratedName,paymentStandardOne:p,paymentStandardTwo:u||"",type:m,commission:t.zhCommission,unit:t.unit,remarks:t.zhRemarks},function(e){1==e.result?alert(e.message,function(){$(".addzhywRules").hide(),o(),t.checkData={ruletabsel:"",ruletabselone:"",ruletabselTwo:"",ruletabselThree:""},t.zhIntegratedName="",t.zhCommission="",t.unit="",t.zhRemarks="",$(".saveDisabled").removeAttr("disabled"),t.$apply()}):alert(e.message,function(){$(".saveDisabled").removeAttr("disabled"),t.$apply()})},function(e){alert(e.message,function(){$(".saveDisabled").removeAttr("disabled"),t.$apply()})})},l(),t.rulelook=function(e,r){$("."+r).dialog();t.useid=e.id,t.projectId=e.projectId,a.server().ruleinitupdata({id:t.useid},function(e){t.ruleditor=e.data,t.$apply()})},t.addDetail=function(){t.detailsList.length<4&&t.detailsList.push({commsionPercent:"",ruleNodes:""})},t.delDetail=function(){t.detailsList.length>0&&t.detailsList.pop()},t.ruleedit=function(e,r){$("."+r).dialog();var s=[];t.useid=e.id,t.projectId=e.projectId,a.server().ruleinitupdata({id:t.useid},function(e){t.ruleditor=e.data,t.detailsList=e.data.detailsList,console.log(t.detailsList),t.$apply(),t.saveeditorule=function(){$(".saveDisabled").attr("disabled","disabled");for(var e=0,r=0,i=0;i<t.ruleditor.detailsList.length;i++)s[i]={id:t.ruleditor.detailsList[i].id,rank:i+1,ruleNodes:t.ruleditor.detailsList[i].ruleNodes,commsionPercent:t.ruleditor.detailsList[i].commsionPercent,isHandOver:i},r=t.ruleditor.detailsList[i].commsionPercent,r=parseInt(r),e+=r;var d=JSON.stringify(s);if(100!==e)return alert("提交失败，发放比例之和必须等于100%！"),void $(".saveDisabled").removeAttr("disabled");a.server().ruleupdateSave({projectId:t.projectId,id:t.useid,updateUser:c,allProcess:t.ruleditor.allProcess,allProcess2:t.ruleditor.allProcess2,standard:t.ruleditor.standard,nodeJson:d},function(e){alert(e.message,function(){$(".saveDisabled").removeAttr("disabled"),window.location.reload()})})}},function(){$(".saveDisabled").removeAttr("disabled")})},t.ruledel=function(e){t.id=e.id,confirm("你确定要删除?",function(){a.server().ruledeleteSave({id:t.id,userId:c},function(e){alert(e.message,function(){l()}),t.$apply()})})};var f;t.addffjd=function(e){f=$("."+e).find("tr").length,f<5&&$("."+e).append('<tr>\n<th width="15%" class="pl30 maincolor">发放节点：</th>\n<td >\n<input type="text"  value="" class="c-yjgzinpc c-bordere6 mt10 left ffNodes">\n<span class="ml50 mr10 maincolor left">发放比例(%)：</span>\n<input type="text"   class="c-yjgzinpc c-bordere6 mr5 mt10 left ffPercent">\n</td>\n</tr>'),t.$apply()},t.delffjd=function(e){f=$("."+e).find("tr").length,f>2&&$("."+e).find("tr:last-child").remove(),t.$apply()};var v=!0;t.inputips=function(e){""==$(e.target).val()?(v=!1,$(e.target).parent().find(".red").removeClass("disnone")):(v=!0,$(e.target).parent().find(".red").addClass("disnone"))},t.saveYJGZ=function(e){if($(".saveDisabled").attr("disabled","disabled"),t.process2||($(".saveDisabled").removeAttr("disabled"),$(".t1").removeClass("disnone"),v=!1,$(item.target).parent().find(".red").removeClass("disnone")),t.standard||($(item.target).parent().find(".red").removeClass("disnone"),$(".t2").removeClass("disnone"),v=!1,$(".saveDisabled").removeAttr("disabled")),t.standard||($(item.target).parent().find(".red").removeClass("disnone"),$(".t2").removeClass("disnone"),v=!1,$(".saveDisabled").removeAttr("disabled")),!v)return $(item.target).parent().find(".red").removeClass("disnone"),void $(".saveDisabled").removeAttr("disabled");for(var r,s=[],i=$("."+e).find("tr"),d=0,n=0;n<i.length-1;n++){var o=$("."+e).find(".ffNodes").eq(n).val();s[n]={rank:n+1,ruleNodes:o,commsionPercent:$("."+e).find(".ffPercent").eq(n).val(),isHandOver:n}}t.nodeJson=s;for(var l=0;l<t.nodeJson.length;l++)r=t.nodeJson[l].commsionPercent,r=parseInt(r,10),d+=r;if(100!==d)return alert("提交失败，发放比例之和必须等于100%！",function(){$(".saveDisabled").removeAttr("disabled")}),void $(item.target).parent().find(".red").removeClass("disnone");a.server().ctommissionrulesSave({projectId:t.projectId,createUser:c,allProcess:t.process,allProcess2:t.process2,standard:t.standard,nodeJson:JSON.stringify(t.nodeJson)},function(e){e.result?alert(e.message,function(){$(".addqyyjRules").hide(),$(".saveDisabled").removeAttr("disabled"),window.location.reload(),t.$apply()}):alert(e.message,function(){$(".saveDisabled").removeAttr("disabled")})})},t.wjyjCheck=function(e){t.useid=e.id,a.server().ctcheckillegalcommission({id:t.useid},function(e){t.checkwjyj=e.data,t.$apply()})},t.addwjyjgz=function(){},t.wjyjEdit=function(e,r){$("."+r).dialog(),t.useid=e.id,t.projectId=e.projectId,a.server().ctcheckillegalcommission({id:t.useid},function(e){t.checkwjyj=e.data,t.$apply(),t.saveeditor=function(){console.log(t.checkwjyj.issuingNode,t.checkwjyj.commission,t.checkwjyj.remarks),a.server().updateSave({id:t.useid,projectId:t.projectId,issuingNode:t.checkwjyj.issuingNode,commission:t.checkwjyj.commission,remarks:t.checkwjyj.remarks,updateUser:c},function(e){alert(e.message),n(),t.$apply()})}},function(){alert(data.message)})},t.wjyjDel=function(e){t.useid=e.id,t.projectId=e.projectId,confirm("你确定要删除?",function(){a.server().deleteById({id:t.useid,userId:c},function(e){alert(e.message,function(){n(),t.$apply()})})})},t.saveCCWZ=function(){return $(".saveDisabled").attr("disabled","disabled"),+t.wzCommission<=0?(alert("佣金不能为负数"),void $(".saveDisabled").removeAttr("disabled")):t.wzIssuingNode?t.wzCommission?void a.server().ctaddillegalcommission({projectId:t.projectId,issuingNode:t.wzIssuingNode,commission:t.wzCommission,remarks:t.wzRemarks,createUser:c},function(e){1==e.result?(t.weijian=e,alert(e.message,function(){n(),$(".addccwzRules").hide(),t.wzIssuingNode="",t.wzCommission="",t.wzRemarks="",$(".saveDisabled").removeAttr("disabled"),t.$apply()})):alert(e.message,function(){n(),$(".addccwzRules").hide(),t.wzIssuingNode="",t.wzCommission="",t.wzRemarks="",$(".saveDisabled").removeAttr("disabled"),t.$apply()})},function(e){alert(e.message,function(){n(),$(".addccwzRules").hide(),t.wzIssuingNode="",t.wzCommission="",t.wzRemarks="",$(".saveDisabled").removeAttr("disabled"),t.$apply()})}):($(".t6").removeClass("disnone"),void $(".saveDisabled").removeAttr("disabled")):($(".t5").removeClass("disnone"),void $(".saveDisabled").removeAttr("disabled"))}}]).controller("commissionRulesCtrl",["$http","$scope","server",function(e,t,a){var r=a.server().userId;a.server().ctillegalcommissionrule({projectId:t.projectId},function(e){t.weijian=e.data,console.log(t.weijian),t.$apply()},function(){}),a.server().ctintegratedservices({projectId:t.projectId},function(e){t.yewu=e.data,t.yewu.forEach(function(e,a){t.yewu[a].types=1==t.yewu[a].type?"签约节点":"测绘数据"}),t.$apply()},function(){}),t.serviceslook=function(e,r){$("."+r).dialog(),t.id=e.id,a.server().servicedupdate({id:t.id},function(e){var r=e.data.synthesize.type;t.stage=e.data.sign.stage,t.sublevelStage=e.data.sign.sublevelStage,t.surveyList=e.data.survey.surveyList,t.typeList=e.data.survey.typeList,1==r?(t.isflag1=!0,t.isflag2=!1):(t.isflag1=!1,t.isflag2=!0),a.server().servicefindbyid({id:t.id,type:r},function(e){t.services=e.data,t.$apply()})})},t.serviceseditor=function(e,s){$("."+s).dialog(),t.id=e.id,a.server().servicedupdate({id:t.id},function(e){t.services=e.data.synthesize,t.stage=e.data.sign.stage,t.sublevelStage=e.data.sign.sublevelStage,t.surveyList=e.data.survey.surveyList,t.typeList=e.data.survey.typeList,t.projectId=e.data.synthesize.projectId,t.$apply(),t.saveservices=function(){if(t.isflag1)var e=0,s=t.stagesel,i=t.sublevesel;else var e=1,s=t.surveyesel,i=t.compensel;a.server().servicesavedata({id:t.id,projectId:t.projectId,updateUser:r,integratedName:t.services.integratedName,paymentStandardOne:s,paymentStandardTwo:i,type:e,commission:t.services.commission,unit:"1",remarks:t.services.remarks},function(e){alert(e.message,function(){location.reload(),t.$apply()})})}},function(){})},t.servicesdel=function(e){t.useid=e.id,t.projectId=e.projectId,confirm("你确定要删除?",function(){a.server().servicedeldata({id:t.useid,userId:r},function(e){alert(e.message),location.reload(),t.$apply()})})},t.isflag1=!0,t.changeColor=function(){"签约节点"==t.typeValue?(t.isflag1=!0,t.isflag2=!1):(t.isflag1=!1,t.isflag2=!0)},t.checktab=function(e,r){0==r?(t.twosel="",t.threesel=""):1==r&&(t.ruletabsel="",t.onesel=""),a.server().servisign({parentId:e},function(e){t.singe=e.data})},a.server().serviceinitAdd({},function(e){t.stage=e.data.sign,t.surveyList=e.data.survey.surveyList,t.typeList=e.data.survey.typeList,t.saveZHYW=function(){if($(".saveDisabled").attr("disabled","disabled"),!t.zhIntegratedName)return void $(".t8").removeClass("disnone");if(t.isflag1){var e=0,s=t.ruletabsel;i=t.onesel}else var e=1,s=t.twosel,i=t.threesel;a.server().ctintegratedaddsave({projectId:t.projectId,createUser:r,integratedName:t.zhIntegratedName,paymentStandardOne:s,paymentStandardTwo:i||"",type:e,commission:t.zhCommission,unit:2,remarks:t.zhRemarks},function(e){alert(e.message,function(){$(".saveDisabled").removeAttr("disabled"),location.reload(),t.$apply()})},function(e){})}}),a.server().ctommissionrules({projectId:t.projectId},function(e){t.rulesdata=e.data}),t.rulelook=function(e,r){$("."+r).dialog();t.useid=e.id,t.projectId=e.projectId,a.server().ruleinitupdata({id:t.useid},function(e){t.ruleditor=e.data,t.$apply()})},t.ruleedit=function(e,s){$("."+s).dialog();var i=[];t.useid=e.id,t.projectId=e.projectId,a.server().ruleinitupdata({id:t.useid},function(e){t.ruleditor=e.data,t.$apply(),t.saveeditorule=function(){if($(".saveDisabled").attr("disabled","disabled"),!t.ruleditor.allProcess)return void $(".t3").removeClass("disnone");if(!t.ruleditor.allProcess2)return void $(".t3").removeClass("disnone");if(!t.ruleditor.standard)return void $(".t4").removeClass("disnone");for(var e=0,s=0,d=0;d<t.ruleditor.detailsList.length;d++)i[d]={id:t.ruleditor.detailsList[d].id,rank:d+1,ruleNodes:t.ruleditor.detailsList[d].ruleNodes,commsionPercent:t.ruleditor.detailsList[d].commsionPercent,isHandOver:d},s=t.ruleditor.detailsList[d].commsionPercent,s=parseInt(s),e+=s;var n=JSON.stringify(i);if(100!==e)return void alert("提交失败，发放比例之和必须等于100%！");a.server().ruleupdateSave({projectId:t.projectId,id:t.useid,updateUser:r,allProcess:t.ruleditor.allProcess,allProcess2:t.ruleditor.allProcess2,standard:t.ruleditor.standard,nodeJson:n},function(e){alert(e.message,function(){$(".saveDisabled").removeAttr("disabled"),location.reload()}),t.$apply()})},t.$apply()},function(){})},t.ruledel=function(e){t.id=e.id,confirm("你确定要删除?",function(){a.server().ruledeleteSave({id:t.id,userId:r},function(e){alert(e.message,function(){location.reload()}),t.$apply()})})};var s;t.addffjd=function(e){s=$("."+e).find("tr").length,s<5&&$("."+e).append('<tr>\n<th width="15%" class="pl30 maincolor">发放节点：</th>\n<td >\n<input type="text"  value="" class="c-yjgzinpc c-bordere6 mt10 left ffNodes">\n<span class="ml50 mr10 maincolor left">发放比例：</span>\n<input type="text"   class="c-yjgzinpc c-bordere6 mr5 mt10 left ffPercent">%\n</td>\n</tr>'),t.$apply()},t.delffjd=function(e){s=$("."+e).find("tr").length,s>3&&$("."+e).find("tr:last-child").remove(),t.$apply()};var i=!0;t.inputips=function(e){""==$(e.target).val()?(i=!1,$(e.target).parent().find(".red").removeClass("disnone")):(i=!0,$(e.target).parent().find(".red").addClass("disnone"))},t.saveYJGZ=function(e){if(t.process2||($(".t1").removeClass("disnone"),i=!1),t.standard||($(".t2").removeClass("disnone"),i=!1),t.standard||($(".t2").removeClass("disnone"),i=!1),i){for(var s,d=[],n=($("."+e).find("tr"),0),o=0;o<4;o++){var l=$("."+e).find(".ffNodes").eq(o).val();console.log(l),d[o]={rank:o+1,ruleNodes:l,commsionPercent:$("."+e).find(".ffPercent").eq(o).val(),isHandOver:o}}t.nodeJson=d;for(var c=0;c<t.nodeJson.length;c++)s=t.nodeJson[c].commsionPercent,s=parseInt(s),n+=s;if(100!==n)return void alert("提交失败，发放比例之和必须等于100%！");a.server().ctommissionrulesSave({projectId:t.projectId,createUser:r,allProcess:t.process,allProcess2:t.process2,standard:t.standard,nodeJson:JSON.stringify(t.nodeJson)},function(e){alert(e.message,function(){location.reload(),t.$apply()})})}},t.wjyjCheck=function(e){t.useid=e.id,a.server().ctcheckillegalcommission({id:t.useid},function(e){t.checkwjyj=e.data,t.$apply()})},t.addwjyjgz=function(){},t.wjyjEdit=function(e,s){$("."+s).dialog(),t.useid=e.id,t.projectId=e.projectId,a.server().ctcheckillegalcommission({id:t.useid},function(e){t.checkwjyj=e.data,t.$apply(),
t.saveeditor=function(){console.log(t.checkwjyj.issuingNode,t.checkwjyj.commission,t.checkwjyj.remarks),a.server().updateSave({id:t.useid,projectId:t.projectId,issuingNode:t.checkwjyj.issuingNode,commission:t.checkwjyj.commission,remarks:t.checkwjyj.remarks,updateUser:r},function(e){alert(e.message),location.reload(),t.$apply()})}},function(){})},t.wjyjDel=function(e){t.useid=e.id,t.projectId=e.projectId,confirm("你确定要删除?",function(){a.server().deleteById({id:t.useid,userId:r},function(e){alert(e.message,function(){location.reload(),t.$apply()})})})},t.saveCCWZ=function(){return $(".saveDisabled").attr("disabled","disabled"),t.wzIssuingNode?t.wzCommission?t.wzRemarks?void a.server().ctaddillegalcommission({projectId:t.projectId,issuingNode:t.wzIssuingNode,commission:t.wzCommission,remarks:t.wzRemarks,createUser:r},function(e){t.weijian=e,alert(e.message,function(){$(".saveDisabled").removeAttr("disabled"),location.reload(),t.$apply()})}):void $(".t7").removeClass("disnone"):void $(".t6").removeClass("disnone"):void $(".t5").removeClass("disnone")}}]);