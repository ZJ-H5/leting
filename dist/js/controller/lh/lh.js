"use strict";angular.module("app").controller("projectmanagementCtrl",["$http","$scope","dict","server","$rootScope","$state",function(e,t,a,r,o,c){function n(){r.server().lhprojectlist({pageNo:t.conf.currentPage,pageSize:t.conf.itemPageLimit,searchKeys:t.projectnameinput},function(e){!0===e.result?(t.rows=e.data.rows,t.rows[0].status_1=!0,t.conf.total=e.data.pageCount,t.conf.counts=e.data.total,t.$apply(),t.$broadcast("categoryLoaded")):alert(e.message)})}var i=r.server().userId,s=(r.server().imgHost,window.localStorage);t.no="/",t.conf={total:10,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},t.listtop={projectId:"",createUser:r.server().userId,imgHost:r.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},t.transferclick={},t.gcShowWin=function(e){t.transferclick.reset(e,t.rows)},t.action={},t.dataFollowUp=function(e){t.projectId=e,t.action.reset(e,1)},t.myajax=function(){n()},t.mylocation=function(){},t.checkitems=function(e){s.setItem("a",t.rows[e].id)},t.$watch("conf.currentPage + conf.itemPageLimit+projectnameinput",function(e){n()}),t.edit=function(e,o){t.check.projectNameflag=!1,t.id=e,r.server().editInit({id:e},function(e){!0===e.result?($("."+o).dialog(),t.project=e.data,t.project.signingAgreementTime?t.project.signingAgreementTime=a.timeConverter3(t.project.signingAgreementTime,3):t.project.signingAgreementTime="",t.agreementName=e.data.agreementName,t.provinceList=e.data.provinceList,t.cityList=e.data.cityList,t.areaList=e.data.areaList,t.$apply()):alert(e.message)})},t.provincetab=function(e){t.project.provinceId?t.check.provinceIdflag=!1:t.check.provinceIdflag=!0,r.server().provinceselect({parentId:e},function(e){!0===e.result?(t.cityList=e.data,t.$apply()):alert(e.message)})},t.citytab=function(e){t.project.cityId?t.check.cityIdflag=!1:t.check.cityIdflag=!0,r.server().provinceselect({parentId:e},function(e){!0===e.result?(t.areaList=e.data,t.$apply()):alert(e.message)})},t.check={projectNameflag:!1},t.tips=function(e,a){"projectName"==a&&(t.check.projectNameflag=!e)};var l="";t.saveproject=function(){if($(".saveDisabled").attr("disabled","disabled"),!t.project.projectName)return void(t.check.projectNameflag=!0);l=t.project.provinceId+t.project.cityId+t.project.areaId+t.project.roadId,r.server().saveproject({id:t.project.id,projectName:t.project.projectName,parcelNumber:t.project.parcelNumber,provinceId:t.project.provinceId,cityId:t.project.cityId,areaId:t.project.areaId,roadId:t.project.roadId,agreementName:t.agreementName?t.agreementName:"框架协议",areaDemolition:t.project.areaDemolition,plannedVolumeRatio:t.project.plannedVolumeRatio,planningFloorArea:t.project.planningFloorArea,surveyArea:t.project.surveyArea,updateUser:i,signingAgreementTime:t.project.signingAgreementTime},function(e){!0===e.result?(alert(e.message,function(){n(),$(".hopbntbuild").hide(),$(".saveDisabled").removeAttr("disabled")}),t.$apply()):alert(e.message,function(){$(".saveDisabled").removeAttr("disabled")})})},t.flag=!1,t.delete=function(e){confirm("确认删除项目?",function(){r.server().delProject({userId:i,projectId:e},function(e){!0===e.result?(alert(e.message,function(){n()}),t.$apply()):alert(e.message)})})},t.sels=function(e){t.flag=!1,r.server().deleteProjectData({id:e,userId:i},function(e){!0===e.result?(console.log(e.message),window.location.reload(),t.$apply()):alert(e.message)},function(e){})},t.cance=function(){t.flag=!1},t.mychange=function(e){laydate.render({elem:".test1",format:"yyyy-MM-dd",show:!0,closeStop:".test2",done:function(e){t.project.signingAgreementTime=e}})}}]).controller("updatarecordCtrl",["$http","$scope","dict","server",function(e,t,a,r){t.no="/",t.conf={total:10,currentPage:1,itemPageLimit:4,isSelectPage:!1,isLinkPage:!1},t.$watch("conf.currentPage + conf.itemPageLimit+projectnameinput",function(e){console.log(t.conf.currentPage),r.server().updatarecoedlist({pageNo:t.conf.currentPage,pageSize:t.conf.itemPageLimit,projectId:"261e554de2f3493ebed1e4b6567818d1"},function(e){!0===e.result?(t.data=e.data.rows,t.conf.total=Math.ceil(e.data.total/e.data.pageSize),t.conf.counts=e.data.total,t.$broadcast("categoryLoaded"),t.$apply()):alert(e.message)})})}]);