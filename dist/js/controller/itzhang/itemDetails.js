"use strict";angular.module("app").controller("itemDetailsCtrl",["server","$http","$scope","dict","$rootScope","$state",function(e,a,t,r,o,n){function s(e,a){echarts.init(document.getElementById("main")).setOption({series:[{name:"访问来源",type:"pie",radius:"55%",data:[{value:e[0]?e[0]:0,name:"还建"},{value:e[1]?e[1]:0,name:"移交"},{value:e[2]?e[2]:0,name:"拆除"},{value:e[3]?e[3]:0,name:"测绘"},{value:e[4]?e[4]:0,name:"签约"}]}]}),t.salesControlArr=[{value:e[0]?e[0]:0,name:"还建",USName:a[0]},{value:e[1]?e[1]:0,name:"移交",USName:a[1]},{value:e[2]?e[2]:0,name:"拆除",USName:a[2]},{value:e[3]?e[3]:0,name:"测绘",USName:a[3]},{value:e[4]?e[4]:0,name:"签约",USName:a[4]}]}function i(){e.server().zjfollowuplistdo({projectId:t.projectId},function(e){if(!0===e.result&&e.data){t.showMes=e.data;for(var a=0;a<e.data.length;a++)c((new Date).getTime())-c(e.data[a].createTime)<=1?e.data[a].createTime="1分钟前":c((new Date).getTime())-c(e.data[a].createTime)<=2?e.data[a].createTime="2分钟前":c((new Date).getTime())-c(e.data[a].createTime)<=3?e.data[a].createTime="3分钟前":e.data[a].createTime=r.timeConverter(e.data[a].createTime);t.showData.photoUrl=e.data[0].photoUrl?e.data[0].photoUrl:"../image/图层10_34.png",t.showData.realname=e.data[0].realname,t.showData.projectName=e.data[0].projectName,t.showData.id="",t.showData.createTime=e.data[0].createTime,t.showData.depict=e.data[0].depict,t.$apply()}})}t.hostName=e.server().host,t.no="暂无数据";var d=e.server().userId;t.projectId=n.params.projectid;var l=[],p=[];t.list={projectId:n.params.projectid,createUser:e.server().userId,toUserId:e.server().userId,type:3,status:1},t.listtop={roomId:n.params.projectid,projectId:n.params.projectid,paciId:t.pactId,createUser:e.server().userId,imgHost:e.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},e.server().zjprojectprojectDetaileddo({projectId:t.projectId},function(e){if(!0===e.result){t.project=e.data.project,t.survey=e.data.survey,t.propertyCount=e.data.propertyCount,t.count=e.data.count,t.attachment=e.data.attachment,t.salesControl=e.data.salesControl;for(var a in t.salesControl)l.push(t.salesControl[a]),p.push(a);s(l,p),t.$apply()}}),e.server().zjprojectdeleteById({id:t.projectId,userId:d},function(e){!0===e.result&&(t.project2=e.data.project,t.$apply())}),e.server().zjprojectprojectDetaileddo({projectId:t.projectId},function(e){e.result?e.data.follow&&0==e.data.follow.status&&(t.follow=!0):alert(e.message)}),t.changeFollow=function(a){if(a){var r={projectId:t.projectId,creatorUser:d,type:30};r.userJson=JSON.stringify([{toUserId:d}]),e.server().lgcMainInfosharedtransferconSave(r,function(e){},function(){})}};var c=function(e){var a=new Date(e),t=["01","02","03","04","05","06","07","08","09","10","11","12"];return a.getFullYear()+t[a.getMonth()]+(a.getDate()<10?"0"+a.getDate():a.getDate())+(a.getHours()<10?"0"+a.getHours():a.getHours())+(a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes())};t.showData={},i(),t.issue=function(a){if(!a)return void alert("描述不能为空！");t.showData.createTime="刚刚",t.showData.depict=a,e.server().zjfollowupaddSavedo({type:1,dataId:t.projectId,depict:a||"",createUser:d},function(e){!0===e.result?(alert("发布成功！"),t.showMes.unshift(t.showData),t.textareaVal="",window.setTimeout(i,1e4),t.$apply()):alert(e.message)})},t.delete=function(a,r){if(!a)return void alert("发布30秒后才能删除");confirm("确认删除该条吗？",function(){e.server().zjfollowupdeleteByIddo({id:a},function(e){!0===e.result?(t.showMes.splice(r,1),t.$apply()):alert(e.message)})})}}]).controller("itemInformationCtrl",["$http","$scope","server","dict","$state",function(e,a,t,r,o){function n(){t.server().watchAttachment({projectId:a.projectId},function(e){!0===e.result?(a.attachList=e.data,a.arr1=[],a.arr2=[],a.attachList.forEach(function(e,t){1==e.type?a.arr1.push(e):a.arr2.push(e)}),a.$apply()):alert(e.message)})}a.no="暂无数据",a.projectId=o.params.projectid,a.hostname=t.server().imgHost;var s=t.server().userId;a.list={projectId:o.params.projectid,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:1},a.listtop={roomId:o.params.projectid,projectId:o.params.projectid,paciId:a.pactId,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},t.server().zjprojectdeleteById({id:a.projectId,userId:s},function(e){!0===e.result?(a.project=e.data.project,a.count=e.data.count,a.$apply()):alert(e.message)},function(){}),n(),a.addannex=function(r,o){var s=new FormData,i=r[0];a.filename=i.name,s.append("multipartFile",i),e({method:"POST",url:a.hostname+"attachment/fielUpload.do",data:s,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){a.data=e.data.data,a.fileName=a.data.fileName,a.filePath=a.data.filePath,a.size=a.data.size;var r=[{fileName:a.fileName,fileSize:a.size,fileUrl:a.filePath}];t.server().addProjectAttachment({projectId:a.projectId,type:o,pictureJson:JSON.stringify(r)},function(e){!0===e.result?(alert(e.message,function(){n()}),a.$apply()):alert(e.message)},function(e){})})}}]).controller("propertyInformationCtrl",["$http","$scope","server","$state","dict",function(e,a,t,r,o){function n(){t.server().zjroomlistdo({userId:s,projectId:a.projectId,pageNo:a.conf.currentPage?a.conf.currentPage:1,pageSize:a.conf.itemPageLimit?a.conf.itemPageLimit:10},function(e){!0===e.result?0===e.data.total?a.flag:(a.flag=!1,a.lists=e.data.rows,a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$broadcast("categoryLoaded"),a.$apply()):alert(e.message)})}a.projectId=r.params.projectid;var s=t.server().userId;a.casHost=t.server().casHost,a.propertyUrl=t.server().propertyUrl,a.no="-",a.list={projectId:r.params.projectid,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:1},a.listtop={roomId:r.params.projectid,projectId:r.params.projectid,paciId:a.pactId,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},a.newInforClick=function(){window.location=a.casHost+a.propertyUrl},a.conf={total:10,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},a.$watch("conf.currentPage + conf.itemPageLimit",function(e){n()}),a.inputVal=function(){n(a.inputVal)},a.edit=function(){},a.delete=function(e,r){confirm("确认删除这条数据吗？",function(){t.server().zjroomdeleteByIddo({id:e,userId:s},function(e){!0===e.result?(alert(e.message,function(){n()}),a.$apply()):alert(e.message)})})}}]).controller("NewHousingStandardsCtrl",["$http","$scope","server","dict","$state","$stateParams",function(e,a,t,r,o,n){function s(e,r){r+1!=a.flag.length&&!0===a.flag[r+1].quflag&&(a.flag[r+1].selectval=[],t.server().zjroominitAddSubleveldo({parentId:e},function(e){!0===e.result?(e.data.length>0?a.flag[r+1].selectval=e.data:alert("未找到对应的子级结构,请重新选择！"),a.$apply()):alert(e.message)}))}function i(e,r,n){for(var s=0;s<r.length;s++)r[s].val&&a.sumval.push(r[s].val),r[s].id&&a.sumid.push(r[s].id);a.clickflag&&(a.clickflag=!1,t.server().zjroomaddSavedoADD({createUser:d,parkId:p,schemaObjId:a.sumid[a.sumid.length-1],code:e.code,splitJointName:a.sumval.join(""),address:e.address,houseUser:e.houseUser||"",attribute:n||"",propertyRightDatumName:e.propertyRightDatumName||"",landCertificate:e.landCertificate||"",houseCertificate:e.houseCertificate,landArea:e.landArea,registerArea:e.registerArea,whether:e.isRoom,splitJointId:a.sumid.join(",")},function(e){a.sumid=[],a.sumval=[],!0===e.result?(a.clickflag=!0,alert("提交成功！",function(){o.go("propertyInfo",{projectid:p})}),a.$apply()):alert(e.message)}))}var d=t.server().userId,l=o.params.id,p=o.params.packid;a.projectlocation=o.params.packid,a.locationInformation=function(){o.go("propertyInfo",{projectid:a.projectlocation})},a.flag=[{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""},{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""},{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""},{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""},{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""}],p&&(a.interfaces="",t.server().zjroominitAdddo({schemId:l,projectId:p},function(e){if(!0===e.result){a.interfaces=e.data,a.whether=e.data.isRoom,a.settingsList=e.data.settingsList,a.topClass=e.data.topClass,a.distinguish=e.data.distinguish,a.quShowNumber=e.data.topClass.length;for(var t=0;t<a.topClass.length;t++)switch(a.topClass[0].selectvalOnce=a.distinguish,a.topClass[t].sort){case 0:a.flag[0].quflag=!0,a.flag[0].selectval=a.topClass[t].selectvalOnce,a.flag[0].titleName=a.topClass[t].shemaName;break;case 1:a.flag[1].quflag=!0,a.flag[1].selectval=a.topClass[t].selectvalOnce,a.flag[1].titleName=a.topClass[t].shemaName;break;case 2:a.flag[2].quflag=!0,a.flag[2].selectval=a.topClass[t].selectvalOnce,a.flag[2].titleName=a.topClass[t].shemaName;break;case 3:a.flag[3].quflag=!0,a.flag[3].selectval=a.topClass[t].selectvalOnce,a.flag[3].titleName=a.topClass[t].shemaName;break;case 4:a.flag[4].quflag=!0,a.flag[4].selectval=a.topClass[t].selectvalOnce,a.flag[4].titleName=a.topClass[t].shemaName}a.$apply()}else alert(e.message)})),a.sendval=[{val:"",id:""},{val:"",id:""},{val:"",id:""},{val:"",id:""},{val:"",id:""}],a.sumval=[],a.sumid=[],a.tops={code:!1,address:!1,landCircumstances:!1,landCertificate:!1,propertyOwner:!1,houseCertificate:!1,houseUser:!1,landArea:!1,registerArea:!1,settabute:!1,propertyRightDatumName:!1},a.tips=function(e,t){0===t&&(e?(a.flag[0].spanflag=!1,s(e,t)):a.flag[0].spanflag=!0),1===t&&(e?(a.flag[1].spanflag=!1,s(e,t)):a.flag[1].spanflag=!0),2===t&&(e?(a.flag[2].spanflag=!1,s(e,t)):a.flag[2].spanflag=!0),3===t&&(e?(a.flag[3].spanflag=!1,s(e,t)):a.flag[3].spanflag=!0),4===t&&(e?(a.flag[4].spanflag=!1,s(e,t)):a.flag[4].spanflag=!0),"code"==t&&(a.tops.code=!e),"address"==t&&(a.tops.address=!e)},a.save=function(){if(!0===a.flag[0].quflag){if(!a.flag[0].topselect.id)return void(a.flag[0].spanflag=!0);a.sendval[0].id=a.flag[0].topselect.id,a.sendval[0].val=$(".select0").find("option:selected").text(),a.flag[0].spanflag=!1}if(!0===a.flag[1].quflag){if(!a.flag[1].topselect.id)return void(a.flag[1].spanflag=!0);a.sendval[1].id=a.flag[1].topselect.id,a.sendval[1].val=$(".select1").find("option:selected").text(),a.flag[1].spanflag=!1}if(!0===a.flag[2].quflag){if(!a.flag[2].topselect.id)return void(a.flag[2].spanflag=!0);a.sendval[2].id=a.flag[2].topselect.id,a.sendval[2].val=$(".select2").find("option:selected").text(),a.flag[2].spanflag=!1}if(!0===a.flag[3].quflag){if(!a.flag[3].topselect.id)return void(a.flag[3].spanflag=!0);a.sendval[3].id=a.flag[3].topselect.id,a.sendval[3].val=$(".select3").find("option:selected").text(),a.flag[3].spanflag=!1}if(!0===a.flag[4].quflag){if(!a.flag[4].topselect.id)return void(a.flag[4].spanflag=!0);a.sendval[4].id=a.flag[4].topselect.id,a.sendval[4].val=$(".select4").find("option:selected").text(),a.flag[4].spanflag=!1}if(1===a.whether){if(!a.interfaces.code)return a.interfaces.code="",void(a.tops.code=!0);a.tops.code=!1}if(!a.interfaces.address)return void(a.tops.address=!0);a.tops.address=!1,a.number=0;for(var e=0;e<a.flag.length;e++)1==a.flag[e].quflag&&a.number++;if(a.number<a.quShowNumber)return void alert("未找到对应的所属子级结构！");i(a.interfaces,a.sendval,a.setval)},a.clickflag=!0}]).controller("NewBuildingStandardCtrl",["$http","$scope","server","dict","$state",function(e,a,t,r,o){function n(e,r){r+1!=a.flag.length&&!0===a.flag[r+1].quflag&&(a.flag[r+1].selectval=[],t.server().zjroominitAddSubleveldo({parentId:e},function(e){!0===e.result?(e.data.length>0?a.flag[r+1].selectval=e.data:alert("未找到对应的子级结构,请重新选择！"),a.$apply()):alert(e.message)}))}function s(e,r,n){for(var s=0;s<r.length;s++)r[s].val&&a.sumval.push(r[s].val),r[s].id&&a.sumid.push(r[s].id);a.clickflag&&(a.clickflag=!1,t.server().zjroomaddSavedo({updateUser:d,parkId:e.parkId,id:e.id,schemaObjId:a.sumid[a.sumid.length-1],code:e.code,splitJointName:a.sumval.join(""),attribute:n||"",address:e.address,landCertificate:e.landCertificate||"",landArea:e.landArea||"",houseCertificate:e.houseCertificate||"",houseUser:e.houseUser||"",registerArea:e.registerArea||"",whether:e.whether,splitJointId:a.sumid.join(","),propertyRightDatumName:e.propertyRightDatumName||""},function(e){a.sumid=[],a.sumval=[],!0===e.result?(a.clickflag=!0,alert(e.message,function(){o.go("propertyInfo",{projectid:i})})):alert(e.message)},function(e){alert(e)}))}var i=o.params.projectid;a.projectlocation=o.params.projectid;var d=t.server().userId,l=o.params.schemaId,p=o.params.id;a.flag=[{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""},{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""},{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""},{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""},{quflag:!1,spanflag:!1,topselect:"",selectval:[],titleName:""}],a.locationInformation=function(){o.go("propertyInfo",{projectid:i})},l&&(a.interfaces="",t.server().zjroominitUpdatedo({id:p,schemaId:l},function(e){if(!0===e.result){a.interfaces=e.data.roomMap,a.whether=a.interfaces.whether,a.settingsList=e.data.settingsList,a.setval=a.interfaces.attribute,a.schemaList=e.data.schemaList,a.topClass=e.data.topClass,a.array=e.data.array,a.quShowNumber=e.data.schemaList.length;for(var t=0;t<a.topClass.length;t++)for(var r=0;r<a.topClass[t].topClassList.length;r++)switch(a.array[t]===a.topClass[t].topClassList[r].id&&(a.schemaList[t].topval=a.topClass[t].topClassList[r]),a.schemaList[t].sort){case 0:a.flag[0].topselect=a.schemaList[t].topval;break;case 1:a.flag[1].topselect=a.schemaList[t].topval;break;case 2:a.flag[2].topselect=a.schemaList[t].topval;break;case 3:a.flag[3].topselect=a.schemaList[t].topval;break;case 4:a.flag[4].topselect=a.schemaList[t].topval}for(var o=0;o<a.schemaList.length;o++)switch(a.schemaList[o].selectval=a.topClass[o].topClassList,a.schemaList[o].sort){case 0:a.flag[0].quflag=!0,a.flag[0].selectval=a.schemaList[o].selectval,a.flag[0].titleName=a.schemaList[o].shemaName;break;case 1:a.flag[1].quflag=!0,a.flag[1].selectval=a.schemaList[o].selectval,a.flag[1].titleName=a.schemaList[o].shemaName;break;case 2:a.flag[2].quflag=!0,a.flag[2].selectval=a.schemaList[o].selectval,a.flag[2].titleName=a.schemaList[o].shemaName;break;case 3:a.flag[3].quflag=!0,a.flag[3].selectval=a.schemaList[o].selectval,a.flag[3].titleName=a.schemaList[o].shemaName;break;case 4:a.flag[4].quflag=!0,a.flag[4].selectval=a.schemaList[o].selectval,a.flag[4].titleName=a.schemaList[o].shemaName}a.$apply()}else alert(e.message)},function(e){alert(e)})),a.sendval=[{val:"",id:""},{val:"",id:""},{val:"",id:""},{val:"",id:""},{val:"",id:""}],a.sumval=[],a.sumid=[],a.tops={code:!1,address:!1,landCircumstances:!1,landCertificate:!1,propertyOwner:!1,houseCertificate:!1,houseUser:!1,landArea:!1,registerArea:!1,settabute:!1},a.tips=function(e,t){0===t&&(e?(a.flag[0].spanflag=!1,n(e,t)):a.flag[0].spanflag=!0),1===t&&(e?(a.flag[1].spanflag=!1,n(e,t)):a.flag[1].spanflag=!0),2===t&&(e?(a.flag[2].spanflag=!1,n(e,t)):a.flag[2].spanflag=!0),3===t&&(e?(a.flag[3].spanflag=!1,n(e,t)):a.flag[3].spanflag=!0),4===t&&(e?(a.flag[4].spanflag=!1,n(e,t)):a.flag[4].spanflag=!0),"code"==t&&(a.tops.code=!e),"address"==t&&(a.tops.address=!e),"settabute"==t&&(a.tops.settabute=!e),"landCircumstances"==t&&(a.tops.landCircumstances=!e),"landCertificate"==t&&(a.tops.landCertificate=!e),"landArea"==t&&(a.tops.landArea=!e),"propertyOwner"==t&&(a.tops.propertyOwner=!e),"houseCertificate"==t&&(a.tops.houseCertificate=!e),"houseUser"==t&&(a.tops.houseUser=!e),"registerArea"==t&&(a.tops.registerArea=!e)},a.save=function(){if(!0===a.flag[0].quflag){if(!a.flag[0].topselect.id)return void(a.flag[0].spanflag=!0);a.sendval[0].id=a.flag[0].topselect.id,a.sendval[0].val=$(".select0").find("option:selected").text(),a.flag[0].spanflag=!1}if(!0===a.flag[1].quflag){if(!a.flag[1].topselect.id)return void(a.flag[1].spanflag=!0);a.sendval[1].id=a.flag[1].topselect.id,a.sendval[1].val=$(".select1").find("option:selected").text(),a.flag[1].spanflag=!1}if(!0===a.flag[2].quflag){if(!a.flag[2].topselect.id)return void(a.flag[2].spanflag=!0);a.sendval[2].id=a.flag[2].topselect.id,a.sendval[2].val=$(".select2").find("option:selected").text(),a.flag[2].spanflag=!1}if(!0===a.flag[3].quflag){if(!a.flag[3].topselect.id)return void(a.flag[3].spanflag=!0);a.sendval[3].id=a.flag[3].topselect.id,a.sendval[3].val=$(".select3").find("option:selected").text(),a.flag[3].spanflag=!1}if(!0===a.flag[4].quflag){if(!a.flag[4].topselect.id)return void(a.flag[4].spanflag=!0);a.sendval[4].id=a.flag[4].topselect.id,a.sendval[4].val=$(".select4").find("option:selected").text(),a.flag[4].spanflag=!1}if(1===a.whether){if(!a.interfaces.code)return a.interfaces.code="",void(a.tops.code=!0);a.tops.code=!1}if(!a.interfaces.address)return void(a.tops.address=!0);a.tops.address=!1,a.number=0;for(var e=0;e<a.flag.length;e++)!0===a.flag[e].quflag&&a.number++;if(a.number<a.quShowNumber)return void alert("未找到对应的所属子级结构！");s(a.interfaces,a.sendval,a.setval)},a.clickflag=!0}]).controller("PropertyManagementPropertyManagementCtrl",["$http","$scope","server","dict","$state",function(e,a,t,r,o){function n(e,t,r,o){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,closeStop:"."+t,done:function(e){a.saveObj.cardPeriod=e,r&&(a.saveflag.cardPeriod=!1,o(e))}})}function s(){t.server().zjownershipqueryOwnerAndRecievedo({holderId:a.roomId},function(e){if(!0===e.result){if(e.data){a.data=e.data,a.data&&a.data.forEach(function(e,t){switch(a.data[t].isType=a.data[t].recieveType,a.data[t].recieveType){case 1:a.data[t].recieveType="业权人收款";break;case 2:a.data[t].recieveType="其他人代收款";break;case 3:a.data[t].recieveType="未满18岁监护人待收款";break;case 4:a.data[t].recieveType="关联其他业权人收款"}});for(var t=0;t<e.data.length;t++)a.data[t].indx=t;a.$apply()}}else alert(e.message)})}function i(e,a){var t=echarts.init(document.getElementById("main")),r={title:{text:""},tooltip:{},animationDurationUpdate:1500,animationEasingUpdate:"quinticInOut",label:{normal:{show:!0,textStyle:{fontSize:10}}},legend:{x:"center",show:!1,data:["家人","朋友","亲戚"]},series:[{type:"graph",layout:"force",symbolSize:50,focusNodeAdjacency:!0,roam:!0,categories:[{name:"家人",itemStyle:{normal:{color:"#009800"}}},{name:"朋友",itemStyle:{normal:{color:"#4592FF"}}},{name:"亲戚",itemStyle:{normal:{color:"#3592F"}}}],label:{normal:{show:!0,textStyle:{fontSize:12}}},force:{repulsion:1e3},edgeSymbolSize:[4,50],edgeLabel:{normal:{show:!0,textStyle:{fontSize:10},formatter:"{c}"}},data:e,links:a,lineStyle:{normal:{opacity:.9,width:1,curveness:0}}}]};t.setOption(r)}function d(e){t.server().zjmakecollectionsaddSave({createUser:c,InformationId:e.InformationId,relationPersion:e.relationPersion,relationPhone:e.relationPhone,householdRegister:e.householdRegister,relationShip:e.relationShip,decisionRelation:e.decisionRelation},function(e){!0===e.result&&($(".supperme").hide(),a.addpreson.relationPersion="",a.addpreson.relationPhone="",a.addpreson.householdRegister="",a.addpreson.relationShip="",a.addpreson.decisionRelation="",alert("添加联系人成功!",function(){s()}),a.$apply()),!1===e.result&&alert(e.message)},function(e){alert(e)})}function l(e,r){t.server().zjmakecollectionsupdateSavedo({id:e.InformationId,relationPersion:e.relationPersion,relationPhone:e.relationPhone,householdRegister:e.householdRegister,relationShip:e.relationShip,decisionRelation:e.decisionRelation,InformationId:a.data[r].id,updateUser:c},function(e){!0===e.result?($(".supperme").hide(),a.addType={},a.addpreson.relationPersion="",a.addpreson.relationPhone="",a.addpreson.householdRegister="",a.addpreson.relationShip="",a.addpreson.decisionRelation="",alert("修改联系人成功!",function(){s()}),a.$apply()):alert(e.message)},function(e){alert(e)})}function p(e,r,o,n){return a.addType.monetaryAmount?a.addType.transitionalAmount?a.addType.relocateCompensateAmount?a.addType.signAwardAmount?a.addType.decorateCompensateAmount?void(a.addFlag?t.server().zjmakerecieveaddRecieveWaydo({createUser:c,ownershipId:o,recieveType:r,InformationBank:e.InformationBank?e.InformationBank:"",bankNo:e.bankNo?e.bankNo:"",recievePerson:e.guardian?e.guardian:"",relationPhone:e.relationPhone?e.relationPhone:"",address:e.address?e.address:"",idCard:e.idCard?e.idCard:"",relationShip:e.relationShip?e.relationShip:"",agencyFundForm:n||"",agencyFundId:e.agencyFundId?e.agencyFundId:"",recieveGuardian:e.recieveGuardian?e.recieveGuardian:"",monetaryAmount:e.monetaryAmount?e.monetaryAmount:"",transitionalAmount:e.transitionalAmount?e.transitionalAmount:"",relocateCompensateAmount:e.relocateCompensateAmount?e.relocateCompensateAmount:"",signAwardAmount:e.signAwardAmount?e.signAwardAmount:"",decorateCompensateAmount:e.decorateCompensateAmount?e.decorateCompensateAmount:""},function(e){!0===e.result?($(".dialog").hide(),a.addType={},a.rightvals=[],a.rightvalsId=[],s(),alert(e.message),a.$apply()):alert(e.message)},function(e){alert(e)}):t.server().zjmakerecieveaddRecieveWaydoEdit({updateUser:c,ownershipId:o,recieveType:r,InformationBank:e.InformationBank?e.InformationBank:"",bankNo:e.bankNo?e.bankNo:"",recievePerson:e.guardian?e.guardian:"",relationPhone:e.relationPhone?e.relationPhone:"",address:e.address?e.address:"",idCard:e.idCard?e.idCard:"",relationShip:e.relationShip?e.relationShip:"",agencyFundForm:n||1,agencyFundId:e.agencyFundId?e.agencyFundId:"",id:a.recieveId,monetaryAmount:e.monetaryAmount?e.monetaryAmount:"",transitionalAmount:e.transitionalAmount?e.transitionalAmount:"",relocateCompensateAmount:e.relocateCompensateAmount?e.relocateCompensateAmount:"",signAwardAmount:e.signAwardAmount?e.signAwardAmount:"",decorateCompensateAmount:e.decorateCompensateAmount?e.decorateCompensateAmount:""},function(e){!0===e.result?($(".dialog").hide(),a.addType.InformationBank="",a.addType.bankNo="",a.addType.guardian="",a.addType.relationPhone="",a.addType.address="",a.addType.idCard="",a.addType.relationShip="",a.addType.agencyFundForm="",a.addType.agencyFundId="",s(),alert(e.message),a.$apply()):alert(e.message)},function(e){alert(e)})):void(a.addTypeflag.decorateCompensateAmount=!0):void(a.addTypeflag.signAwardAmount=!0):void(a.addTypeflag.relocateCompensateAmount=!0):void(a.addTypeflag.transitionalAmount=!0):void(a.addTypeflag.monetaryAmount=!0)}a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.addFlag=!0,a.clickdisabled=!0,a.no="-";var c=t.server().userId;a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={projectId:o.params.projectid,roomId:o.params.roomId,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:2,reloadajax:1,locationflag:1},a.adddate=function(e,t){n(e,t,2,function(e){a.saveObj.cardPeriod=e.toString(),a.$apply()})},t.server().zjprojectdeleteById({id:a.projectId,userId:c},function(e){!0===e.result&&(a.project2=e.data.project,a.$apply())}),s(),a.usedata=[],a.links=[],a.uhshifts={relationShip:"业权人",relationPersion:""};a.editInformation=function(e,r){a.ownerTempName="业权人关系图谱",a.usedata=[],a.links=[],t.server().zjownershipqueryOwnerRelationShipdo({id:e},function(e){if(!0===e.result){a.relationdata=e.data,a.relation=e.data.relation,a.uhshifts.relationPersion=a.relationdata.holderName,a.relation.unshift(a.uhshifts);for(var t=0;t<a.relation.length;t++)a.usedata[t]={name:a.relation[t].relationPersion,category:0===t?0:1,draggable:!0},a.links[t]={source:0,target:t+1,value:a.relation[t].relationShip};i(a.usedata,a.links),a.$apply()}else alert(e.message)},function(e){alert(e)})},a.makecoll=function(e,r){a.ownerTempName="联系人关系图谱",a.usedata=[],a.links=[],t.server().zjmakecollectionsqueryRelationShipdo({id:e},function(e){if(!0===e.result){a.relationdata=e.data,a.relation=e.data.relation,a.uhshifts.relationPersion=a.relationdata.holderName,a.relation.unshift(a.uhshifts);for(var t=0;t<a.relation.length;t++)a.usedata[t]={name:a.relation[t].relationPersion,category:0===t?0:1,draggable:!0},a.links[t]={source:0,target:t+1,value:a.relation[t].relationShip};a.$apply(),i(a.usedata,a.links)}else alert(e.message)},function(e){alert(e)})},a.saveObj={id:"",holderId:a.roomId,holderName:"",placeOrigin:"",relationPerson:"",relationPhone:"",address:"",idCard:"",cardPeriod:"",placeIdentity:"",permanentAddress:"",houseArea:"",commerceArea:""},a.saveflag={holderId:!1,holderName:!1,placeOrigin:!1,relationPerson:!1,relationPhone:!1,address:!1,idCard:!1,cardPeriod:!1,placeIdentity:!1,permanentAddress:!1,houseArea:!1,commerceArea:!1},a.blurs=function(e,t){"holderName"==t&&(a.saveflag.holderName=!e),"houseArea"==t&&(a.saveflag.houseArea=!e),"commerceArea"==t&&(a.saveflag.commerceArea=!e),"placeOrigin"==t&&(a.saveflag.placeOrigin=!e),"relationPerson"==t&&(a.saveflag.relationPerson=!e),"relationPhone"==t&&(a.saveflag.relationPhone=!e),"address"==t&&(a.saveflag.address=!e),"permanentAddress"==t&&(a.saveflag.permanentAddress=!e),"idCard"==t&&(a.saveflag.idCard=!e),"cardPeriod"==t&&(a.saveflag.cardPeriod=!e),"placeIdentity"==t&&(a.saveflag.placeIdentity=!e),"monetaryAmount"==t&&(a.addpresonflag.monetaryAmount=!e),"transitionalAmount"==t&&(a.addpresonflag.transitionalAmount=!e),"relocateCompensateAmount"==t&&(a.addpresonflag.relocateCompensateAmount=!e),"signAwardAmount"==t&&(a.addpresonflag.signAwardAmount=!e),"decorateCompensateAmount"==t&&(a.addpresonflag.decorateCompensateAmount=!e),"relationPersion"==t&&(a.addpresonflag.relationPersion=!e),"relationPhone"==t&&(a.addpresonflag.relationPhone=!e),"householdRegister"==t&&(a.addpresonflag.householdRegister=!e),"请选择"==$(".bianjiselect1").find("option:selected").text()&&"relationShip"==t&&(a.addpresonflag.relationShip=!e),"请选择"==$(".bianjiselect2").find("option:selected").text()&&"decisionRelation"==t&&(a.addpresonflag.decisionRelation=!e),"InformationBank"==t&&(a.addTypeflag.InformationBank=!e),"bankNo"==t&&(a.addTypeflag.bankNo=!e),"guardian"==t&&(a.addTypeflag.guardian=!e),"relationPhone"==t&&(a.addTypeflag.relationPhone=!e),"address"==t&&(a.addTypeflag.address=!e),"idCard"==t&&(a.addTypeflag.idCard=!e),"relationShip"==t&&(a.addTypeflag.relationShip=!e),"rightvals"==t&&(a.addTypeflag.rightvals=!e)},a.addPersonsave=function(e){return a.saveObj.holderName?a.saveObj.houseArea?a.saveObj.commerceArea?a.saveObj.placeOrigin?a.saveObj.relationPerson?a.saveObj.relationPhone?a.saveObj.address?a.saveObj.permanentAddress?a.saveObj.idCard?a.saveObj.placeIdentity?(a.clickdisabled&&(a.clickdisabled=!1,"2"==e?t.server().zjownershipupdateSavedo({updateUser:c,holderId:a.saveObj.holderId,holderName:a.saveObj.holderName,houseArea:a.saveObj.houseArea,commerceArea:a.saveObj.commerceArea,placeOrigin:a.saveObj.placeOrigin,relationPerson:a.saveObj.relationPerson,relationPhone:a.saveObj.relationPhone,address:a.saveObj.address,idCard:a.saveObj.idCard,cardPeriod:a.saveObj.cardPeriod,placeIdentity:a.saveObj.placeIdentity,id:a.saveObj.id,permanentAddress:a.saveObj.permanentAddress},function(e){!0===e.result&&($(".other").fadeOut(200),s(),alert("修改成功！"),a.$apply()),0==e.result&&alert(e.message)}):t.server().zjownershipaddSave({createUser:c,holderId:a.roomId,holderName:a.saveObj.holderName,houseArea:a.saveObj.houseArea,commerceArea:a.saveObj.commerceArea,placeOrigin:a.saveObj.placeOrigin,relationPerson:a.saveObj.relationPerson,relationPhone:a.saveObj.relationPhone,address:a.saveObj.address,idCard:a.saveObj.idCard,cardPeriod:a.saveObj.cardPeriod,placeIdentity:a.saveObj.placeIdentity,permanentAddress:a.saveObj.permanentAddress},function(e){!0===e.result&&($(".other").fadeOut(200),s(),alert("添加成功！"),a.$apply()),0==e.result&&alert(e.message)})),void r.timeouts(!1,a.clicktimeoutdata,function(){a.clickdisabled=!0,a.$apply()})):void(a.saveflag.placeIdentity=!0):void(a.saveflag.idCard=!0):void(a.saveflag.permanentAddress=!0):void(a.saveflag.address=!0):void(a.saveflag.relationPhone=!0):void(a.saveflag.relationPerson=!0):void(a.saveflag.placeOrigin=!0):void(a.saveflag.commerceArea=!0):void(a.saveflag.houseArea=!0):void(a.saveflag.holderName=!0)},a.addovwen=function(){a.addOrUpdateTitleName="添加业权人",a.addOrUpdatefalg=1,a.saveflag={},a.saveObj={}},a.updateOwnerAlert=function(e,r){a.saveObj={},a.addOrUpdateTitleName=" 编缉业权人",a.addOrUpdatefalg=2,t.server().zjownershipinitUpdatedo({id:e},function(e){e.result?(a.saveObj.id=e.data.id,a.saveObj.holderId=e.data.holderId,a.saveObj.holderName=e.data.holderName,a.saveObj.houseArea=e.data.houseArea,a.saveObj.commerceArea=e.data.commerceArea,a.saveObj.placeOrigin=e.data.placeOrigin,a.saveObj.relationPerson=e.data.relationPerson,a.saveObj.relationPhone=e.data.relationPhone,a.saveObj.address=e.data.address,a.saveObj.idCard=e.data.idCard,a.saveObj.cardPeriod=e.data.cardPeriod,a.saveObj.placeIdentity=e.data.placeIdentity,a.saveObj.permanentAddress=e.data.permanentAddress,a.$apply()):alert(e.message)})},a.addPersoncance=function(){a.saveObj={}},a.addpreson={relationPersion:"",relationPhone:"",householdRegister:"",relationShip:"",decisionRelation:"",InformationId:"",indxId:""},a.addpresonflag={relationPersion:!1,relationPhone:!1,householdRegister:!1,relationShip:!1,decisionRelation:!1},a.addpresontips=function(e,r,o,n){a.addpreson.indxId=r,a.addpreson.InformationId=e,a.parentIdbianjiIndex=n,t.server().zjkinsfolkinitKinsfolkListdo({},function(e){!0===e.result?(a.relation=e.data.relation,a.makePolicy=e.data.makePolicy,a.$apply()):alert(e.message)},function(e){alert(e)}),1===o?t.server().zjmakecollectionsinitUpdatedo({id:e},function(e){!0===e.result?(a.addpreson.relationPersion=e.data.relationPersion,a.addpreson.relationPhone=e.data.relationPhone,a.addpreson.householdRegister=e.data.householdRegister,a.addpreson.relationShip=e.data.relationShip,a.addpreson.decisionRelation=e.data.decisionRelation,a.bianjiflag=o,a.$apply()):alert(e.message)},function(e){alert(e)}):(a.addpreson.relationPersion="",a.addpreson.relationPhone="",a.addpreson.householdRegister="",a.addpreson.relationShip="",a.addpreson.decisionRelation="",a.bianjiflag="")},a.AddContact=function(e,t){return a.addpreson.relationPersion?a.addpreson.relationPhone?a.addpreson.householdRegister?"请选择"!=$(".bianjiselect1").find("option:selected").text()||a.addpreson.relationShip?"请选择"!=$(".bianjiselect2").find("option:selected").text()||a.addpreson.decisionRelation?void(a.bianjiflag?l(a.addpreson,t):d(a.addpreson)):void(a.addpresonflag.decisionRelation=!0):void(a.addpresonflag.relationShip=!0):void(a.addpresonflag.householdRegister=!0):void(a.addpresonflag.relationPhone=!0):void(a.addpresonflag.relationPersion=!0)},a.delects=function(e,r,o,n){2===o?confirm("确认删除该条业权人吗？",function(){t.server().zjownershipdeleteByIddo({id:e},function(e){!0===e.result?(a.data.splice(r,1),a.$apply(),s()):alert(e.message)})}):confirm("确认删除该条联系人吗？",function(){t.server().zjmakecollectionsdeleteByIddo({id:e},function(e){!0===e.result?(a.data[n].makeCollectionsList.splice(r,1),a.$apply(),s()):alert(e.message)})})},a.addType={InformationBank:"",bankNo:"",guardian:"",relationPhone:"",address:"",idCard:"",relationShip:"",agencyFundForm:"",agencyFundId:"",person:"",monetaryAmount:"",transitionalAmount:"",relocateCompensateAmount:"",signAwardAmount:"",decorateCompensateAmount:""},a.addTypeflag={InformationBank:!1,bankNo:!1,guardian:!1,relationPhone:!1,address:!1,idCard:!1,relationShip:!1,agencyFundForm:!1,relevanceOwner:!1,rightvals:!1,monetaryAmount:!1,transitionalAmount:!1,relocateCompensateAmount:!1,signAwardAmount:!1,decorateCompensateAmount:!1},a.editmoneyInformation=function(e,r){a.ownershipId=e.id,a.isType=e.isType,a.recieveId=e.recieveId,a.addFlag=r,r||t.server().zjmakerecievequeryRecieveInfodo({id:e.recieveId},function(e){!0===e.result?(a.addType.InformationBank=e.data.InformationBank,a.addType.bankNo=e.data.bankNo,a.addType.guardian=e.data.recievePerson,a.addType.relationPhone=e.data.relationPhone,a.addType.idCard=e.data.idCard,a.addType.address=e.data.address,a.addType.relationShip=e.data.relationShip,a.addType.monetaryAmount=e.data.monetaryAmount,a.addType.transitionalAmount=e.data.transitionalAmount,a.addType.relocateCompensateAmount=e.data.relocateCompensateAmount,a.addType.signAwardAmount=e.data.signAwardAmount,
a.addType.decorateCompensateAmount=e.data.decorateCompensateAmount,a.level=e.data.agencyFundForm||1,a.addType.agencyFundId=e.data.agencyFundId,a.$apply()):alert(e.message)}),r?(a.addType={},a.addTypeflag={},a.rightvals=[],a.rightvalsId=[]):1==a.isType?$(".hopmainopen").dialog():2==a.isType?$(".otherhopmainopen").dialog():3==a.isType?$(".guardianhopmainopen").dialog():4==a.isType&&a.fouraboustAsmoney(a.ownershipId,1)},a.moneysave=function(e,t){return a.addType.InformationBank?a.addType.bankNo?void p(a.addType,t,e):void(a.addTypeflag.bankNo=!0):void(a.addTypeflag.InformationBank=!0)},a.moneysave2=function(e,t){return a.addType.guardian?a.addType.relationPhone?a.addType.address?a.addType.idCard?a.addType.InformationBank?a.addType.bankNo?void p(a.addType,t,e):void(a.addTypeflag.bankNo=!0):void(a.addTypeflag.InformationBank=!0):void(a.addTypeflag.idCard=!0):void(a.addTypeflag.address=!0):void(a.addTypeflag.relationPhone=!0):void(a.addTypeflag.guardian=!0)},a.moneysave3=function(e,t){return a.addType.guardian?a.addType.relationShip?a.addType.relationPhone?a.addType.address?a.addType.idCard?a.addType.InformationBank?a.addType.bankNo?void p(a.addType,t,e):void(a.addTypeflag.bankNo=!0):void(a.addTypeflag.InformationBank=!0):void(a.addTypeflag.idCard=!0):void(a.addTypeflag.address=!0):void(a.addTypeflag.relationPhone=!0):void(a.addTypeflag.relationShip=!0):void(a.addTypeflag.guardian=!0)},a.level=1,a.fouraboustAsmoney=function(e,r){t.server().zjmakerecieveinitAdddo({roomId:a.roomId,ownershipId:e},function(e){!0===e.result?(a.ablutePreson=e.data,a.$apply(),$(".h-luohui").dialog()):confirm(e.message,function(){$(".h-luohui").dialog()})})},a.moneysave4=function(e,t){if(!a.addType.agencyFundId)return void(a.addTypeflag.rightvals=!0);p(a.addType,t,e,a.level)}}]).controller("ContractManagementContractManagementCtrl",["$http","$scope","server","dict",function(e,a,t,r){}]).controller("LostPropertyManagementPropertyManagementCtrl",["$http","$scope","server","dict","$state",function(e,a,t,r,o){function n(){t.server().zjrelatedlistdo({roomId:a.roomId},function(e){!0===e.result?(a.datas=e.data,a.$apply()):alert(e.message)},function(e){alert(e)})}function s(){t.server().zjroomsearchForConditiondo({projectId:a.projectId},function(e){if(!0===e.result){a.dataCheckbox=e.data;for(var t=0;t<a.dataCheckbox.length;t++)a.dataCheckbox[t].state=!1;a.$apply()}else alert(e.message)})}function i(e){t.server().zjrelatedqueryRelevancePropertydo({roomId:e},function(e){!0===e.result?(a.datauseid=e.data,a.$apply()):alert(e.message)})}function d(e,r,o){t.server().zjroompropertyListdo({projectId:a.projectId,schemaId:e||"",pageNo:r||1,pageSize:10,roomId:a.roomId},function(e){if(!0===e.result){a.rows=e.data.rows,i(a.roomId);for(var t=a.datauseid?a.datauseid.length:0,r=0;r<a.rows.length;r++)if(a.rows[r].state=!1,a.datauseid&&a.datauseid.length>0)for(var n=0;n<t;n++)a.rows[r].id===a.datauseid[n]&&a.rows.splice(r,1);a.conf.total=Math.ceil((e.data.total-t)/e.data.pageSize),a.conf.counts=e.data.total-t,a.$broadcast("categoryLoaded"),a.$apply(),a.rows&&o&&setTimeout(function(){$(".letbox").dialog()},10)}else alert(e.message)})}function l(e){t.server().zjrelatedaddSavedo({userId:p,roomId:a.roomId,relatedRoomId:e,remaker:a.noteText},function(e){!0===e.result?($(".letbox").hide(200),alert(e.message,function(){a.noteText="",n(),a.$apply()})):alert(e.message)})}a.no="-",a.nothingTips=!1,a.roomId=o.params.roomId,a.projectId=o.params.projectid;var p=t.server().userId;a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:2,reloadajax:1,locationflag:1},a.action={},a.dataFollowUp=function(e){a.action.reset(e)},a.myajax=function(){},a.mylocation=function(){},n(),a.dataDelete=function(e,r){confirm("确认删除吗？",function(){t.server().zjrelateddeleteByIddo({id:e},function(e){!0===e.result?(n(),a.$apply()):alert(e.message)})})},a.conf={total:10,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},a.$watch("conf.currentPage + conf.itemPageLimit",function(e){}),a.selected=[],a.selectAll=!0,a.updateSelection=function(e,t,r){if(e.target.checked)a.selected.push(t);else{var o=a.selected.indexOf(t);a.selected.splice(o,1)}0===a.selected.length?a.selectAll=!0:a.selectAll=!1,d(a.selected.join(","),a.conf.currentPage)},a.checkobxAll=function(e,t){if(!1===e&&0===a.selected.length&&(a.selectAll=!0),!0===e){a.selected=[];for(var r=0;r<a.dataCheckbox.length;r++)a.dataCheckbox[r].state=!1}d(a.selected.join(","),a.conf.currentPage)},a.showBox=function(){s(),d("","",!0)},a.childSelected=[],a.childSelectAll=!1,a.childCheckobxAll=function(e){if(a.childSelected=[],!0===e)for(var t=0;t<a.rows.length;t++)a.rows[t].state=!0,a.childSelected.push(a.rows[t].id);else{for(var r=0;r<a.rows.length;r++)a.rows[r].state=!1;a.childSelected=[]}return a.childSelected},a.childUpdateSelection=function(e,t,r){if(e.target.checked)a.childSelected.push(t);else{var o=a.childSelected.indexOf(t);a.childSelected.splice(o,1)}a.childSelected.length<a.rows.length?a.childSelectAll=!1:a.childSelectAll=!0},a.save=function(){$(".letbox").fadeOut(200),$(".notealert").dialog()},a.notevalue=function(e){$(".notealert").fadeOut(),l(a.childSelected.join(","))}}]).controller("BasicInformationPropertyManagementCtrl",["$http","$scope","server","$state","dict","$rootScope",function(e,a,t,r,o,n){function s(e,t,r,o){laydate.render({elem:"."+e,type:"date",value:(new Date).toLocaleDateString().replace(/\//g,"-"),format:"yyyy-MM-dd",show:!0,closeStop:"."+t,done:function(e){a.beginTime=e,r&&o(e)}})}function i(e){return a.dimArr=[],new Promise(function(r,o){t.server().zjtaskqueryRoomNamedo({param:e,projectId:a.projectId},function(e){e.result?(a.dimArr=e.data,r(e.data),a.$apply()):alert(e.message)})})}function d(e){return a.personarr=[],new Promise(function(r,o){t.server().zjtaskqueryUserNamedo({realname:e},function(e){e.result?(a.personarr=e.data,r(e.data),a.$apply()):alert(e.message)})})}function l(e,r){a.threeshowArr=[],g=[],a.bodyDataArr.forEach(function(e,t){a.bodyDataArr[t].clickClass=!1}),t.server().zjtaskqueryUserInfoByUserIddo({userId:t.server().userId,time:r},function(e){if(e.result){if(a.taskquery=e.data,a.taskquery){a.yearmonthdata=o.timeConverter3(a.taskquery[0].startTime,1);for(var t=0;t<a.taskquery.length;t++){a.taskquery[t].startTime=o.timeConverter3(a.taskquery[t].startTime),a.taskquery[t].endTime=o.timeConverter3(a.taskquery[t].endTime);for(var r=a.taskquery[t].startTime;r<a.taskquery[t].endTime+1;r++)a.threeshowArr.push(r)}for(var n=0;n<a.bodyDataArr.length;n++)for(var s=0;s<a.threeshowArr.length;s++)a.bodyDataArr[n].id===a.threeshowArr[s]&&(a.bodyDataArr[n].flagClass=!0)}a.$apply()}else alert(e.message)})}function p(e,a){return e-a}function c(){t.server().zjpropertystagelistdo({roomId:a.roomId,type:u},function(e){!0===e.result?(a.signList=e.data,a.signList.forEach(function(e,t){if("签约"!=a.signList[t].name)return!1;a.signList[t].sublevel&&a.signList[t].sublevel.length>0&&a.signList[t].sublevel.forEach(function(e,r){"未签约"==a.signList[t].sublevel[r].name?a.signList[t].sublevel[r].flag=!0:"已签约"==a.signList[t].sublevel[r].name?a.signList[t].sublevel[r].flag=!0:a.signList[t].sublevel[r].flag=!1})}),a.$apply()):alert(e.message)},function(e){alert(e)})}a.projectId=r.params.projectid,a.submitTime={},a.roomId=r.params.roomId;var m=t.server().userId,u=(r.params.roomId,r.params.roomId,""),f=t.server().userId;a.list={roomId:r.params.roomId,projectId:r.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={projectId:r.params.projectid,roomId:r.params.roomId,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:2,reloadajax:1,locationflag:1},t.server().zjprojectdeleteById({id:a.projectId,userId:m},function(e){!0===e.result&&e.data.project?(a.project2=e.data.project,a.$apply(),resolve(e.data.project)):alert(e.message)}),t.server().zjtaskinitOrderSignNodedo({},function(e){e.result?(a.initOrder=e.data,a.$apply()):alert(e.message)}),a.regCreatetaskist=function(e,t){a.add.parentOption=t.orderSignId,a.parentOption=t.name,e&&(a.add.childOption=e.orderSignId,a.childOption=e.name),a.registFlag=1,a.add.peopel="",a.peopelArr="",a.personArr="",a.add.person="",a.add.date="",a.add.things="",g=[],$(".addchildData1").val(""),$(".h-liebiaoone").dialog()},a.add={peopel:"",person:"",parentOption:"",childOption:"",date:"",things:""},a.peopelArr="",a.personArr="",a.dimArrFlag=!1,a.personarrFlag=!1,a.addflag={peopel:!1,person:!1,select:!1,things:!1},a.addfocus=function(e,t){t?d(e).then(function(e){e.length>0?a.personarrFlag=!0:a.personarrFlag=!1,a.addflag.person=!1,a.$apply()}):(i(e).then(function(e){e.length>0?a.dimArrFlag=!0:a.dimArrFlag=!1,a.addflag.peopel=!1,a.$apply()}),a.addflag.peopel=!1)},a.addblur=function(e,t){t?setTimeout(function(){a.personarrFlag=!1,a.add.person?a.addflag.person=!1:a.addflag.person=!0,a.$apply()},200):setTimeout(function(){a.dimArrFlag=!1,a.add.peopel?a.addflag.peopel=!1:a.addflag.peopel=!0,a.$apply()},200)},a.addchange=function(e,t){t?(d(e).then(function(e){e.length>0?a.personarrFlag=!0:a.personarrFlag=!1,a.$apply()}),a.addflag.person=!1):(i(e).then(function(e){e.length>0?a.dimArrFlag=!0:a.dimArrFlag=!1,a.$apply()}),a.addflag.peopel=!1)},a.alertliAdd=function(e,t){t?(a.add.person=a.personarr[e].realname,a.personArr=a.personarr[e].id):(a.add.peopel=a.dimArr[e].splitJointName,a.peopelArr=a.dimArr[e].id)},a.addsBlur=function(e){a.addflag.things=!e},a.adddate=function(e,t){s(e,t,2,function(e){a.add.date=e,l(a.add.person,e),a.$apply()})},a.bodyDataArr=[{id:8,name:"08:00",flagClass:!1,msg:"",clickClass:!1},{id:9,name:"09:00",flagClass:!1,msg:"",clickClass:!1},{id:10,name:"10:00",flagClass:!1,msg:"",clickClass:!1},{id:11,name:"11:00",flagClass:!1,msg:"",clickClass:!1},{id:12,name:"12:00",flagClass:!1,msg:"",clickClass:!1},{id:13,name:"13:00",flagClass:!1,msg:"",clickClass:!1},{id:14,name:"14:00",flagClass:!1,msg:"",clickClass:!1},{id:15,name:"15:00",flagClass:!1,msg:"",clickClass:!1},{id:16,name:"16:00",flagClass:!1,msg:"",clickClass:!1},{id:17,name:"17:00",flagClass:!1,msg:"",clickClass:!1},{id:18,name:"18:00",flagClass:!1,msg:"",clickClass:!1},{id:19,name:"19:00",flagClass:!1,msg:"",clickClass:!1},{id:20,name:"20:00",flagClass:!1,msg:"",clickClass:!1}];var g=[];Array.prototype.removeByValue=function(e){for(var a=0;a<this.length;a++)if(this[a]==e){this.splice(a,1);break}},a.datachoose=function(e){if(!1===a.bodyDataArr[e].flagClass&&(a.bodyDataArr[e].clickClass=!a.bodyDataArr[e].clickClass,!0===a.bodyDataArr[e].clickClass?g.push(e):g.removeByValue(e),g.length>=2)){g=g.sort(p);for(var t=g[0];t<g[g.length-1]+1;t++){if(!0===a.bodyDataArr[t].flagClass)return a.bodyDataArr[e].clickClass=!1,void g.pop();a.bodyDataArr[t].clickClass=!0}}},a.addsave=function(e,r){if(2===r){if(!a.add.person)return void(a.addflag.person=!0);if(a.addflag.person=!1,!a.add.date)return void alert("请选择指派时间！");if(a.addflag.date=!1,g.length<=0)return void alert("请选择可用时间段！");if(a.startDate=a.add.date+" "+a.bodyDataArr[g[0]].name,a.endDate=a.add.date+" "+a.bodyDataArr[g[g.length-1]].name,!a.add.things)return void(a.addflag.things=!0);a.addflag.things=!1,t.server().zjtaskupdateTaskdo({toUser:a.add.person,startDate:a.startDate,endDate:a.endDate,eventDesc:a.add.things,userId:a.personArr,id:a.rows[e].id},function(e){e.result?($(".h-liebiaoone").fadeOut(200),a.add.peopel="",a.peopelArr="",a.add.childOption="",a.add.parentOption="",a.personArr="",a.add.person="",a.add.date="",a.add.things="",g=[],alert("发布成功！",function(){c()}),a.$apply()):alert(e.message)})}else{if(!a.add.peopel)return void(a.addflag.peopel=!0);if(a.addflag.peopel=!1,!a.add.person)return void(a.addflag.person=!0);if(a.addflag.person=!1,!a.add.date)return void alert("请选择指派时间！");if(a.addflag.date=!1,g.length<=0)return void alert("请选择可用时间段！");if(a.startDate=a.add.date+" "+a.bodyDataArr[g[0]].name,a.endDate=a.add.date+" "+a.bodyDataArr[g[g.length-1]].name,!a.add.things)return void(a.addflag.things=!0);a.addflag.things=!1,t.server().zjtaskaddTask({roomId:a.peopelArr,processId:a.add.childOption,toUser:a.add.person,startDate:a.startDate,endDate:a.endDate,eventDesc:a.add.things,userId:a.personArr,createUser:m,eventNode:a.add.parentOption},function(e){e.result?(a.add.peopel="",a.peopelArr="",a.add.childOption="",a.add.parentOption="",a.personArr="",a.add.person="",a.add.date="",a.add.things="",g=[],alert("发布成功！",function(){c()}),$(".h-liebiaoone").fadeOut(200),a.$apply()):alert(e.message)})}},t.server().zjroomessentialInformationdo({roomId:a.roomId},function(e){!0===e.result?(a.ownership=e.data.ownership,a.room=e.data.room,a.room.createTime=o.timeConverter(a.room.createTime),a.room.updateTime=o.timeConverter(a.room.updateTime),e.data.surveyData&&(a.grossArea=e.data.surveyData.grossArea,a.areaOfBase=e.data.surveyData.areaOfBase,a.single=e.data.surveyData.single,a.survey=e.data.surveyData.survey),a.$apply()):alert(e.message)},function(e){alert(e)}),a.showTime=function(e,t){$(".hopbntshare2").dialog(),a.submitTime.id=e.id,a.textareaTextflag=!!t},a.addTime=function(){laydate.render({elem:".childData1",format:"yyyy-MM-dd",show:!0,closeStop:".parentData1",done:function(e){a.submitTime.accomplishTime=e}})},a.submitTime=function(){t.server().lgcSetDataUpdateAccomplishTime({roomId:a.roomId,id:a.submitTime.id,accomplishTime:a.submitTime.accomplishTime,cause:a.submitTime.textareaText||"",userId:f},function(e){e.result?(c(),alert(e.message,function(){a.submitTime.accomplishTime="",$(".childData1").val("")}),a.$apply()):alert(e.message)})},t.server().zjbasicCompensateInfodo({propertyId:a.roomId,cause:""},function(e){!0===e.result?(a.monthlyInterimCompensate=e.data.monthlyInterimCompensate,a.totalMoneyCompensate=e.data.totalMoneyCompensate,a.compensateItemList=e.data.compensateItemList,a.builtInAreaList=e.data.builtInAreaList,a.$apply()):alert(e.message)},function(e){alert(e)}),c()}]).controller("totalPropertyListCtrl",["$http","$scope","server","dict","$state","$rootScope",function(e,a,t,r,o,n){function s(){t.server().projectnamesel({projectId:a.projectId},function(e){!0===e.result&&(a.projectname=e.data.projectName,a.number=e.data.number,a.$apply())})}function i(e){a.getSelectCheckBox();var r=c.toString();l=p.toString(),c.length=0,p.length=0,t.server().showPropertyByAreado({userId:d,projectId:a.projectId,schemaId:l,signId:r,searchKeys:a.projectnameinput,pageNo:a.conf.currentPage,pageSize:a.conf.itemPageLimit},function(e){!0===e.result&&(a.datas=e.data.rows,a.conf.total=e.data.pageCount,a.total=e.data.total,a.conf.counts=e.data.total,a.$broadcast("categoryLoaded")),a.$apply()},function(e){alert(e)})}a.projectId=o.params.projectid;var d=t.server().userId,l="",p=[],c=[];a.projectnameinput="",a.nos="-",a.list={projectId:o.params.projectid,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:1},a.listtop={projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:2,reloadajax:1,locationflag:1},a.applypact=function(e){window.localStorage.setItem("sbstatus",a.datas[e].sbStatus)},a.action={},a.dataFollowUp=function(e){a.roomId=e,a.action.reset(e)},a.transferclick={},a.gcShowWin=function(e){a.transferclick.reset(e)},a.myajax=function(){},a.mylocation=function(){},t.server().zjprojectprojectDetaileddo({projectId:a.projectId},function(e){e.result&&e.data.follow&&0==e.data.follow.status&&(a.follow=!0)}),a.changeFollow=function(e){if(e){var r={projectId:a.projectId,creatorUser:d,type:30};r.userJson=JSON.stringify([{toUserId:d}]),t.server().lgcMainInfosharedtransferconSave(r,function(e){},function(){})}},t.server().zjroomessentialInformationdo({schemaId:a.projectId},function(e){}),a.conf={total:10,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},s(),a.searchInput=function(e){i()},t.server().showPropertyConditionsdo({projectId:a.projectId},function(e){!0===e.result&&(a.porpertyConditions=e.data),a.$apply()}),t.server().showSignNodedo({},function(e){!0===e.result&&(a.nodeSign=e.data.signList),a.$apply()}),a.$watch("conf.currentPage + conf.itemPageLimit+projectnameinput",function(e){i(a.projectnameinput)}),a.doChange=function(e,a){var t=$('input[name="'+e+'"]:checkbox').length,r=$('input[name="'+e+'"]:checked').length;$('input[name="'+a+'"]:checkbox')[0].checked=t==r,i()},a.selectedAll=function(e){$('input[name="'+e+'s"]:checkbox').is(":checked")?$('input[name="'+e+'"]:checkbox').each(function(e){this.checked=!0}):$('input[name="'+e+'"]:checkbox').each(function(e){this.checked=!1}),i()},a.getSelectCheckBox=function(){$('input[name="con"]:checked').each(function(){p.push($(this)[0].id)}),$('input[name="area"]:checked').each(function(){c.push($(this)[0].id)})},a.dopropertyDelete=function(e){confirm("删除当前物业？",function(){t.server().zjroomdeleteByIddo({id:e,userId:d},function(e){!0===e.result?alert(e.message,function(){i(),s(),a.$apply()}):alert(e.message)})})}}]).controller("projectManagementExportCtrl",["$http","$scope","server","dict","$state",function(e,a,t,r,o){a.projectId=o.params.projectid,t.server().projectnamesel({projectId:a.projectId},function(e){!0===e.result&&(a.projectname=e.data.projectName,a.number=e.data.number,a.$apply())}),t.server().showNoSignPropertydo({projectId:a.projectId},function(e){!0===e.result?(a.datas=e.data.rows,a.$apply()):alert(e.message)}),t.server().showNoSignCasesdo({projectId:a.projectId},function(e){!0===e.result?a.conditions=e.data.causeList:alert(e.message)}),a.doChange=function(){$('input[name="cause"]:checkbox').length!=$('input[name="cause"]:checked').length?$('input[name="causes"]:checkbox')[0].checked=!1:$('input[name="causes"]:checkbox')[0].checked=!0;var e=[];$('input[name="cause"]:checked').each(function(a){e.push($(this)[0].id)}),a.dosearcher(e.toString()),e=[]},a.selectedAll=function(){$('input[name="causes"]:checkbox').is(":checked")?$('input[name="cause"]:checkbox').each(function(e){this.checked=!1}):$('input[name="cause"]:checkbox').each(function(e){this.checked=!0});var e=[];$('input[name="cause"]:checked').each(function(a){e.push($(this)[0].id)}),a.dosearcher(e.toString()),e=[]},a.dosearcher=function(e){t.server().showNoSignPropertydo({projectId:a.projectId,cause:e},function(e){!0===e.result&&(a.datas=e.data.rows),a.$apply()},function(e){alert(e)})}}]).controller("DeferredCompensationCtrl",["$http","$scope","server","dict","$state",function(e,a,t,r,o){}]).controller("CommissionProjectCtrl",["$http","$scope","server","dict","$state",function(e,a,t,r,o){}]).controller("PropertyDismantleCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){function s(){var e=n.defer();return t.server().projectnamesel({projectId:a.projectId},function(a){!0===a.result&&e.resolve(a.data)}),e.promise}function i(e,r,o,n){t.server().zjroomqueryPropertyDismanInfodo({projectId:a.projectId,schemaId:e||"",pageNo:r||1,pageSize:10,isAccomplish:o,id:n},function(e){!0===e.result?(a.rows=e.data.rows,a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$apply(),a.$broadcast("categoryLoaded")):alert(e.message)},function(e){alert(e)})}var d=setInterval(function(){$(".l-nav>li").length>0&&($(".l-nav>li").eq(9).addClass("cur"),clearInterval(d))},10);a.projectId=o.params.projectid;t.server().userId;a.isAccomplish=2,a.searchVal="",a.no="-",a.PullUpShow=!0,a.PullUpText="收起",a.pullUp=function(){a.PullUpShow?(a.PullUpShow=!1,a.PullUpText="展开"):(a.PullUpShow=!0,a.PullUpText="收起")},a.list={projectId:o.params.projectid,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:1},a.listtop={projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},a.action={},a.dataFollowUp=function(e){a.roomId=e,a.action.reset(e)},a.transferclick={},a.gcShowWin=function(e){a.transferclick.reset(e)},a.myajax=function(){},a.mylocation=function(){o.go("DemolitionDetails",{projectid:a.projectId,roomId:a.roomId})},a.conf={total:3,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},function(){var e=n.defer();return t.server().zjroominitOrderSigndo({},function(t){!0===t.result&&(a.nameid=t.data.id,e.resolve(t.data.id))},function(a){e.reject(a),alert(a)}),e.promise}().then(function(e){return i("",1,2,e),a.itemdetailflag=!0,s()}).then(function(e){a.projectname=e.projectName,a.number=e.number}),a.search=function(){i(a.searchVal.trim(),a.conf.currentPage,a.isAccomplish,a.nameid)},a.$watch("conf.currentPage + conf.itemPageLimit",function(e){i(a.searchVal,a.conf.currentPage,a.isAccomplish,a.nameid)}),a.radios=function(e){i(a.searchVal,a.conf.currentPage,e,a.nameid)}}]).controller("DemolitionDetailsCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.no="-";t.server().userId;a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost,projectflag:2}}]).controller("DemolitioninformationCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){function s(){var e=n.defer();return t.server().zjroomqueryPropertyDismantledo({propertyId:a.roomId},function(t){!0===t.result?e.resolve(t):e.reject(t.message),a.$apply()}),e.promise}function i(e,a){return new Promise(function(t,r){laydate.render({elem:"."+e,type:"datetime",value:new Date,format:"yyyy-MM-dd HH:mm:ss",show:!0,closeStop:"."+a,done:function(e){t(e)}})})}var d=t.server().userId;a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.no="-",a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost},s().then(function(e){a.showdate=e.data[0]}),a.addTime=function(e,a){$("."+a).show(),i(e,a).then(function(e){})},a.submitTime=function(e,r){var o=$("."+r).val();if(!o)return void alert("请选择时间！");switch(e){case"waterNetCancelTime":var n={propertyId:a.roomId,createUser:d,waterNetCancelTime:o};break;case"hosueCancelTime":var n={propertyId:a.roomId,createUser:d,hosueCancelTime:o};break;case"earthCancelTime":var n={propertyId:a.roomId,createUser:d,earthCancelTime:o}}t.server().zjpropertydismantleaddPropertyDismantledo(n,function(e){!0===e.result?(alert(e.message),s().then(function(e){a.showdate=e.data[0]})):alert(e.message),a.$apply()})}}]).controller("DemolitionMapingInfromationCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.no="暂无数据",a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.hostname=t.server().host;t.server().userId;a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost}}]).controller("DemolitionOwnerCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.roomId=o.params.roomId,a.projectId=o.params.projectid,a.no="-";t.server().userId;a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost}}]).controller("DemolitionAttachmentCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){t.server().userId;a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.no="-",a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost}}]).controller("handOverPropertyCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){function s(){var e=n.defer();return t.server().projectnamesel({projectId:a.projectId},function(a){!0===a.result&&e.resolve(a.data)}),e.promise}function i(e,r,o,n,s,i){t.server().zjqueryPropertyTransferdo({projectId:a.projectId,schemaId:e||"",pageNo:r||1,pageSize:10,proTransfferId:o,waterTransfferId:n,proTransfferType:s,waterTransfferType:i},function(e){!0===e.result&&(a.rows=e.data.rows,a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$broadcast("categoryLoaded"),a.$apply())})}var d=setInterval(function(){$(".l-nav>li").length>0&&($(".l-nav>li").eq(8).addClass("cur"),clearInterval(d))},10);a.projectId=o.params.projectid;t.server().userId;a.PullUpShow=!0,a.PullUpText="收起",a.pullUp=function(){a.PullUpShow?(a.PullUpShow=!1,a.PullUpText="展开"):(a.PullUpShow=!0,a.PullUpText="收起")},a.list={projectId:o.params.projectid,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:1},a.listtop={projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},a.action={},a.dataFollowUp=function(e){a.roomId=e,a.action.reset(e)},a.transferclick={},a.gcShowWin=function(e){a.transferclick.reset(e)},a.myajax=function(){},a.mylocation=function(){o.go("handOverDetails",{projectid:a.projectId,roomId:a.roomId})},a.isAccomplish="2",a.iswater="2",a.searchVal="",a.no="-",a.conf={total:3,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},function(){var e=n.defer();return t.server().zjroomgetInitProTrando({},function(t){!0===t.result?(a.nameid=t.data[0].id,a.roomName=t.data[0].name,a.waterid=t.data[1].id,a.waterName=t.data[1].name,e.resolve(t.data)):alert(t.message)}),e.promise}().then(function(e){return i("",1,e[0].id,e[1].id,2,2),s()}).then(function(e){a.projectname=e.projectName,a.number=e.number}),a.search=function(){i(a.searchVal.trim(),a.conf.currentPage,a.nameid,a.waterid,a.isAccomplish,a.iswater)},a.$watch("conf.currentPage + conf.itemPageLimit",function(){i(a.searchVal,a.conf.currentPage,a.nameid,a.waterid,a.isAccomplish,a.iswater)}),a.radios=function(e,t){a.isAccomplish=e,t&&2!=a.iswater&&(a.iswater="2"),i(a.searchVal,a.conf.currentPage,a.nameid,a.waterid,e,a.iswater)},a.watchradio=function(e,t){a.iswater=e,console.log(a.isAccomplish),t&&2!=a.isAccomplish&&(a.isAccomplish="2"),i(a.searchVal,a.conf.currentPage,a.nameid,a.waterid,a.isAccomplish,e)}}]).controller("handOverDetailsCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.no="-";t.server().userId;a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:2,reloadajax:1,locationflag:1}}]).controller("handOverInformationCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){function s(){var e=n.defer();return t.server().zjqueryTransferInfodo({propertyId:a.roomId},function(t){!0===t.result?e.resolve(t):alert(t.message),a.$apply()}),e.promise}function i(e,a){return new Promise(function(t,r){laydate.render({elem:"."+e,type:"datetime",value:new Date,format:"yyyy-MM-dd HH:mm:ss",show:!0,closeStop:"."+a,done:function(e){t(e)}})})}var d=t.server().userId;a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.no="-",a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost},s().then(function(e){a.showdate=e.data[0]}),a.addTime=function(e,a,t){var r=t.target;$(r).next().fadeIn(200),1!=e&&i(e,a).then(function(e){})},a.submitTime=function(e,r){var o=$("."+r).val(),n={};switch(e){case"waterAccount":if(!o)return void alert("未输入账户名！");n.propertyId=a.roomId,n.waterAccount=o,n.createUser=d;break;case"powerAccount":if(!o)return void alert("未输入账户名！");n.propertyId=a.roomId,n.powerAccount=o,n.createUser=d;break;case"waterPowerTime":if(!o)return void alert("请选择时间！");n.propertyId=a.roomId,n.waterPowerTime=o,n.createUser=d;break;case"propertyTransferTime":if(!o)return void alert("请选择时间！");n.propertyId=a.roomId,n.propertyTransferTime=o,n.createUser=d}t.server().zjpropertyinfoaddWaterPowerTransferdo(n,function(e){!0===e.result?(alert(e.message),s().then(function(e){a.showdate=e.data[0]})):alert(e.message),a.$apply()})}}]).controller("handOverMapCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.no="暂无数据",a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.hostname=t.server().host;t.server().userId;a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost},Promise.all([function(){return new Promise(function(e,r){t.server().surveyingList({roomId:a.roomId,type:2},function(t){!0===t.result?(a.surveyingList=t.data,a.$apply(),e(a.surveyingList)):alert(t.message)})})}()]).then(function(e){return e},function(e){})}]).controller("handOverOwnerCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.roomId=o.params.roomId,a.projectId=o.params.projectid,a.no="-";t.server().userId;a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost}}]).controller("handOverAttachmentCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){t.server().userId;a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.no="-",a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost}}]).controller("propertyBuiltCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){function s(e,r,o,n){t.server().zjroomqueryPropertyBuildInfodo({projectId:a.projectId,searchKeys:e||"",pageNo:r||1,pageSize:10,period:o},function(e){!0===e.result?(a.rows=e.data.rows,a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$apply(),a.$broadcast("categoryLoaded")):alert(e.message)},function(e){alert(e)})}var i=setInterval(function(){$(".l-nav>li").length>0&&($(".l-nav>li").eq(10).addClass("cur"),clearInterval(i))},10);a.projectId=o.params.projectid;t.server().userId;a.isAccomplish="",a.searchVal="",a.no="-",a.PullUpShow=!0,a.PullUpText="收起",a.pullUp=function(){a.PullUpShow?(a.PullUpShow=!1,a.PullUpText="展开"):(a.PullUpShow=!0,a.PullUpText="收起")},a.list={projectId:o.params.projectid,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:1},a.listtop={projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},a.action={},a.dataFollowUp=function(e){a.roomId=e,a.action.reset(e)},a.transferclick={},a.gcShowWin=function(e){a.transferclick.reset(e)},a.myajax=function(){},a.mylocation=function(){o.go("builtDetails",{projectid:a.projectId,roomId:a.roomId})},a.conf={total:3,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},function(){t.server().projectnamesel({projectId:a.projectId},function(e){!0===e.result&&(a.projectname=e.data.projectName,a.number=e.data.number)})}(),a.chockboxArr=[],function(e,r){t.server().zjroominitBuildOrderSigndo({},function(t){!0===t.result&&(a.nameid=t.data.orderSign.id,a.myarr=t.data.stillBuiltList,
a.myarr&&a.myarr.length>0&&a.myarr.forEach(function(e,t){a.chockboxArr[t]={status:!1,name:a.myarr[t]}}),e&&r(a.nameid))},function(e){alert(e)})}(),a.search=function(){s(a.searchVal.trim(),a.conf.currentPage,a.isAccomplish,a.nameid)},a.$watch("conf.currentPage + conf.itemPageLimit",function(e){s(a.searchVal,a.conf.currentPage,a.isAccomplish,a.nameid)}),a.radios=function(e,t){a.isAccomplish=a.chockboxArr[t].name||"",s(a.searchVal,a.conf.currentPage,a.isAccomplish,a.nameid)},a.radiosall=function(){s(a.searchVal,a.conf.currentPage,"",a.nameid)}}]).controller("builtDetailsCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.no="-";t.server().userId;a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.imgHost=t.server().imgHost,a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost,questiontype:4,projectflag:2,reloadajax:1,locationflag:1}}]).controller("builtInformationCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){function s(e,t){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,closeStop:"."+t,done:function(e){a.repayingStartTime=e,a.$apply()}})}function i(e,a,t,r){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,closeStop:"."+a,done:function(e){r(e)}})}function d(e){t.server().lgcMainInfobuiltinfo({propertyId:m,pageSize:10,pageNo:e||1},function(e){e.result?(a.rows=e.data.rows,a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$broadcast("categoryLoaded"),a.$apply()):alert(e.message)})}function l(e,a){return new Promise(function(t,r){laydate.render({elem:"."+e,type:"datetime",value:new Date,format:"yyyy-MM-dd HH:mm:ss",show:!0,closeStop:"."+a,done:function(e){t(e)}})})}var p,c=t.server().userId,m=o.params.roomId;a.hostname=t.server().imgHost,a.checkbox=[],a.agreeTime=null,a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.rows=[],a.no="请添加",a.obj={},a.nos="暂无数据",a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost},a.edit=function(e,t){for(var r in a.rows)a.rows[r].flagArr=[!1,!1,!1,!1];null!=t&&(a.rows[e].flagArr[t]=!0)},a.conf={total:3,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},a.$watch("conf.currentPage + conf.itemPageLimit",function(){d(a.conf.currentPage)}),a.look=function(e){a.repayingStartTime=a.rows[e].repayingStartTime||a.nos,a.repayingEndTime=a.rows[e].repayingEndTime||a.nos,a.movingInventory=a.rows[e].movingInventory||a.nos,a.assetEvaluation=a.rows[e].assetEvaluation||a.nos,a.fileArr=a.rows[e].attachmentList,$(".industrialshow").dialog()},a.fileArrNew=[],a.editupdate=function(e){a.builtInfoId=a.rows[e].builtInfoId,a.adduseId=a.rows[e].id,a.repayingStartTime=a.rows[e].repayingStartTime||a.nos,a.repayingEndTime=a.rows[e].repayingEndTime||a.nos,a.movingInventory=a.rows[e].movingInventory||a.nos,a.assetEvaluation=a.rows[e].assetEvaluation||a.nos,a.fileArr=a.rows[e].attachmentList,$(".editupdate").dialog()},a.addupdate=function(e){a.adduseId=a.rows[e].id,a.fileArr=[],a.repayingStartTime="",a.repayingEndTime="",a.movingInventory="",a.assetEvaluation="",$(".industrialPlant").dialog()},a.alertData=function(e,t,r){1===r?s(e,t):a.repayingStartTime?i(e,t,a.repayingStartTime,function(e){e?(a.repayingStartTime=a.repayingStartTime.toString(),a.repayingEndTime=e.toString(),a.$apply()):alert("请选择结束时间")}):alert("请选择开始时间")},a.fileArr=[],a.fileNameChanged=function(r){var o=new FormData,n=r.target;if(n.files[0]){var s=n.files[0],i=s.name.slice(s.name.lastIndexOf(".")+1).toLowerCase();if("xls"!=i&&"xlsx"!=i&&"csv"!=i)return n.value="",alert("只能上传Excle文件"),!1;o.append("multipartFile",s),e({method:"POST",url:t.server().imgHost+"attachment/fielUpload.do",data:o,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){n.value="",e.data.result?a.fileArr.push(e.data.data):alert(e.message)}),a.$apply()}},a.fileArrDel=function(e){a.fileArr.splice(e,1)},a.addsave=function(){a.attachments=[],a.fileArr.length>0&&a.fileArr.forEach(function(e,t){a.attachments[t]={filePath:a.fileArr[t].filePath,fileName:a.fileArr[t].fileName,size:a.fileArr[t].size}}),t.server().lgcMainInfoAddBuiltInfo({createUser:c,type:a.adduseId,propertyId:m,repayingTenantsStartTime:a.repayingStartTime||"",repayingTenantsEndTime:a.repayingEndTime||"",movingInventory:a.movingInventory||"",assetEvaluation:a.assetEvaluation||"",urls:a.attachments.length>0?JSON.stringify(a.attachments):"",id:a.builtInfoId?a.builtInfoId:""},function(e){e.result?(alert(e.message,function(){a.fileArr=[],a.repayingStartTime="",a.repayingEndTime="",a.movingInventory="",a.assetEvaluation="",$(".zjchildData2").val(""),$(".zjchildData1").val(""),d(),a.$apply()}),$(".industrialPlant").fadeOut(200),$(".editupdate").fadeOut(200)):alert(e.message,function(){a.fileArr=[]})})};a.submit=function(e,r){var o={propertyId:m,createUser:c,type:r};if(!a.obj[e])return void alert("请输入添加内容");o[e]=a.obj[e],t.server().lgcMainInfoAddBuiltInfo(o,function(e){e.result?(d(),alert(e.message),a.obj={}):alert(e.message)},function(){alert("网络请求失败")})},a.selTime=function(e){$(".hopbntshare2").dialog(),t.server().lgcMainInfoInitFinancialInfo({propertyId:m},function(e){a.financialList=e.data,a.$apply()},function(){alert("网络请求失败")}),p=e},a.addTime=function(e,a){$("."+a).show(),l(e,a).then(function(e){})},a.isTime=function(e){var t=$("."+e).val();a.agreeTime=t},a.submitFinancial=function(){function e(){r.agreeTime=a.agreeTime,t.server().lgcMainInfoAddBuiltInfo(r,function(e){$(".hopbntshare2").hide(),e.result?(d(),alert(e.message),a.agreeTime=null):alert(e.message)},function(){alert("网络请求失败")})}var r={propertyId:m,createUser:c,type:p,retentionName:[]};if(!a.agreeTime)return void alert("请选择时间");var o=!0,n=!1,s=void 0;try{for(var i,l=a.financialList[Symbol.iterator]();!(o=(i=l.next()).done);o=!0){var u=i.value;u.checkbox&&r.retentionName.push({id:u.financialId})}}catch(e){n=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(n)throw s}}if(0==r.retentionName.length)return void alert("请选择截留款项目");r.retentionName=JSON.stringify(r.retentionName),t.server().lgcMainInfoInitAmount({jsonId:r.retentionName},function(a){r.retentProjectMoney=a.data,e()},function(){alert("请求失败")})}}]).controller("builtOwnerCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.roomId=o.params.roomId,a.projectId=o.params.projectid,a.no="-";t.server().userId;a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost}}]).controller("builtCompensateCtrl",["$http","$scope","server","$state","dict","$rootScope",function(e,a,t,r,o,n){a.roomId=r.params.roomId,a.projectId=r.params.projectid;t.server().userId;a.no="-",a.list={roomId:r.params.roomId,projectId:r.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:r.params.roomId,projectId:r.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost}}]).controller("builtAttachmentCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){t.server().userId;a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.no="-",a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.listtop={roomId:o.params.roomId,projectId:o.params.projectid,createUser:t.server().userId,imgHost:t.server().imgHost}}]).controller("myJobCtrl",["$http","$scope","server","dict","$state","$q","$cookieStore","$rootScope",function(e,a,t,r,o,n,s,i){function d(e){a.dimArr=[],t.server().zjindexassignmentinitAdddo({searchKeys:e||""},function(e){e.result&&(a.dimArr=e.data,a.$apply())})}function l(e,r){t.server().zjindexassignmentaddSavedo({createUser:a.userId,organizationId:e.organizationId,userId:e.userId,january:e.january,february:e.february,march:e.march,april:e.april,may:e.may,june:e.june,july:e.july,august:e.august,september:e.september,october:e.october,november:e.november,december:e.december},function(e){e.result?(a.alertUpdateArr.flag,a.alertRows.unshift(a.alertUpdateArr),a.alertUpdateArr=[],a.$apply(),alert("保存成功！",function(){p(a.searchKeys,a.conf.currentPage),a.$apply()})):alert(e.message)})}function p(e,r){t.server().zjindexassignmentlistdo({userId:a.userId,searchKeys:e||"",pageNo:r||1,pageSize:10},function(e){e.result?(a.alertRows=e.data.rows,a.alertRows.forEach(function(e,t){a.alertRows[t].flag=1}),a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$apply(),a.$broadcast("categoryLoaded")):alert(e.message)})}function c(e){t.server().zjindexassignmentupdateSavedo({id:e.id,updateUser:a.userId,organizationId:e.organizationId,userId:e.userId,january:e.january,february:e.february,march:e.march,april:e.april,may:e.may,june:e.june,july:e.july,august:e.august,september:e.september,october:e.october,november:e.november,december:e.december},function(e){e.result?(alert("修改成功！"),a.alertUpdateArr.flag,a.alertRows.unshift(a.alertUpdateArr),a.alertUpdateArr=[],a.$apply()):alert(e.message)})}function m(e,t,r,o){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,min:"2010-8-11",closeStop:"."+t,done:function(e){a.beginTime=e,r&&o(e)}})}function u(e,a,t,r){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,closeStop:"."+a,done:function(e){r(e)}})}function f(e,r,o,n,s){a.rows1="",a.rows2="",t.server().zjtaskqueryTrackingInformationdo({createUser:a.userId,type:e,beginTime:r||"",endTime:o||"",dayCount:n||"",export:"",pageNo:s||1,pageSize:5},function(t){!0===t.result&&t.data.rows&&("1"==e?(a.rows1=t.data.rows,a.conf.total=Math.ceil(t.data.total/t.data.pageSize),a.conf.counts=t.data.total,a.$broadcast("categoryLoaded")):(a.rows2=t.data.rows,a.rows2.forEach(function(e,t){a.rows2[t].totalMoneyCompensate=Number(a.rows2[t].totalMoneyCompensate).toFixed(2)}),a.conf.total=Math.ceil(t.data.total/t.data.pageSize),a.conf.counts=t.data.total,a.$broadcast("categoryLoaded")),a.$apply())})}var g=window.localStorage;a.projectId=g.getItem("a");t.server().loginHost;a.imgHost=t.server().imgHost;window.location.hash;a.localhostImg=i.localhostimg,a.headImg=t.server().headImg;t.server().userId;if(a.userId=t.server().userId,a.projectId||t.server().zjprojectprojectListdo({},function(e){!0===e.result?(e.data&&e.data.length>0&&(a.leftdata=e.data,g.getItem("a")||g.setItem("a",a.leftdata[0].id),a.projectId=a.leftdata[0].id),a.$apply()):alert(e.message)}),!a.userId){var v=window.location.href.indexOf("=");a.userId=window.location.href.substring(v+1),console.log(a.userId)}var h=setInterval(function(){$(".l-nav>li").length>0&&($(".l-nav>li").eq(1).addClass("cur"),clearInterval(h))},10);a.listtop={projectId:a.projectId,createUser:a.userId,imgHost:t.server().imgHost,questiontype:4,projectflag:2,reloadajax:1,locationflag:1,myMobFlag:!0},a.action={},a.dataFollowUp=function(){a.action.reset()},a.myajax=function(){f(1,"","","",1)},a.shenpi=function(){window.localStorage.setItem("f","examine")},a.type=1,a.flag=!0,a.isActive=!0,a.dayCount="",a.no="--",a.hosturl=t.server().host,a.solutionfalg=!1,a.userId&&t.server().zjmUserImg({userId:a.userId},function(e){e.result?(a.nickname=e.data.nickname,a.realname=e.data.realname,a.photoUrl=e.data.photoUrl):alert(e.message)}),a.conf={total:3,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},a.searchKeys="",a.searchAddVal="",a.dimArrFlag=!1;var y=void 0;a.PullUpShow=!0,a.PullUpText="收起",a.pullUp=function(){a.PullUpShow?(a.PullUpShow=!1,a.PullUpText="展开"):(a.PullUpShow=!0,a.PullUpText="收起")},a.goalSetting=function(){$(".myworktwo").dialog(),a.goalSettingflag=!0,p(a.searchKeys,1),a.alertUpdateArr=[],a.conf.currentPage=1},a.addtrue=function(){a.conf.currentPage=1,a.goalSettingflag=!1,f(a.type,a.beginTime,a.endTimeendTime,a.dayCount,1)},a.alertSearch=function(e){p(e,a.conf.currentPage)},a.alertUpdate=function(e,t){a.alertUpdateArr=a.alertRows[t],a.alertRows.splice(t,1)},a.alertsave=function(e,t){for(var r=e.target,o=$(r).parents("tr").find("td"),n=2;n<o.length-1;n++)if(""===o.eq(n).find("input").val())return void alert("数值不能为空！");1===a.alertUpdateArr.flag?c(a.alertUpdateArr):l(a.alertUpdateArr,t)},a.alertliAdd=function(e,t){a.alertUpdateArr.organizationName=a.dimArr[t].name,a.alertUpdateArr.userName=a.dimArr[t].realname,a.alertUpdateArr.organizationId=a.dimArr[t].deptId,a.alertUpdateArr.userId=a.dimArr[t].id,a.alertUpdateArr.january="",a.alertUpdateArr.february="",a.alertUpdateArr.march="",a.alertUpdateArr.april="",a.alertUpdateArr.may="",a.alertUpdateArr.june="",a.alertUpdateArr.july="",a.alertUpdateArr.august="",a.alertUpdateArr.september="",a.alertUpdateArr.october="",a.alertUpdateArr.november="",a.alertUpdateArr.december="",a.alertUpdateArr.flag=2,a.searchAddVal=e,a.dimArrFlag=!1,y=""},a.addfocus=function(e){a.dimArrFlag=!0,d()},a.addblur=function(e){y=setTimeout(function(){a.dimArrFlag=!1},100)},a.addchange=function(e){d(e.toString())},a.bodyDataArr=[{id:8,name:"08:00",flagClass:!1,msgs:"",if:!1},{id:9,name:"09:00",flagClass:!1,msgs:"",if:!1},{id:10,name:"10:00",flagClass:!1,msgs:"",if:!1},{id:11,name:"11:00",flagClass:!1,msgs:"",if:!1},{id:12,name:"12:00",flagClass:!1,msgs:"",if:!1},{id:13,name:"13:00",flagClass:!1,msgs:"",if:!1},{id:14,name:"14:00",flagClass:!1,msgs:"",if:!1},{id:15,name:"15:00",flagClass:!1,msgs:"",if:!1},{id:16,name:"16:00",flagClass:!1,msgs:"",if:!1},{id:17,name:"17:00",flagClass:!1,msgs:"",if:!1},{id:18,name:"18:00",flagClass:!1,msgs:"",if:!1},{id:19,name:"19:00",flagClass:!1,msgs:"",if:!1},{id:20,name:"20:00",flagClass:!1,msgs:"",if:!1}],a.mouseenters=function(e){a.bodyDataArr[e].msgs&&(a.stringleng={width:14*r.GetLength(a.bodyDataArr[e].msgs)+"px"},a.bodyDataArr[e].if=!0)},a.mouseleaves=function(e){a.bodyDataArr[e].msgs&&(a.bodyDataArr[e].if=!1)};var I=["january","february","march","april","may","june","july","august","september","october","november","december"];Promise.all([function(){if(a.userId){a.threeshowArr=[];return new Promise(function(e,o){t.server().zjtaskqueryTaskInfodo({userId:a.userId},function(t){if(t.result){if(a.taskquery=t.data,t.data.timeList.length>0){a.yearmonthdata=r.timeConverter3(t.data.timeList[0].startDate,1);for(var o=0;o<t.data.timeList.length;o++){t.data.timeList[o].startDate=r.timeConverter3(t.data.timeList[o].startDate),t.data.timeList[o].endDate=r.timeConverter3(t.data.timeList[o].endDate);for(var n=t.data.timeList[o].startDate;n<t.data.timeList[o].endDate+1;n++){a.threeshowArr.push(n);for(var s=0;s<a.bodyDataArr.length;s++)a.bodyDataArr[s].id===n&&(t.data.timeList[o].splitJointName?t.data.timeList[o].splitJointName:t.data.timeList[o].splitJointName="暂无数据",t.data.timeList[o].code?t.data.timeList[o].code:t.data.timeList[o].code="暂无数据",a.bodyDataArr[s].msgs=t.data.timeList[o].splitJointName+" "+t.data.timeList[o].code)}}for(var i=0;i<a.bodyDataArr.length;i++)for(var s=0;s<a.threeshowArr.length;s++)a.bodyDataArr[i].id===a.threeshowArr[s]&&(a.bodyDataArr[i].flagClass=!0)}a.$apply(),e(t.data)}})})}}(),function(){return new Promise(function(e,r){t.server().zjindexassignmenttaskCountdo({},function(t){t.result?(a.taskCount=t.data,a.$apply(),e(t.data)):alert(t.message)})})}(),function(){return a.okNumber=[],a.totalNumber=[],a.noNumber=[],new Promise(function(e,r){t.server().zjindexassignmenttaskColumnardo({userId:a.userId},function(t){t.result&&(I.forEach(function(e,r){for(var o in t.data.taskNumber)o==I[r]&&(a.totalNumber.push(t.data.taskNumber[o]),a.okNumber.push(t.data.accomplishNumber[o]),delete t.data.taskNumber[o])}),a.totalNumber.forEach(function(e,t){var r=a.totalNumber[t]-a.okNumber[t];r<0&&(r=0),a.noNumber.push(r)}),e(t.data))})})}()]).then(function(e){}),a.radios=function(e){a.type=e,a.flag=1==e||!a.flag,a.endTimeendTime?a.dayCount="":$(".childData1").val(""),f(e,"","",a.dayCount,1)},a.$watch("conf.currentPage + conf.itemPageLimit",function(e){a.goalSettingflag?p(a.searchKeys,a.conf.currentPage):"1"==a.type?f(1,a.beginTime,a.endTimeendTime,a.dayCount,a.conf.currentPage):f(2,a.beginTime,a.endTimeendTime,a.dayCount,a.conf.currentPage)}),a.alertData=function(e,t,r){1===r?m(e,t,1,function(e){a.endTimeendTime&&a.beginTime&&f(a.type,e,a.endTimeendTime,a.dayCount,a.conf.currentPage)}):a.beginTime?u(e,t,a.beginTime,function(e){e?(a.dayCount="",a.endTimeendTime=e,f(a.type,a.beginTime,e,a.dayCount,a.conf.currentPage)):alert("请选择结束时间")}):alert("请选择开始时间")},a.isActive=!1,a.isActive2=!1,a.monthData=function(e){a.beginTime="",$(".childData1").val(""),a.endTimeendTime="",$(".childData2").val(""),7==e?(a.isActive=!a.isActive,a.isActive?(a.isActive2=!1,a.dayCount=7):a.dayCount=""):(a.isActive2=!a.isActive2,a.isActive2?(a.isActive=!1,a.dayCount=30):a.dayCount=""),f(a.type,a.beginTime,a.endTimeendTime,a.dayCount,a.conf.currentPage)},a.edit=function(){var e=a.hosturl+"task/queryTrackingInformation.do";a.link=e+"?createUser="+a.userId+"&type="+a.type+"&beginTime="+(a.beginTime||"")+"&endTime="+(a.endTimeendTime||"")+"&dayCount="+a.dayCount+"&export="+a.type+"&pageNo="+a.conf.currentPage+"&pageSize=5"},a.focuss=function(e){a.solutionfalg=!e},a.addmethod=function(e,t){$(".myworkthree").dialog(),a.addId=e,a.addarr=a.rows1[t],a.index=t},a.addsave=function(e,r,o){if(!r)return void(a.solutionfalg=!0);t.server().zjtaskaddSolutiondo({id:e,solution:r},function(e){!0===e.result?($(".myworkthree").fadeOut(200),a.rows1[o].solution=r,a.solution="",a.$apply(),alert("添加保存成功！")):alert(e.message)})},a.genjindel=function(e,r){confirm("确认删除吗？",function(){t.server().zjtaskdeleteTrackStatusdo({id:e},function(e){e.result?(a.rows1.splice(r,1),a.$apply()):alert(e.message)})})}}]).controller("jobEventListCtrl",["$http","$scope","server","dict","$state","$q","$cookieStore",function(e,a,t,r,o,n,s){function i(e,t){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,min:"2010-8-11",closeStop:"."+t,done:function(e){a.beginTime=e}})}function d(e,a,t,r){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,closeStop:"."+a,done:function(e){r(e)}})}function l(e,r,o,n,s,i,d){a.rows=[],t.server().zjpersoneventserachPersonEventListdo({userId:t.server().userId,operaterType:e,type:r,theme:o||"",time:n||"",beginTime:s||"",endTime:i||"",pageNO:d||1,pageSize:10},function(e){e.result?e.data.rows&&(a.rows=e.data.rows,a.rows.sort(function(e,a){return new Date(a.startTime).getTime()-new Date(e.startTime).getTime()}),a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$broadcast("categoryLoaded"),a.$apply()):alert(e.message)})}function p(e,a,t){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,closeStop:"."+a,done:function(e){t(e)}})}function c(e,r,o){a.dimArr=[],t.server().zjindexassignmentinitAdddo({projectId:a.projectId,searchKeys:e||""},function(e){e.result?(a.dimArr=e.data,r&&o(e.data),a.$apply()):alert(e.message)})}function m(e,t){"theme"==t&&(a.addflag.theme=!e),"time"==t&&(a.addflag.time=!e),"address"==t&&(a.addflag.address=!e)}function u(e,o){a.seedata="",a.participate="",a.participateid=[],a.updateanme=[],a.fileArr=[],a.peopleId=[],t.server().zjpersoneventfindPersonEventByIddo({id:e},function(e){e.result?(a.seedata=e.data,a.seedata.theme=e.data.theme,a.seedata.type=e.data.type,a.seedata.description=e.data.description,a.seedata.address=e.data.address,a.seedata.startTime=r.timeConverter3(a.seedata.startTime,4),a.seedata.flag=o,e.data.participateUser.forEach(function(t,r){a.updateanme[r]={id:e.data.participateUser[r].join_user_id,realname:e.data.participateUser[r].realname}}),a.seedata.attachment=e.data.attachment,a.$apply(),$(".h-myworktwo").dialog()):alert(e.message)})}a.projectId=o.params.projectid;var f=t.server().userId;a.type="",a.operaterType="",a.theme="",a.time="",a.beginTime="",a.endTime="",a.isActive=!0,a.no="--",a.host=t.server().host;s.get("mainurl");a.conf={total:3,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},a.PullUpShow=!0,a.PullUpText="收起",a.pullUp=function(){a.PullUpShow?(a.PullUpShow=!1,a.PullUpText="展开"):(a.PullUpShow=!0,a.PullUpText="收起")},a.radios=function(e,t){1===t?l(a.operaterType,e,a.theme,a.time,a.beginTime,a.endTime,a.conf.currentPage):l(e,a.type,a.theme,a.time,a.beginTime,a.endTime,a.conf.currentPage)},a.search=function(e){l(a.operaterType,a.type,e,a.time,a.beginTime,a.endTime,a.conf.currentPage)},a.isActive2=!1,a.isActive=!1,a.monthData=function(e){a.beginTime="",$(".childData1").val(""),a.endTime="",$(".childData2").val(""),1==e?(a.isActive=!a.isActive,a.isActive?(a.isActive2=!1,a.time=1):a.time=""):(a.isActive2=!a.isActive2,a.isActive2?(a.isActive=!1,a.time=2):a.time=""),l(a.operaterType,a.type,a.theme,a.time,a.beginTime,a.endTime,a.conf.currentPage)},a.alertData=function(e,t,r){1===r?i(e,t):a.beginTime?d(e,t,a.beginTime,function(e){e?(a.dayCount="",a.beginTime=a.beginTime.toString(),a.endTime=e.toString(),a.time="",l(a.operaterType,a.type,a.theme,a.time,a.beginTime,e,a.conf.currentPage),a.$apply()):alert("请选择结束时间")}):alert("请选择开始时间")},a.$watch("conf.currentPage + conf.itemPageLimit",function(e){l(a.type,a.operaterType,a.theme,a.time,a.beginTime,a.endTime,a.conf.currentPage)}),a.add={theme:"",time:"",address:"",things:"",peopel:""},a.addflag={theme:!1,time:!1,address:!1,things:!1,peopel:!1},a.peopleId=[],a.peoplename=[],a.updateanme=[],a.addfocus=function(e,t){c(e),a.dimArrFlag=!0},a.addblur=function(e,t){t?a.updateanme.length>=0?a.updateflag.participate=!1:a.updateflag.participate=!0:a.peoplename.length>=0?a.addflag.people=!1:a.addflag.people=!0,setTimeout(function(){a.dimArrFlag=!1,a.$apply()},200)},a.alertliAdd=function(e,t,r,o){a.myflag=!0,o?(a.updateanme.length>0&&a.updateanme.forEach(function(e,r){if(t==a.updateanme[r].id)return void(a.myflag=!1)}),a.myflag&&(a.updateanme.push(a.dimArr[r]),a.participate="")):(a.peoplename.length>0&&a.peoplename.forEach(function(e,r){if(t==a.peoplename[r].id)return void(a.myflag=!1)}),a.myflag&&(a.peoplename.push(a.dimArr[r]),a.add.peopel=""))},a.addchange=function(e,t){c(e,1,function(e){e.length<=0&&(a.dimArrFlag=!1),a.dimArrFlag=!0,a.$apply()})},a.peopeldel=function(e,t){t?a.updateanme.splice(e,1):a.peoplename.splice(e,1)},a.addtype=1,a.dimArrFlag=!1,a.addradios=function(e){a.addtype=e},a.adddataclick=function(e,t){p(e,t,function(e){a.add.time=e,a.addflag.time=!1,a.$apply()})},a.fileArr=[],a.fileNameChanged=function(t){var r=new FormData,o=t.target;if(o.files[0]){var n=o.files[0],s=n.name.slice(n.name.lastIndexOf(".")+1).toLowerCase();if("xls"!=s&&"xlsx"!=s&&"csv"!=s)return o.value="",alert("只能上传Excle文件"),!1;r.append("multipartFile",n),e({method:"POST",url:a.host+"attachment/fielUpload.do",data:r,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){o.value="",e.data.result?a.fileArr.push(e.data.data):alert(e.message)}),a.$apply()}},a.fileArrDel=function(e){a.fileArr.splice(e,1)},a.addsBlur=function(e,a){m(e,a)},a.addsave=function(){var e=[];return a.add.theme?(a.addflag.theme=!1,a.add.time?(a.addflag.time=!1,a.add.address?(a.addflag.address=!1,a.peoplename.length<=0?void(a.addflag.people=!0):(a.addflag.people=!1,a.peoplename.forEach(function(t,r){e.push(a.peoplename[r].id)}),a.attachments=[],a.fileArr.length>0&&a.fileArr.forEach(function(e,t){a.attachments[t]={filePath:a.fileArr[t].filePath,fileName:a.fileArr[t].fileName,size:a.fileArr[t].size}}),void t.server().zjpersoneventaddSavePersonEventdo({createUser:f,theme:a.add.theme,type:a.addtype,startTime:a.add.time,address:a.add.address,description:a.add.theme,participateUser:e.join(","),attachments:a.attachments.length>0?JSON.stringify(a.attachments):""},function(e){e.result?(a.add.theme="",a.add.time="",a.add.address="",a.add.things="",a.add.peopel="",$(".addchild1").val(""),a.fileArr=[],a.peopleId=[],a.peoplename=[],alert("添加成功！",function(){l(a.type,a.operaterType,a.theme,a.time,a.beginTime,a.endTime,a.conf.currentPage)}),$(".h-myworkone").fadeOut(200),a.$apply()):alert(e.message)}))):void(a.addflag.address=!0)):void(a.addflag.time=!0)):void(a.addflag.theme=!0)},a.seeFileDown=function(e,t){var r=a.host+e;a.link=r,a.linkName=t},a.updatedel=function(e){confirm("确认删除吗?",function(){a.seedata.attachment.splice(e,1),a.$apply()})},a.updateataclick=function(e,t){p(e,t,function(e){a.seedata.startTime=e,a.updateflag.time=!1,a.$apply()})},a.updateflag={theme:!1,startTime:!1,address:!1,description:!1,participate:!1},a.updatesBlur=function(e,t){"theme"==t&&(a.updateflag.theme=!e),"address"==t&&(a.updateflag.address=!e),"startTime"==t&&(a.updateflag.startTime=!e)},a.see=function(e,t){for(var r in a.updateflag)a.updateflag[r]=!1;a.seeeditflag=!1,u(e,1)},a.edit=function(e,t){a.getid=e,a.seeeditflag=!0,u(e,2)},a.updatesave=function(e,r){var o=[],n=[];if(2==r){if(!a.seedata.theme)return void(a.updateflag.theme=!0);if(a.updateflag.theme=!1,!a.seedata.startTime)return void(a.updateflag.startTime=!0);if(a.updateflag.startTime=!1,!a.seedata.address)return void(a.updateflag.address=!0);if(a.updateflag.address=!1,a.updateanme.length<=0)return void(a.updateflag.participate=!0);a.updateflag.participate=!1,a.updateanme.forEach(function(e,t){o.push(a.updateanme[t].id)}),a.seedata.attachment.length>0&&a.seedata.attachment.forEach(function(e,t){n.push(a.seedata.attachment[t].id)}),a.attachments=[],a.fileArr.length>0&&a.fileArr.forEach(function(e,t){a.attachments[t]={filePath:a.fileArr[t].filePath,fileName:a.fileArr[t].fileName,size:a.fileArr[t].size}}),t.server().zjpersoneventupdateSavePersonEventdo({theme:a.seedata.theme,updateUser:f,type:a.seedata.type,startTime:a.seedata.startTime,address:a.seedata.address,description:a.seedata.description,participateUser:o.join(","),enclosure:n.length>0?n.join(","):"",attachments:a.attachments.length>0?JSON.stringify(a.attachments):"",id:e},function(e){e.result?(a.seedata.theme="",a.seedata.startTime="",a.seedata.address="",a.seedata.description="",a.updateanme=[],a.seedata.attachment=[],a.$apply(),alert("修改成功！",function(){l(a.type,a.operaterType,a.theme,a.time,a.beginTime,a.endTime,a.conf.currentPage)}),$(".h-myworktwo").fadeOut(200)):alert(e.message)})}},a.del=function(e,r){confirm("确认要删除吗？",function(){t.server().zjpersoneventdeletePersonEventByIddo({id:e,userId:f},function(e){e.result?(a.rows.splice(r,1),a.$apply()):alert(e.message)})})},a.adds=function(){$(".h-myworkone").dialog(),a.add.theme="",a.add.time="",a.add.address="",a.add.things="",a.add.peopel="",a.fileArr=[],a.peopleId=[],$(".addchild1").val("")}}]).controller("jobTaskListCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){function s(e,t,r,o){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,min:"2010-8-11",closeStop:"."+t,done:function(e){a.beginTime=e,r&&o(e)}})}function i(e,a,t,r){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",show:!0,closeStop:"."+a,done:function(e){r(e)}})}function d(e,r,o,n,s,i,d){a.rows=[],t.server().zjtaskqueryTaskEventListdo({userId:g,nodeId:e,type:r,dayCount:o||"",beginTime:n||"",endTime:s||"",pageNO:i||1,pageSize:10,theme:d||""},function(e){e.result?(a.rows=e.data.rows,a.rows.length>0&&(a.rows.sort(function(e,a){return a.startDate-a.startDate}),a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$broadcast("categoryLoaded"),a.$apply())):alert(e.message)})}function l(e){return a.dimArr=[],new Promise(function(r,o){t.server().zjtaskqueryRoomNamedo2({userId:g,param:e,projectId:a.projectuserId},function(e){e.result?(a.dimArr=e.data,r(e.data),a.$apply()):alert(e.message)})})}function p(e){return a.personarr=[],new Promise(function(r,o){t.server().zjtaskqueryUserNamedo({projectId:a.projectId,realname:e},function(e){e.result?(a.personarr=e.data,r(e.data),a.$apply()):alert(e.message)})})}function c(e){t.server().zjtaskqueryChildOrderdo({parentId:e},function(e){e.result?(a.childInitOrder=e.data,a.$apply()):alert(e.message)})}function m(e,t,r,o){laydate.render({elem:"."+e,type:"date",format:"yyyy-MM-dd",closeStop:"."+t,done:function(e){a.beginTime=e,r&&o(e)}})}function u(e,o){a.threeshowArr=[],v=[],a.bodyDataArr.forEach(function(e,t){a.bodyDataArr[t].clickClass=!1}),t.server().zjtaskqueryUserInfoByUserIddo({userId:t.server().userId,time:o},function(e){if(e.result){if(a.taskquery=e.data,a.taskquery){a.yearmonthdata=r.timeConverter3(a.taskquery[0].startTime,1);for(var t=0;t<a.taskquery.length;t++){a.taskquery[t].startTime=r.timeConverter3(a.taskquery[t].startTime),a.taskquery[t].endTime=r.timeConverter3(a.taskquery[t].endTime);for(var o=a.taskquery[t].startTime;o<a.taskquery[t].endTime+1;o++)a.threeshowArr.push(o)}for(var n=0;n<a.bodyDataArr.length;n++)for(var s=0;s<a.threeshowArr.length;s++)a.bodyDataArr[n].id===a.threeshowArr[s]&&(a.bodyDataArr[n].flagClass=!0)}a.$apply()}else alert(e.message)})}function f(e,a){return e-a}a.projectId=o.params.projectid;var g=t.server().userId;a.PullUpShow=!0,a.PullUpText="收起",a.type="",a.nodeId="",a.theme="",a.dayCount="",a.beginTime="",a.endTime="",a.isActive=!0,a.no="--",a.conf={total:3,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},a.pullUp=function(){a.PullUpShow?(a.PullUpShow=!1,a.PullUpText="展开"):(a.PullUpShow=!0,a.PullUpText="收起")},t.server().zjtaskinitOrderSignNodedo({},function(e){e.result?(a.initOrder=e.data,a.$apply()):alert(e.message)}),a.radios=function(e,t){1==t?(a.firstId=a.initOrder[e].id,d(a.initOrder[e].id,a.type,a.dayCount,a.beginTime,a.endTime,a.conf.currentPage,a.theme)):2==t?d(a.firstId,e,a.dayCount,a.beginTime,a.endTime,a.conf.currentPage,a.theme):(a.firstId="",d(a.firstId,a.type,a.dayCount,a.beginTime,a.endTime,a.conf.currentPage,a.theme))},a.search=function(e){d(a.firstId,a.type,a.dayCount,a.beginTime,a.endTime,a.conf.currentPage,e)},a.isActive=!1,a.isActive2=!1,a.monthData=function(e){a.beginTime="",$(".childData1").val(""),a.endTime="",$(".childData2").val(""),1==e?(a.isActive=!a.isActive,a.isActive?(a.isActive2=!1,a.dayCount=1):a.dayCount=""):(a.isActive2=!a.isActive2,a.isActive2?(a.isActive=!1,a.dayCount=2):a.dayCount=""),d(a.firstId,a.type,a.dayCount,a.beginTime,a.endTime,a.conf.currentPage,a.theme)},a.alertData=function(e,t,r){1===r?s(e,t):a.beginTime?i(e,t,a.beginTime,function(e){e?(a.dayCount="",a.beginTime=a.beginTime.toString(),a.endTime=e.toString(),d(a.firstId,a.type,a.dayCount,a.beginTime,a.endTime,a.conf.currentPage,a.theme),a.$apply()):alert("请选择结束时间")}):alert("请选择开始时间")},a.$watch("conf.currentPage + conf.itemPageLimit",function(e){d(a.firstId,a.type,a.dayCount,a.beginTime,a.endTime,a.conf.currentPage,a.theme)}),a.addfocusproject=function(e){e||(a.projectuserId=null),t.server().zjprojectprojectVaguedo({searchKeys:e},function(e){e.result?(console.log(e),a.dimArrproject=e.data,a.$apply()):alert(e.message)})},a.addchangeproject=function(e){e||(a.projectuserId=null),t.server().zjprojectprojectVaguedo({searchKeys:e},function(e){e.result?(console.log(e),a.dimArrproject=e.data,a.$apply()):alert(e.message)})},a.addblurproject=function(e){setTimeout(function(){a.dimArrproject=[],a.$apply()},200)},a.alertliAddproject=function(e){a.projectuserId=a.dimArrproject[e].id,a.add.peopelproject=a.dimArrproject[e].projectName},a.queryEventDesc=function(e,t){a.EventDesc=a.rows[t]},a.dell=function(e,r){confirm("确认删除该条吗",function(){t.server().zjtaskupdateTaskStatusdo({id:e},function(e){e.result?(a.rows.splice(r,1),a.$apply()):alert(e.message)})})},a.takeIn=function(e,r,o){1!=o&&confirm("确认接收吗？",function(){t.server().zjtasktaskIsAcceptdo({id:e,type:1},function(e){e.result?(a.rows[r].isAccept=1,a.$apply()):alert(e.message)})})},a.backs=function(e,r,o){2!=o&&confirm("确认退回吗？",function(){t.server().zjtasktaskIsAcceptdo({id:e,type:2},function(e){e.result?(a.rows[r].isAccept=2,a.$apply()):alert(e.message)})})},a.add={peopel:"",person:"",parentOption:"",childOption:"",
date:"",things:"",peopelproject:""},a.peopelArr="",a.personArr="",a.dimArrFlag=!1,a.personarrFlag=!1,a.addflag={peopel:!1,person:!1,select:!1,things:!1},a.addfocus=function(e,t){t?p(e).then(function(e){e.length>0?a.personarrFlag=!0:a.personarrFlag=!1,a.addflag.person=!1,a.$apply()}):(l(e).then(function(e){e.length>0?a.dimArrFlag=!0:a.dimArrFlag=!1,a.addflag.peopel=!1,a.$apply()}),a.addflag.peopel=!1)},a.addblur=function(e,t){t?setTimeout(function(){a.personarrFlag=!1,a.add.person?a.addflag.person=!1:a.addflag.person=!0,a.$apply()},200):setTimeout(function(){a.dimArrFlag=!1,a.add.peopel?a.addflag.peopel=!1:a.addflag.peopel=!0,a.$apply()},200)},a.addchange=function(e,t){console.log(e),t?(p(e).then(function(e){e.length>0?a.personarrFlag=!0:a.personarrFlag=!1,a.$apply()}),a.addflag.person=!1):(l(e).then(function(e){e.length>0?a.dimArrFlag=!0:a.dimArrFlag=!1,a.$apply()}),a.addflag.peopel=!1)},a.alertliAdd=function(e,t){t?(a.add.person=a.personarr[e].realname,a.personArr=a.personarr[e].id):(a.add.peopel=a.dimArr[e].splitJointName,a.peopelArr=a.dimArr[e].id)},a.addoptions=function(e){e&&c(e)},a.addoptionsChild=function(e){a.addflag.select=!e},a.addsBlur=function(e){a.addflag.things=!e},a.adddate=function(e,t){m(e,t,2,function(e){a.add.date=e,u(a.add.person,e),a.$apply()})},a.bodyDataArr=[{id:8,name:"08:00",flagClass:!1,msg:"",clickClass:!1},{id:9,name:"09:00",flagClass:!1,msg:"",clickClass:!1},{id:10,name:"10:00",flagClass:!1,msg:"",clickClass:!1},{id:11,name:"11:00",flagClass:!1,msg:"",clickClass:!1},{id:12,name:"12:00",flagClass:!1,msg:"",clickClass:!1},{id:13,name:"13:00",flagClass:!1,msg:"",clickClass:!1},{id:14,name:"14:00",flagClass:!1,msg:"",clickClass:!1},{id:15,name:"15:00",flagClass:!1,msg:"",clickClass:!1},{id:16,name:"16:00",flagClass:!1,msg:"",clickClass:!1},{id:17,name:"17:00",flagClass:!1,msg:"",clickClass:!1},{id:18,name:"18:00",flagClass:!1,msg:"",clickClass:!1},{id:19,name:"19:00",flagClass:!1,msg:"",clickClass:!1},{id:20,name:"20:00",flagClass:!1,msg:"",clickClass:!1}];var v=[];Array.prototype.removeByValue=function(e){for(var a=0;a<this.length;a++)if(this[a]==e){this.splice(a,1);break}},a.datachoose=function(e){if(!1===a.bodyDataArr[e].flagClass&&(a.bodyDataArr[e].clickClass=!a.bodyDataArr[e].clickClass,!0===a.bodyDataArr[e].clickClass?v.push(e):v.removeByValue(e),v.length>=2)){v=v.sort(f);for(var t=v[0];t<v[v.length-1]+1;t++){if(!0===a.bodyDataArr[t].flagClass)return a.bodyDataArr[e].clickClass=!1,void v.pop();a.bodyDataArr[t].clickClass=!0}}},a.addsave=function(e,r){if(2==r){if(!a.add.person)return void(a.addflag.person=!0);if(a.addflag.person=!1,!a.add.date)return void alert("请选择指派时间！");if(a.addflag.date=!1,v.length<=0)return void alert("请选择可用时间段！");if(a.startDate=a.add.date+" "+a.bodyDataArr[v[0]].name,a.endDate=a.add.date+" "+a.bodyDataArr[v[v.length-1]].name,!a.add.things)return void(a.addflag.things=!0);a.addflag.things=!1,t.server().zjtaskupdateTaskdo({toUser:a.add.person,startDate:a.startDate,endDate:a.endDate,eventDesc:a.add.things,userId:a.personArr,id:a.rows[e].id,roomId:a.peopelArr},function(e){e.result?($(".h-liebiaoone").fadeOut(200),a.add.peopel="",a.peopelArr="",a.add.childOption="",a.add.parentOption="",a.personArr="",a.add.person="",a.add.date="",a.add.things="",a.beginTime="",a.endTime="",v=[],alert("发布成功！",function(){d(a.nodeId,a.type,"","","",a.conf.currentPage,"")}),a.$apply()):alert(e.message)})}else{if(!a.add.peopel)return void(a.addflag.peopel=!0);if(a.addflag.peopel=!1,!a.add.parentOption)return void(a.addflag.select=!0);if(a.addflag.select=!1,!a.add.person)return void(a.addflag.person=!0);if(a.addflag.person=!1,!a.add.date)return void alert("请选择指派时间！");if(a.addflag.date=!1,v.length<=0)return void alert("请选择可用时间段！");if(a.startDate=a.add.date+" "+a.bodyDataArr[v[0]].name,a.endDate=a.add.date+" "+a.bodyDataArr[v[v.length-1]].name,!a.add.things)return void(a.addflag.things=!0);a.addflag.things=!1,t.server().zjtaskaddTask({roomId:a.peopelArr,processId:a.add.childOption,toUser:a.add.person,startDate:a.startDate,endDate:a.endDate,eventDesc:a.add.things,userId:a.personArr,createUser:g,eventNode:a.add.parentOption},function(e){e.result?(a.add.peopel="",a.peopelArr="",a.add.childOption="",a.add.parentOption="",a.personArr="",a.add.person="",a.add.date="",a.add.things="",a.beginTime="",a.endTime="",v=[],alert("发布成功！",function(){d(a.nodeId,a.type,"","","",a.conf.currentPage,"")}),$(".h-liebiaoone").fadeOut(200),a.$apply()):alert(e.message)})}},a.regist=function(e){$(".h-liebiaoone").dialog(),a.registIndex=e,a.registFlag=2,a.add.peopel=a.rows[e].splitJointName+a.rows[e].code,a.peopelArr=a.rows[e].roomId,c(a.rows[e].parentId),a.add.childOption=a.rows[e].childId,a.add.parentOption=a.rows[e].parentId,a.personArr=a.rows[e].userId,a.add.person=a.rows[e].toUser,a.add.date=r.timeConverter3(a.rows[e].startDate,3),a.add.things=a.rows[e].eventDesc,a.add.peopelproject=a.rows[e].projectName,a.add.peopel=a.rows[e].address,a.$scope.bodyDataArr.forEach(function(e,t){a.bodyDataArr[t].clickClass=!1}),a.addflag={peopel:!1,person:!1,select:!1,things:!1}},a.regCreatetaskist=function(){$(".h-liebiaoone").dialog(),a.registFlag=1,a.add.peopel="",a.peopelArr="",a.add.childOption="",a.add.parentOption="",a.personArr="",a.add.person="",a.add.date="",a.add.things="",a.add.date="",a.add.peopelproject="",a.add.peopel="",v=[],$(".addchildData1").val(""),a.addflag={peopel:!1,person:!1,select:!1,things:!1},a.bodyDataArr.forEach(function(e,t){a.bodyDataArr[t].clickClass=!1})}}]).controller("commissionPaymentCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){function s(){return new Promise(function(e,r){t.server().zjprojectdeleteById({id:a.projectId,userId:i},function(t){!0===t.result?(a.project2=t.data.project,a.$apply(),e(a.project2)):alert(t.message)})}),Promise}a.no="-",a.No="",a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.approveId=o.params.approveId,a.lookflag=o.params.flag,a.hostname=t.server().host,a.locationFrefFlag=o.params.number;var i=t.server().userId;a.notetext="",a.notetextFlag=!1,a.passOKflag=!0,a.shows=!1,a.clickdisabled=!0,a.clicktimeoutdata=3e3,a.roomMsgName="项目",a.conf={total:3,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},Promise.all([s(),function(){return new Promise(function(e,r){t.server().zjapprovalformdetaildo({approvalId:a.approveId,userId:i},function(t){t.result?(a.roomMsg=t.data.roomMsg,a.nodeMsg=t.data.nodeMsg,a.approvalNodeName=t.data.approvalNodeName,e(t.data),a.$apply()):alert(t.message)})}),Promise}()]).then(function(e){return e},function(e){});var d=function(e){a.fincialIdsArr=[],a.fincialIds="",t.server().zjapprovalforminitFincialApprovaldo({projectId:a.projectId,userId:i,pageNo:e||1,pageSize:a.conf.itemPageLimit||10,approvalId:a.approveId},function(e){e.result?(e.data.payments&&(a.payforListArr=e.data.payments,a.payforListArr.forEach(function(e,t){a.fincialIdsArr.push(a.payforListArr[t].id)}),a.fincialIdsArr=a.fincialIdsArr.join(","),a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$broadcast("categoryLoaded")),a.$apply()):alert(e.message)})},l=function(e){a.fincialIdsArr2=[],t.server().zjapprovalformcommmisionApprovalListdo({projectId:a.projectId,approvalId:a.approveId,userId:i,pageNo:e||1,pageSize:a.conf.itemPageLimit||10},function(e){e.result?(e.data.commissionsList&&e.data.commissionsList.length>0&&(a.MoneryListArr=e.data.commissionsList,a.MoneryListArr.forEach(function(e,t){a.fincialIdsArr2.push(a.MoneryListArr[t].id)}),a.fincialIdsArr2=a.fincialIdsArr2.join(","),a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$broadcast("categoryLoaded")),a.$apply()):alert(e.message)})};a.blurs=function(e){a.notetextFlag=!e},a.$watch("conf.currentPage + conf.itemPageLimit",function(e){"1"==a.locationFrefFlag?d(a.conf.currentPage):l(a.conf.currentPage)}),"0"==a.lookflag&&t.server().zjapprovalformqueryApplyRecorddo({approvalId:a.approveId},function(e){e.result?(e.data.length>=0&&(a.lookapproArr=e.data,a.lookapproArr.forEach(function(e,t){"1"==a.lookapproArr[t].adopt?a.lookapproArr[t].adopt="审核中":"2"==a.lookapproArr[t].adopt?a.lookapproArr[t].adopt="审核中通过":"0"==a.lookapproArr[t].adopt?a.lookapproArr[t].adopt="未审核":a.lookapproArr[t].adopt="审核不通过"})),a.$apply()):alert(e.message)}),s(),a.passOK=function(){a.notetext?a.notetextFlag=!1:a.notetextFlag=!0,a.clickdisabled&&(a.clickdisabled=!1,t.server().zjapprovalformfincialThroghdo({approvalId:a.approveId,userId:i,remakers:a.notetext,type:2,fincialIds:"1"==a.locationFrefFlag?a.fincialIdsArr:a.fincialIdsArr2},function(e){e.result?(alert(e.message,function(){a.passOKflag=!1,o.go("examine",{projectid:a.projectId})}),a.$apply()):alert(e.message)})),r.timeouts(!1,a.clicktimeoutdata,function(){a.clickdisabled=!0,a.$apply()})},a.passNO=function(){a.notetext?a.notetextFlag=!1:a.notetextFlag=!0,a.clickdisabled&&(a.clickdisabled=!1,t.server().zjapprovalformfincialNotThroghdo({approvalId:a.approveId,userId:i,remakers:a.notetext,fincialIds:"1"==a.locationFrefFlag?a.fincialIdsArr:a.fincialIdsArr2},function(e){e.result?(alert(e.message,function(){a.passOKflag=!1,o.go("examine",{projectid:a.projectId})}),a.$apply()):alert(e.message)})),r.timeouts(!1,a.clicktimeoutdata,function(){a.clickdisabled=!0,a.$apply()})},a.lookJindu=function(e){a.lookJinduArr=[],t.server().zjommissionrulesdeleteByIddo({id:a.approveId,nodeId:a.nodeMsg[e].id},function(e){e.result?(a.lookJinduArr=e.data,console.log(a.lookJinduArr),a.$apply()):alert(e.message)})},a.exportWork=function(){$(".export").dialog(),t.server().zjapprovalformexportdo({approvalId:a.approveId,userId:1},function(e){e.result?(a.exportRomMap=e.data.romMap,a.content=e.data.content,a.exportHasApply=e.data.hasApply,a.exportHasNotApply=e.data.hasNotApply,a.$apply()):alert(e.message)})}}]).controller("surveyingMappingCtrl",["$http","$scope","server","dict","$state","$q","$rootScope",function(e,a,t,r,o,n,s){function i(){t.server().zjpacttempletelistTmpletedo({pactId:a.templatePactId},function(e){e.result?(a.templateList=e.data,a.templateList.forEach(function(e,t){"1"==a.templateList[t].status||"3"==a.templateList[t].status?(a.templateList[t].templateName=a.templateList[t].templateName+"合同审批",a.templateList[t].disabled=!1,a.templateListTitle=!1):(a.templateList[t].templateName=a.templateList[t].templateName+"合同审批",a.templateList[t].disabled=!0,a.templateListTitle=!0)}),a.$apply()):alert(e.message)})}a.nos="-",a.No="暂无数据",a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.approveId=o.params.approveId,a.locationFrefFlag=o.params.number,a.templatePactId=o.params.pactId,a.lookflag=o.params.flag,a.updateStatus=o.params.updateStatus,a.pstatus=o.params.status,a.headImg=t.server().headImg,a.pactId=a.templatePactId,a.pnumber=a.locationFrefFlag,a.pflag=a.lookflag,a.pupdateStatus=a.updateStatus,a.hostname=t.server().host;var d=t.server().userId;a.hostname=t.server().imgHost,a.notetext="",a.notetextFlag=!1,a.passOKflag=!0,a.shows=!1,a.clickdisabled=!0,a.clicktimeoutdata=3e3,a.conf={total:3,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},a.locationHerf=function(e){o.go("examine",{projectid:a.projectId,roomId:a.roomId,approveId:a.approveId,number:e})},"0"==a.lookflag&&t.server().zjapprovalformqueryApplyRecorddo({approvalId:a.approveId},function(e){e.result?(e.data.length>=0&&(a.lookapproArr=e.data,a.lookapproArr.forEach(function(e,t){"1"==a.lookapproArr[t].adopt?a.lookapproArr[t].adopt="审核通过 ":"2"==a.lookapproArr[t].adopt?a.lookapproArr[t].adopt="审核未通过":"0"==a.lookapproArr[t].adopt&&(a.lookapproArr[t].adopt="未审核")})),a.$apply()):alert(e.message)}),function(){new Promise(function(e,r){t.server().zjprojectdeleteById({id:a.projectId,userId:d},function(t){!0===t.result?(a.project2=t.data.project,a.$apply(),e(a.project2)):alert(t.message)})})}(),a.bianji=function(){$(".updatetemplateShow").dialog()},function(){t.server().zjapprovalformdetaildo({approvalId:a.approveId,userId:d},function(e){if(e.result){if(a.roomMsg=e.data.roomMsg,a.nodeMsg=e.data.nodeMsg,a.approvalNodeName=e.data.approvalNodeName,e.data.approvalMsg){if("0"==a.locationFrefFlag||"100"==a.locationFrefFlag||"200"==a.locationFrefFlag||"300"==a.locationFrefFlag||"400"==a.locationFrefFlag||"500"==a.locationFrefFlag||"1600"==a.locationFrefFlag||"700"==a.locationFrefFlag?a.roomMsgName="项目":a.roomMsgName="物业","0"!=a.locationFrefFlag&&"200"!=a.locationFrefFlag||(a.rules=e.data.approvalMsg),"300"==a.locationFrefFlag&&(a.rulesdata=[],a.rulesdata[0]=e.data.approvalMsg),"400"==a.locationFrefFlag&&(2==a.updateStatus?a.yewu=e.data.approvalMsg.serviceMap:a.yewu=e.data.approvalMsg),"500"==a.locationFrefFlag&&(2==a.updateStatus?a.weijian=e.data.approvalMsg.updateFrontMap:a.weijian=e.data.approvalMsg),"600"==a.locationFrefFlag&&(2==a.updateStatus?(a.updataBehindMap=e.data.approvalMsg.updataBehindMap,(a.updataBehindMap.singleList||a.updataBehindMap.surveyList)&&(a.fileUrl=a.updataBehindMap.fileUrl,a.singleList=a.updataBehindMap.singleList,a.surveyList=a.updataBehindMap.surveyList)):(a.surveyInfo=e.data.approvalMsg,a.singleList=a.surveyInfo.singleList,a.surveyList=a.surveyInfo.surveyList,a.housesImg=a.surveyInfo.housesImg)),"700"==a.locationFrefFlag&&(a.content=e.data.approvalMsg.content,a.detail=e.data.approvalMsg.detail,a.settlement=e.data.approvalMsg.settlement),"800"==a.locationFrefFlag)if(a.topData=[],a.bottomData=[],3==a.updateStatus){a.compensatePlanArr=e.data.approvalMsg.compensationInfoList;for(var t=0;t<a.compensatePlanArr.length;t++)0===a.compensatePlanArr[t].Identification?a.topData.push(a.compensatePlanArr[t]):a.bottomData.push(a.compensatePlanArr[t]);for(var r=0;r<a.topData.length;r++)a.topData[r].area=Number(a.topData[r].area).toFixed(2)||0,a.topData[r].replacementRatio=Number(a.topData[r].replacementRatio)||0,a.topData[r].builtInArea=Number(a.topData[r].builtInArea).toFixed(2)||0;for(var o=0;o<a.bottomData.length;o++)a.bottomData[o].area=Number(a.bottomData[o].area).toFixed(2)||0,a.bottomData[o].compensatePrice=Number(a.bottomData[o].compensatePrice).toFixed(2)||0,a.bottomData[o].compensationAmount=Number(a.bottomData[o].compensationAmount).toFixed(2)||0,"0"==a.bottomData[o].priceMode?a.bottomData[o].compensationAmount=a.bottomData[o].compensatePrice:1===a.bottomData[o].status&&1===a.bottomData[o].isRestricted&&a.bottomData[o].restrictedArea&&(a.bottomData[o].area=Number(a.bottomData[o].restrictedArea).toFixed());a.totalMoneyCompensate=a.bottomData[0].totalMoneyCompensate?Number(a.bottomData[0].totalMoneyCompensate).toFixed(2):0,a.monthlyInterimCompensate=a.bottomData[0].monthlyInterimCompensate?Number(a.bottomData[0].monthlyInterimCompensate).toFixed(2):0}else if(a.compensatePlanArr=e.data.approvalMsg.list,a.mapCompensate=e.data.approvalMsg.mapCompensate,a.topData=[],a.bottomData=[],a.compensatePlanArr&&a.compensatePlanArr.length>0){for(var n=0;n<a.compensatePlanArr.length;n++)"0"==a.compensatePlanArr[n].identification?a.topData.push(a.compensatePlanArr[n]):a.bottomData.push(a.compensatePlanArr[n]);a.topData.forEach(function(e,t){1==a.topData[t].area.status&&(a.topData[t].area=a.topData[t].area.value,a.topData[t].areaflag=!0),1==a.topData[t].replacementRatio.status&&(a.topData[t].replacementRatio=a.topData[t].replacementRatio.value,a.topData[t].replacementRatioflag=!0),1==a.topData[t].builtInArea.status&&(a.topData[t].builtInArea=a.topData[t].builtInArea.value,a.topData[t].builtInAreaflag=!0),1==a.topData[t].builtInPeriod.status&&(a.topData[t].builtInPeriod=a.topData[t].builtInPeriod.value,a.topData[t].builtInPeriodflag=!0)}),a.bottomData.forEach(function(e,t){1==a.bottomData[t].area.status&&(a.bottomData[t].area=a.bottomData[t].area.value,a.bottomData[t].areaflag=!0),1==a.bottomData[t].compensatePrice.status&&(a.bottomData[t].compensatePrice=a.bottomData[t].compensatePrice.value,a.bottomData[t].compensatePriceflag=!0),1==a.bottomData[t].compensationAmount.status&&(a.bottomData[t].compensationAmount=a.bottomData[t].compensationAmount.value,a.bottomData[t].compensationAmountflag=!0),"0"==a.bottomData[t].priceMode&&(a.bottomData[t].compensationAmount=a.bottomData[t].compensatePrice)}),a.totalMoneyCompensateflag=1==a.mapCompensate.totalMoneyCompensate.status,a.totalMoneyCompensate=1==a.mapCompensate.totalMoneyCompensate.status?a.mapCompensate.totalMoneyCompensate.value:a.mapCompensate.totalMoneyCompensate,a.monthlyInterimCompensateflag=1==a.mapCompensate.monthlyInterimCompensate.status,a.monthlyInterimCompensate=1==a.mapCompensate.monthlyInterimCompensate.status?a.mapCompensate.monthlyInterimCompensate.value:a.mapCompensate.monthlyInterimCompensate}if("900"==a.locationFrefFlag||"1000"==a.locationFrefFlag)switch(a.payee=e.data.approvalMsg,a.payee.recieveType){case 1:a.payee.recieveType="业权人收款";break;case 2:a.payee.recieveType="其他人代收款";break;case 3:a.payee.recieveType="未满18岁监护人待收款";break;case 4:a.payee.recieveType="关联其他业权人收款"}"1100"==a.locationFrefFlag&&(a.contractApprove=e.data.approvalMsg,a.pactflag=!0),"1200"==a.locationFrefFlag&&(a.ContractTemplates=e.data.approvalMsg,$(".basic-look-text").html(a.ContractTemplates.content),a.pactflag=!0),"1400"==a.locationFrefFlag&&(a.transgressMap=e.data.approvalMsg.transgressMap,a.attachmentList=e.data.approvalMsg.attachmentList),"1600"!=a.locationFrefFlag&&"0"!=a.locationFrefFlag||(a.rules=e.data.approvalMsg),"1700"==a.locationFrefFlag&&(a.propertyInfordata=e.data.approvalMsg)}a.$apply()}else alert(e.message)})}(),a.config={toolbars:[["anchor","undo","redo","bold","indent","snapscreen","italic","underline","strikethrough","subscript","fontborder","superscript","formatmatch","source","blockquote","pasteplain","selectall","print","preview","horizontal","removeformat","time","date","unlink","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","deletecaption","inserttitle","mergecells","deletetable","cleardoc","insertparagraphbeforetable","insertcode","fontfamily","fontsize","paragraph","simpleupload","edittable","edittd","link","emotion","spechars","searchreplace","map","gmap","insertvideo","help","justifyleft","justifyright","justifycenter","justifyjustify","forecolor","backcolor","insertorderedlist","insertunorderedlist","fullscreen","directionalityltr","directionalityrtl","rowspacingtop","rowspacingbottom","pagebreak","insertframe","imagenone","imageleft","imageright","attachment","imagecenter","wordimage","lineheight","edittip ","customstyle","autotypeset","webapp","touppercase","tolowercase","background","template","scrawl","music","inserttable","drafts","charts"]],autoClearinitialContent:!0,wordCount:!1,elementPathEnabled:!1,initialFrameWidth:"100%",initialFrameHeight:200},"1"==a.pstatus&&"1100"==a.locationFrefFlag&&i(),a.templateSubmit=function(e){a.templateListId=a.templateList[e].id,a.templateListIndx=e,t.server().zjpactinfoapplyPactMode({tmpleteId:a.templateList[e].id,userId:d,pactId:a.templatePactId},function(e){e.result?(a.updatetemplateList=e.data,$(".templateShow").dialog(),a.$apply()):alert(e.message)})},a.pacts=[{keyname:"Number_of_Surveying_and_mapping_reports",time:"1",name:"测绘报告编号"},{keyname:"Document_number",time:"2",name:"文件编号"},{keyname:"Parcel_number",time:"3",name:"宗地编号"},{keyname:"room_name",time:"4",name:"房间名称"},{keyname:"room_code",time:"5",name:"房间编号"},{keyname:"Land_use_certificate",time:"65",name:"土地使用证编号"},{keyname:"Planning_permit",time:"334",name:"规划许可证编号"},{keyname:"zong_map_code",time:"6",name:"宗地图，编号"},{keyname:"Project_planning_license",time:"7",name:"工程规划许可证编号"},{keyname:"Number_of_construction_license",time:"8",name:"施工许可证编号"},{keyname:"Acceptance_certificate",time:"232",name:"竣工验收合格证编号"},{keyname:"House_transfer",time:"9",name:"房屋转让买卖合同编号"},{keyname:"All_warrants_of_the_house",time:"76",name:"房屋所有权证，编号"},{keyname:"Warrant_for_the_use_of",time:"45",name:"集体土地使用权证编号"},{keyname:"Non_agricultural_construction_land",time:"34",name:"非农建设用地编号"}],a.alerttemplate=function(){a.pact=[],a.pactname=[],a.pactkeyname=[],$(".templateShow").fadeOut(200),$(".updatetemplateShow").dialog(),t.server().zjpactmodeeditpactListdo({},function(e){e.result?(a.mydata=e.data,a.mydata.forEach(function(e,t){a.pact[t]={keyname:a.mydata[t].keyName,name:a.mydata[t].name,val:"",time:a.mydata[t].time}}),a.pact.sort(function(e,a){return e.time-a.time}),console.log(a.pact),a.$apply()):alert(e.message)})},a.updateclose=function(){$(".templateShow").dialog()},a.updateemplateaddsave=function(e,o,n){a.usepact={},2==n?(a.pact.forEach(function(e,t){a.usepact[e.keyname]=e.val}),t.server().zjpactmodepreviewPathdo({dataTwo:e,createUser:d,pactId:a.templatePactId,dataOne:a.updatetemplateList.toString(),editJson:JSON.stringify(a.usepact)},function(e){e.result?(a.updatetemplateList2=e.data.dataOne,a.dataTwo=e.data.dataTwo,a.pactIds=e.data.pactId,$(".templateShow2").dialog(),a.$apply()):alert(e.message)})):(a.clickdisabled&&(a.clickdisabled=!1,t.server().zjpactmodeaddSavedo({dataTwo:a.dataTwo,createUser:d,pactId:a.pactIds,dataOne:a.updatetemplateList2.toString()},function(e){e.result?alert("保存成功！",function(){a.templateListTitle=!1,i(),a.$apply()}):alert(e.message),$(".templateShow2").fadeOut(200),$(".updatetemplateShow").fadeOut(200)})),r.timeouts(!1,a.clicktimeoutdata,function(){a.clickdisabled=!0,a.$apply()}))},a.templateaddsave=function(e,r){t.server().zjpactinfoeditorpactdo({dataTwo:e,createUser:d,pactId:a.templatePactId,dataOne:a.updatetemplateList.toString()},function(e){e.result?alert("保存成功！",function(){$(".templateShow").fadeOut(200),a.templateListTitle=!1,i(),a.$apply()}):alert(e.message)})},a.blurs=function(e){a.notetextFlag=!0},a.passOK=function(){a.notetext?a.notetextFlag=!1:a.notetextFlag=!0,a.clickdisabled&&(a.clickdisabled=!1,t.server().zjapprovalformthroghdo({approvalFormId:a.approveId,currentUser:d,examineRemarks:a.notetext},function(e){e.result?(alert(e.message,function(){o.go("examine",{projectid:a.projectId})}),a.$apply()):alert(e.message)})),r.timeouts(!1,a.clicktimeoutdata,function(){a.clickdisabled=!0,a.$apply()})},a.passNO=function(){a.notetext?a.notetextFlag=!1:a.notetextFlag=!0,a.clickdisabled&&(a.clickdisabled=!1,t.server().zjapprovalformnotThroghdo({approvalFormId:a.approveId,currentUser:d,examineRemarks:a.notetext},function(e){e.result?(alert(e.message,function(){a.passOKflag=!1,o.go("examine",{projectid:a.projectId})}),a.$apply()):alert(e.message)})),r.timeouts(!1,a.clicktimeoutdata,function(){a.clickdisabled=!0,a.$apply()})},a.lookJindu=function(e){a.lookJinduArr=[],t.server().zjommissionrulesdeleteByIddo({id:a.approveId,nodeId:a.nodeMsg[e].id},function(e){e.result?(a.lookJinduArr=e.data,console.log(a.lookJinduArr),a.$apply()):alert(e.message)})},a.exportWork=function(){t.server().zjapprovalformexportdo({approvalId:a.approveId,userId:1},function(e){e.result?(a.exportRomMap=e.data.romMap,a.content=e.data.content,a.exportHasApply=e.data.hasApply,a.exportHasNotApply=e.data.hasNotApply,a.$apply(),$(".export").dialog()):alert(e.message)})}}]).controller("surveyingMapInformationCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.no="暂无数据",a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.hostname=t.server().host;var s=t.server().userId;a.locationHerf=function(e){o.go(e,{projectid:a.projectId,roomId:a.roomId,approveId:a.approveId,number:e})},function(){new Promise(function(e,r){t.server().zjprojectdeleteById({id:a.projectId,userId:s},function(t){!0===t.result?(a.project2=t.data.project,a.$apply(),e(a.project2)):alert(t.message)})})}(),Promise.all([function(){return new Promise(function(e,r){t.server().surveyingList({roomId:a.roomId,type:2},function(t){!0===t.result?(a.surveyingList=t.data,a.$apply(),e(a.surveyingList)):alert(t.message)})})}()]).then(function(e){return e},function(e){}),t.server().surveyingInformationById({roomId:a.roomId},function(e){!0===e.result?(a.surveyInfo=e.data,a.singleList=e.data.singleList,a.surveyList=e.data.surveyList,a.housesImg=e.data.housesImg,a.arr=[],a.arr2=[],a.arr3=[],a.arr4=[],a.arr5=[],a.arr6=[],a.surveyList.forEach(function(e,t){switch(a.surveyList[t].compensateName){case"擅改商业":a.arr.push(a.surveyList[t]);break;case"临时建筑物":a.arr2.push(a.surveyList[t]);break;case"夹层":a.arr3.push(a.surveyList[t]);break;case"查违信息":a.arr4.push(a.surveyList[t]);break;case"宅基地":a.arr5.push(a.surveyList[t]);break;case"住宅":a.arr6.push(a.surveyList[t])}}),a.$apply()):alert(e.message)})}]).controller("surveyingAffixCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){var s=t.server().userId;a.projectId=o.params.projectid,a.roomId=o.params.roomId,a.no="-",a.locationHerf=function(e){o.go(e,{projectid:a.projectId,roomId:a.roomId,approveId:a.approveId,number:e})};!function(){new Promise(function(e,r){t.server().zjprojectdeleteById({id:a.projectId,userId:s},function(t){!0===t.result&&t.data.project?(a.project2=t.data.project,a.$apply(),e(t.data.project)):alert(t.message)})})}();Promise.all([function(){return new Promise(function(e,r){t.server().enclorurelist({propertyId:a.roomId},function(t){!0===t.result&&t.data?(e(t.data),a.$apply()):alert(t.message)})})}()]).then(function(e){a.total=0,a.list=e[0],a.list.forEach(function(e,t){a.total+=a.list[t].propertyAttachments.length}),a.$apply()},function(e){}),a.DownSave=function(e){var r=t.server().host,o=r+"propertyAttachment/attachmentDownload.do";a.link=o+"?id="+e}}]).controller("projectwarmCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){var s=t.server().userId;a.projectId=o.params.projectid,a.no="-",t.server().zjprojectprocessqueryFlowPathdo({userId:s},function(e){e.result?(a.warm=e.data,a.$apply()):alert(e.message)})}]).controller("amendantRecordCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){a.roomId=o.params.roomId,a.projectId=o.params.projectid,a.imgHost=t.server().imgHost,a.flag=!0,a.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:t.server().userId,toUserId:t.server().userId,type:3,status:2},a.conf={total:1,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1};t.server().zjoperationrecordqueryPropertyLogdo({roomId:a.roomId,pageNo:a.conf.currentPage||1,pageSize:a.conf.itemPageLimit||10},function(e){e.result?(a.rows=e.data.rows,a.rows.forEach(function(e,t){switch(e.type){case 100:a.rows[t].typeval="项目";break;case 200:a.rows[t].typeval="拆迁补偿规则";break;case 300:a.rows[t].typeval="签约佣金规则";break;case 400:a.rows[t].typeval="综合业务佣金规则";break;case 500:a.rows[t].typeval="违建佣金规则";break;case 600:a.rows[t].typeval="测绘信息";break;case 700:a.rows[t].typeval="财务结算设置";break;case 800:a.rows[t].typeval="补偿方案";break;case 900:a.rows[t].typeval="收款人信息变更";break;case 1e3:a.rows[t].typeval="收款信息";break;case 1100:a.rows[t].typeval="合同审批";break;case 1200:a.rows[t].typeval="合同模板审批";break;case 1400:a.rows[t].typeval="佣金信息审批(查违)";break;case 1600:a.rows[t].typeval="拆迁补偿规则 一级删除";break;default:a.rows[t].typeval="拆迁补偿规则"}}),a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$broadcast("categoryLoaded"),a.$apply()):alert(e.message)}),a.goback=function(){a.flag=!0},a.localtion=function(e){a.flag=!1,console.log(a.rows[e].type,a.rows[e].status),a.userName=a.rows[e].userName,a.createTime=a.rows[e].createTime,a.locationFrefFlag=a.rows[e].type,a.updateStatus=a.rows[e].status,t.server().zjoperationrecordfindByPropertyLogdo({id:a.rows[e].id,type:a.rows[e].type,status:a.rows[e].status},function(e){if(e.result){if(e.data.approvalMsg=e.data.detailMap,e.data.approvalMsg){if("0"!=a.locationFrefFlag&&"200"!=a.locationFrefFlag||(a.rules=e.data.approvalMsg),"300"==a.locationFrefFlag&&(a.rulesdata=[],a.rulesdata[0]=e.data.approvalMsg),"400"==a.locationFrefFlag&&(2==a.updateStatus?a.yewu=e.data.approvalMsg.serviceMap:a.yewu=e.data.approvalMsg),"500"==a.locationFrefFlag&&(2==a.updateStatus?a.weijian=e.data.approvalMsg.updateFrontMap:a.weijian=e.data.approvalMsg),"600"==a.locationFrefFlag&&(1==a.updateStatus?(a.updataBehindMap=e.data.detailMap.updataBehindMap,(a.updataBehindMap.singleList||a.updataBehindMap.surveyList)&&(a.fileUrl=a.updataBehindMap.fileUrl,a.singleList=a.updataBehindMap.singleList,a.surveyList=a.updataBehindMap.surveyList)):(a.surveyInfo=e.data.approvalMsg,a.singleList=a.surveyInfo.singleList,a.surveyList=a.surveyInfo.surveyList,a.housesImg=a.surveyInfo.housesImg)),"700"==a.locationFrefFlag&&(a.content=e.data.approvalMsg.content,a.detail=e.data.approvalMsg.detail,a.settlement=e.data.approvalMsg.settlement),"800"==a.locationFrefFlag&&(a.compensatePlanArr=e.data.detailMap.updataBehindMap.listPlans,a.mapCompensate=e.data.detailMap.updataBehindMap,a.topData=[],a.bottomData=[],a.compensatePlanArr&&a.compensatePlanArr.length>0)){for(var t=0;t<a.compensatePlanArr.length;t++)"0"==a.compensatePlanArr[t].identification?a.topData.push(a.compensatePlanArr[t]):a.bottomData.push(a.compensatePlanArr[t]);a.topData.forEach(function(e,t){1==a.topData[t].area.status&&(a.topData[t].area=a.topData[t].area.value,a.topData[t].areaflag=!0),1==a.topData[t].replacementRatio.status&&(a.topData[t].replacementRatio=a.topData[t].replacementRatio.value,a.topData[t].replacementRatioflag=!0),1==a.topData[t].builtInArea.status&&(a.topData[t].builtInArea=a.topData[t].builtInArea.value,a.topData[t].builtInAreaflag=!0),1==a.topData[t].builtInPeriod.status&&(a.topData[t].builtInPeriod=a.topData[t].builtInPeriod.value,a.topData[t].builtInPeriodflag=!0)}),a.bottomData.forEach(function(e,t){1==a.bottomData[t].area.status&&(a.bottomData[t].area=a.bottomData[t].area.value,a.bottomData[t].areaflag=!0),1==a.bottomData[t].compensatePrice.status&&(a.bottomData[t].compensatePrice=a.bottomData[t].compensatePrice.value,a.bottomData[t].compensatePriceflag=!0),1==a.bottomData[t].compensationAmount.status&&(a.bottomData[t].compensationAmount=a.bottomData[t].compensationAmount.value,a.bottomData[t].compensationAmountflag=!0),"0"==a.bottomData[t].priceMode&&(a.bottomData[t].compensationAmount=a.bottomData[t].compensatePrice)}),a.totalMoneyCompensateflag=1==a.mapCompensate.totalMoneyCompensate.status,a.totalMoneyCompensate=1==a.mapCompensate.totalMoneyCompensate.status?a.mapCompensate.totalMoneyCompensate.value:a.mapCompensate.totalMoneyCompensate,a.monthlyInterimCompensateflag=1==a.mapCompensate.monthlyInterimCompensate.status,a.monthlyInterimCompensate=1==a.mapCompensate.monthlyInterimCompensate.status?a.mapCompensate.monthlyInterimCompensate.value:a.mapCompensate.monthlyInterimCompensate}if("900"==a.locationFrefFlag||"1000"==a.locationFrefFlag)switch(a.payee=e.data.approvalMsg,a.payee.recieveType){case 1:a.payee.recieveType="业权人收款";break;case 2:a.payee.recieveType="其他人代收款";break;case 3:a.payee.recieveType="未满18岁监护人待收款";break;case 4:a.payee.recieveType="关联其他业权人收款"}"1100"==a.locationFrefFlag&&(a.contractApprove=e.data.approvalMsg,a.pactflag=!0),"1200"==a.locationFrefFlag&&(a.ContractTemplates=e.data.approvalMsg,$(".basic-look-text").html(a.ContractTemplates.content),a.pactflag=!0),"1400"==a.locationFrefFlag&&(a.transgressMap=e.data.approvalMsg.transgressMap,a.attachmentList=e.data.approvalMsg.attachmentList),"1600"!=a.locationFrefFlag&&"0"!=a.locationFrefFlag||(a.rules=e.data.approvalMsg)}a.$apply()}else alert(e.message)})}}]).controller("informationChangeCtrl",["$http","$scope","server","dict","$state","$q",function(e,a,t,r,o,n){function s(e){t.server().zjoperationrecordqueryPropertyTakedo({userId:i,pageSize:10,pageNo:e||1},function(e){e.result?(a.warm=e.data.rows,a.conf.total=Math.ceil(e.data.total/e.data.pageSize),a.conf.counts=e.data.total,a.$broadcast("categoryLoaded"),a.$apply()):alert(e.message)})}var i=t.server().userId;a.projectId=o.params.projectid,a.no="-",a.conf={total:10,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},a.$watch("conf.currentPage + conf.itemPageLimit+projectnameinput",function(e){s(a.conf.currentPage),console.log(a.conf.currentPage)}),a.shenpi=function(){window.localStorage.setItem("j","totalPropertyList")}}]);