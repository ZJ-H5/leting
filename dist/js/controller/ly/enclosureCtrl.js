angular.module("app").controller("enclosureCtrl",["$http","$scope","dict","server","$state","fileUpload",function(e,t,r,a,o,s){function n(){a.server().enclorurelist({propertyId:t.roomId},function(e){if(!0===e.result){t.lists=e.data;var r=0;for(var a in t.lists)r+=t.lists[a].propertyAttachments.length;t.length=r,t.$apply()}else alert(e.message)},function(){alert("404请求失败")})}function l(r,o,s){var l=new FormData;l.append("multipartFile",r),e({method:"POST",url:t.host+"attachment/fielUpload.do",data:l,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){t.data=e.data.data,console.log(e),t.fileName=t.data.fileName,t.filePath=t.data.filePath,t.size=t.data.size;var r={filePath:t.filePath,fileName:t.fileName};a.server().enclosursave({attachment:JSON.stringify(r),propertyId:t.roomId,createUser:i,type:o},function(e){!0===e.result?(t.count++,n(),s==t.count&&alert(e.message),t.$apply()):alert(e.message)},function(e){})})}t.roomId=o.params.roomId,t.projectId=o.params.projectid,t.host=a.server().imgHost;var i=a.server().userId;t.list={roomId:o.params.roomId,projectId:o.params.roomId,createUser:a.server().userId,toUserId:a.server().userId,type:3,status:2},t.listtop={projectId:o.params.projectid,roomId:o.params.roomId,createUser:a.server().userId,imgHost:t.host,questiontype:4,projectflag:2,reloadajax:1,locationflag:1},a.server().zjprojectdeleteById({id:t.projectId,userId:i},function(e){!0===e.result?(t.project2=e.data.project,t.project2.createTime=r.timeConverter(t.project2.createTime),t.project2&&(t.project2.updateTime=r.timeConverter(t.project2.updateTime)),t.$apply()):alert(e.message)},function(){alert("404请求失败")}),n(),t.addannex=function(e,r){t.count=0;for(var a=0;a<e.length;a++)l(e[a],r,e.length)},t.downenclosure=function(e){var r=t.host+"propertyAttachment/attachmentDownload.do";t.link=r+"?id="+e},t.deleteenclosure=function(e){a.server().deleteenclosure({id:e},function(e){!0===e.result?(alert(e.message),n(),t.$apply()):alert(e.message)},function(e){})}}]);