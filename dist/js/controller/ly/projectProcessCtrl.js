angular.module("app").controller("projectProcessCtrl",["$http","$scope","dict","server","$compile","$state",function(e,a,t,s,n,o){a.projectId=o.params.projectid;s.server().userId;!function(){s.server().processlist({id:a.projectId},function(e){!0===e.result?(a.list=e.data,a.$apply()):alert(e.message)},function(){alert("404请求失败")})}(),a.savebntprocess=function(){s.server().updateaccomplish({projectId:"044e348bd2484505a110a29bb08126c3"},function(e){alert(e.message)})}}]),angular.module("app").controller("projectProcessInformationCtrl",["$http","$scope","dict","server","$state","$rootScope","$compile","$cookieStore",function(e,a,t,s,n,o,r,i){function l(){s.server().processlist({projectId:a.projectId},function(e){!0===e.result?(a.list=e.data,console.log(e.data),a.$apply()):alert(e.message)},function(){alert("404请求失败")})}function c(e,t,n,o,r){o.forEach(function(e,a){e.processName||o.splice(a,1)}),s.server().addNewProcessNode({projectId:a.projectId,type:2,planTime:a.planTime,processName:n,createUser:f,parentId:e,rank:JSON.stringify(o),functionList:JSON.stringify(t)},function(e){!0===e.result?(alert(e.message,function(){$("."+r).hide(),$(".saveDisabled").removeAttr("disabled"),l(),m()}),a.$apply()):alert(e.message,function(){$(".saveDisabled").removeAttr("disabled"),l(),m()})},function(){alert("404请求失败",function(){$(".saveDisabled").removeAttr("disabled"),l(),m()})})}function d(e){s.server().watchAttachmentList({dataId:e},function(e){!0===e.result?(a.fileList=e.data,a.$apply()):alert(e.message)},function(){alert("404请求失败")})}function p(e){s.server().searchPeopleName({searchKeys:e},function(e){!0===e.result?(a.searchlist=e.data,a.$apply()):alert(e.message)},function(e){})}function m(){a.fileName="",a.remark="",a.completeTime="",a.peoplename="",a.processName="",a.planTime="",a.colors=[{key:1,name:"负责人",status:!0},{key:2,name:"完成时间",status:!0},{key:3,name:"备注",status:!0}],a.processNameList=[{processName:""}],a.processName2="",a.flag=!1,a.flag2=!0}function u(e){s.server().watchPreposeList({parentId:e},function(e){!0===e.result?(a.watchList=e.data,a.$apply()):alert(e.message)},function(e){})}a.projectId=n.params.projectid;var f=s.server().userId;a.hostname=s.server().imgHost,a.completeTime="",a.remark="";var g=window.localStorage;a.list={projectId:n.params.projectid,createUser:s.server().userId,toUserId:s.server().userId,type:3,status:1},a.listtop={roomId:n.params.projectid,projectId:n.params.projectid,paciId:a.pactId,createUser:s.server().userId,imgHost:s.server().imgHost,questiontype:4,projectflag:1,reloadajax:1,locationflag:1},l(),a.check={peoplenameFlag:!1,completeTimeFlag:!1},a.colors=[{key:1,name:"负责人",status:!0},{key:2,name:"完成时间",status:!0},{key:3,name:"备注",status:!0}],a.flag=!1,a.flag2=!0,a.addfirst=function(e){$("."+e).dialog()},a.addsecond=function(e,t){$("."+t).dialog(),a.parentId=e},a.addcondition=function(){a.processNameList.push({processName:""})},a.processNameList=[{processName:""}],a.savebnt=function(e){$(".saveDisabled").attr("disabled","disabled");for(var t=[],s=0;s<a.colors.length;s++)1==a.colors[s].status&&t.push({key:a.colors[s].key});g.setItem("firstTime",e),c(0,t,a.processName,a.processNameList,"addnew")},a.savebnt2=function(e){$(".saveDisabled").attr("disabled","disabled");for(var t=[],s=0;s<a.colors.length;s++)1==a.colors[s].status&&t.push({key:a.colors[s].key});g.setItem("firstTime",a.planTime),c(e,t,a.processName2,a.processNameList,"addnewson")},a.addinfo=function(e,t,s,n){if($("."+t).dialog(),s.length)for(var o=0;o<s.length;o++)1==s[o].keyAssignments?(a.detailId1=s[o].detaillsId,a.peoplename=s[o].userName,a.nameVal=s[o].val):2==s[o].keyAssignments?(a.detailId2=s[o].detaillsId,a.remark=s[o].val):3==s[o].keyAssignments?(a.detailId3=s[o].detaillsId,a.remark=s[o].val):4==s[o].keyAssignments&&(a.detailId4=s[o].detaillsId,a.remark=s[o].val);a.processid=e},a.mychange=function(e,t,s,n){var o="";a.list.forEach(function(e,a){e.id==n?o=e.planTime:e.twoStage.forEach(function(e,a){e.id==n&&(o=e.planTime)})}),o?laydate.render({elem:"."+e,format:"yyyy-MM-dd",show:!0,max:o,closeStop:"."+t,done:function(e){1==s?a.completeTime=e:a.planTime=e,a.$apply()}}):laydate.render({elem:"."+e,format:"yyyy-MM-dd",show:!0,closeStop:"."+t,done:function(e){1==s?a.completeTime=e:a.planTime=e,a.$apply()}})},a.addannex=function(t,n){var o=new FormData,r=n[0];a.filename=r.name,o.append("multipartFile",r),e({method:"POST",url:a.hostname+"attachment/fielUpload.do",data:o,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){a.data=e.data.data,a.fileName=a.data.fileName,a.filePath=a.data.filePath,a.size=a.data.size;var n=[{size:a.data.size,fileName:a.data.fileName,filePath:a.data.filePath}];s.server().addAttachment({dataId:t,userId:f,jsonString:JSON.stringify(n)},function(e){!0===e.result?(alert(e.message,function(){l()}),a.$apply()):alert(e.message)},function(){alert("404请求失败")})},function(e){alert(e)})},a.watchFile=function(e,t){$("."+e).dialog(),d(t),a.processid=t},a.downloadFile=function(e){a.link=a.hostname+"attachment/fileDownload.do?id="+e},a.deleteFile=function(e){s.server().deleteAttachment({id:e},function(e){!0===e.result?(alert(e.message,function(){d(a.processid)}),a.$apply()):alert(e.message)},function(){alert("404请求失败")})},a.check={peoplenameFlag:!1},a.addInfoList=function(e,t,n,o,r,i){if($(".saveDisabled").attr("disabled","disabled"),!a.peoplename)return a.check.peoplenameFlag=!0,void $(".saveDisabled").removeAttr("disabled");var c=[];n&&c.push({id:n,val:t||""}),""!=a.completeTime&&c.push({id:o,val:a.completeTime||""}),""!=a.remark&&c.push({id:r,val:a.remark||""});var d=0;""!=a.completeTime&&(d=1),s.server().addInfoData({id:e,detailJson:JSON.stringify(c),type:d},function(e){!0===e.result?(alert(e.message,function(){l(),$(".addinfo").hide(),m(),$(".saveDisabled").removeAttr("disabled")}),a.$apply()):alert(e.message,function(){m(),$(".saveDisabled").removeAttr("disabled")})},function(){alert(data.message,function(){m(),$(".saveDisabled").removeAttr("disabled")})})},a.complete=function(e,t){s.server().completeprocess({id:e},function(e){!0===e.result?(alert(e.message,function(){u(t)}),a.$apply()):alert(e.message)},function(){alert("404请求失败")})},a.ulshow=function(e){$(".ulshow").show(500),p()},a.ulcancel=function(e){a.check.peoplenameFlag=!e,$(".ulshow").hide(500),a.peoplename=""},a.timecancel=function(e){a.check.completeTimeFlag=!e},a.remarkcancel=function(e){a.check.remarkFlag=!e},a.serachsomthing=function(e){p(e)},a.getname=function(e,t){a.peoplename=t,a.check.peoplenameFlag=!1,a.selid=e},a.delete=function(e){confirm("确定删除？",function(){s.server().deleteprocess({id:e},function(e){!0===e.result?(alert(e.message,function(){l()}),a.$apply()):alert(e.message)},function(e){})})},a.cancel=function(){m()},a.watchPrepose=function(e,t){$("."+t).dialog(),u(e),a.parentid=e}}]);