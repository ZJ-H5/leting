"use strict";angular.module("app").controller("dataHierarchyCtrl",["$http","$scope","server","$state",function(e,a,t,n){function s(){t.server().dataHierarchyList({projectId:l},function(e){if(!0===e.result){for(var t=e.data,n={},s=0;s<t.length;s++)n[s]=t[s];JSON.stringify(n),a.dataList=n,a.$apply()}else alert(e.message)},function(e){})}var r=0;a.getroom=function(e){r=e?1:0};var l=n.params.projectid,i=t.server().userId;a.searchKeys="",a.flag=!1,a.category="",a.nameJson=[{shemaName:""}],a.nameJsonFlag=[!1],a.cjsave=function(){$(".saveDisabled").attr("disabled","disabled");var e=!0,n=!1,s=void 0;try{for(var o,d=a.nameJson[Symbol.iterator]();!(e=(o=d.next()).done);e=!0){if(!o.value.shemaName)return void $(".saveDisabled").removeAttr("disabled")}}catch(e){n=!0,s=e}finally{try{!e&&d.return&&d.return()}finally{if(n)throw s}}var c=!0,m=!1,f=void 0;try{for(var u,v=a.nameJsonFlag[Symbol.iterator]();!(c=(u=v.next()).done);c=!0){if(u.value)return void $(".saveDisabled").removeAttr("disabled")}}catch(e){m=!0,f=e}finally{try{!c&&v.return&&v.return()}finally{if(m)throw f}}t.server().dataHierarchySave({createUser:i,isRoom:r,parkId:l,category:a.category,nameJson:JSON.stringify(a.nameJson)},function(e){!0===e.result?(alert(e.message,function(){$(".saveDisabled").removeAttr("disabled"),window.location.reload()}),a.$apply()):alert(e.message,function(){$(".saveDisabled").removeAttr("disabled")})},function(e){alert(e,function(){$(".saveDisabled").removeAttr("disabled")})})},a.nameJsonFlagFn=function(e,t){"sublevelList"==t?a.sublevelList.forEach(function(t,n){if(n!=e)return t.shemaName==a.sublevelList[e].shemaName?(console.log(a.nameJsonFlag),a.nameJsonFlag[e]=!0,void(a.nameJsonFlag[n]=!0)):(a.nameJsonFlag[e]=!1,void(a.nameJsonFlag[n]=!1))}):a.nameJson.forEach(function(t,n){if(n!=e)return t.shemaName==a.nameJson[e].shemaName?(console.log(a.nameJsonFlag),a.nameJsonFlag[e]=!0,void(a.nameJsonFlag[n]=!0)):(a.nameJsonFlag[e]=!1,void(a.nameJsonFlag[n]=!1))})},s(),a.flag=!1,a.flag2=!1,a.flag3=!1,a.flag4=!1,a.flag5=!1,a.add=function(e,n,s,r){console.log(r.parentId);var l=r.parentId;"0"==e?a.flag=!a.flag:"1"==e?a.flag2=!a.flag2:"2"==e?a.flag3=!a.flag3:"3"==e?a.flag4=!a.flag4:"4"==e&&(a.flag5=!a.flag5),t.server().dataInit({schemaId:l},function(e){!0===e.result?(a.dataInit=e.data,a.$apply()):alert(e.message)},function(e){}),console.log(n)},a.myselect=function(e){t.server().dataInitTwice({parentId:e},function(e){!0===e.result?(a.dataTwice=e.data,a.$apply()):alert(e.message)},function(e){})},a.myselect2=function(e){t.server().dataInitTwice({parentId:e},function(e){!0===e.result?(a.dataThird=e.data,a.$apply()):alert(e.message)},function(e){})},a.myselect3=function(e){t.server().dataInitTwice({parentId:e},function(e){!0===e.result?(a.dataForth=e.data,a.$apply()):alert(e.message)},function(e){})},a.saveall=function(e,n,r){$(".saveDisabled").attr("disabled","disabled"),t.server().adddata({parkId:l,parentId:e,createUser:i,objName:n,schemaId:r},function(e){!0===e.result?(console.log(e.message),alert("添加成功",function(){s(),$(".saveDisabled").removeAttr("disabled")}),a.$apply()):alert(e.message,function(){$(".saveDisabled").removeAttr("disabled")})},function(e){alert(e.message,function(){$(".saveDisabled").removeAttr("disabled")})})},a.delete=function(e){confirm("确认删除？",function(){t.server().deleteDataHierarchy({id:e},function(e){!0===e.result?(alert(e.message),s(),a.$apply()):alert(e.message)},function(e){})})},a.forth=!1,a.five=!1,a.zjm=!0;a.addlevel=function(){a.nameJson.push({shemaName:""}),a.nameJsonFlag.push(!1)},a.cancel=function(){a.nameJson=[{shemaName:""}],a.category="",a.sublevelList=[{shemaName:""}],a.nameJsonFlag=[!1]},a.editData=function(e,n){$("."+e).dialog(),t.server().editDH({id:n},function(e){!0===e.result?(a.editcategory=e.data.category,a.isRoom=1==e.data.isRoom,a.sublevelList=e.data.sublevelList,a.sublevelList.forEach(function(e,t){a.sublevelList.length>2&&a.nameJsonFlag.push(!1)}),a.$apply()):alert(e.message)},function(e){}),a.dhId=n},a.cjUpdate=function(e){$(".saveDisabled").attr("disabled","disabled");var n=[{id:"",shemaName:""}];a.sublevelList.forEach(function(e,a){n[a]={id:e.id,shemaName:e.shemaName}}),t.server().editSaveDH({id:e,updateUser:i,category:a.editcategory,isRoom:a.isRoom?1:0,nameJson:JSON.stringify(n)},function(e){!0===e.result?(alert(e.message,function(){$(".editData").hide(),s(),$(".saveDisabled").removeAttr("disabled")}),a.$apply()):alert(e.message,function(){$(".saveDisabled").removeAttr("disabled")})},function(e){alert(e.message,function(){$(".saveDisabled").removeAttr("disabled")})})},a.deleteSublevel=function(e,n){confirm("确认删除"+e+"?",function(){t.server().deleteDH({id:n,userId:i},function(e){!0===e.result?(alert(e.message,function(){s()}),a.$apply()):alert(e.message)},function(e){})})}}]);