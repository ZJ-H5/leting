angular.module("app").controller("propertyInfoCtrl",["$http","$scope","server","$state","$cookieStore",function(e,t,a,o,r){function n(){a.server().projectnamesel({projectId:t.projectId},function(e){!0===e.result?(t.projectname=e.data.projectName,t.number=e.data.number,t.$apply()):alert(e.message)})}function c(e,o,r){t.propertys=[],a.server().prpManageCtrlFn({userId:i,projectId:t.projectId,searchKeys:e||"",schemaId:o||"",pageNo:r||1,pageSize:t.conf.itemPageLimit?t.conf.itemPageLimit:10},function(e){!0===e.result?(t.propertys=e.data.rows,t.total=e.data.total,t.conf.total=Math.ceil(e.data.total/e.data.pageSize),t.conf.counts=e.data.total,t.$broadcast("categoryLoaded"),t.$apply()):alert(e.message)})}function s(e){a.server().zjroomlistSearchdo({projectId:t.projectId},function(a){!0===a.result?a.data.length>0&&(t.newHousData=a.data,t.newHousData.forEach(function(e,a){t.newHousData[a].indx=a}),t.$apply(),$("."+e).dialog()):alert(a.message)})}var d=window.localStorage;if(o.params.projectid){o.params.projectid;t.projectId=o.params.projectid}else t.projectId=d.getItem("a");var i=a.server().userId;t.searchKeys="",t.flag=!1,t.no="/",n(),function(){a.server().zjroomsearchForConditiondo({projectId:t.projectId},function(e){if(!0===e.result){t.dataCheckbox=e.data;for(var a=0;a<t.dataCheckbox.length;a++)t.dataCheckbox[a].state=!1;t.$apply()}else alert(e.message)})}(),t.selected=[],t.selectAll=!0,t.updateSelection=function(e,a,o){if(e.target.checked)t.selected.push(a);else{var r=t.selected.indexOf(a);t.selected.splice(r,1)}0===t.selected.length?t.selectAll=!0:t.selectAll=!1,c(t.searchKeys,t.selected.join(","),t.conf.currentPage)},t.checkobxAll=function(e,a){if(!1===e&&0===t.selected.length&&(t.selectAll=!0),!0===e){t.selected=[];for(var o=0;o<t.dataCheckbox.length;o++)t.dataCheckbox[o].state=!1}c(t.searchKeys,t.selected.join(","),t.conf.currentPage)},t.conf={total:6,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},t.$watch("conf.currentPage + conf.itemPageLimit+searchKeys",function(e){c(t.searchKeys,t.selected.join(","),t.conf.currentPage)}),t.search=function(){c(t.searchKeys,t.selected.join(","),t.conf.currentPage)},t.edit=function(e,r,n){a.server().zjroominitUpdatedo({id:e,schemaId:r},function(a){!0===a.result?o.go("NewBuildingStandard",{id:e,schemaId:r,projectid:t.projectId}):alert(a.message)})},t.dels=function(e,o){confirm("确认删除该条吗？",function(){a.server().zjroomdeleteByIddo({id:e,userId:i},function(e){!0===e.result?(t.propertys.splice(o,1),n(),c("","",t.conf.currentPage),alert(e.message),t.$apply()):alert(e.message)})})},t.xinzeng=function(){s("supper")},t.NewHousingStandards=function(e,t){(e||t)&&a.server().zjroominitAdddo({projectId:e,schemId:t},function(a){!0===a.result?o.go("NewHousingStandards",{packid:e,id:t}):alert(a.message,function(){o.go("dataHierarchy",{projectid:e})})})},t.import=function(){s("import")},t.export=function(){s("export")},t.Down=function(){s("Down")},t.fileNameChanged=function(o,r,n){var c=new FormData,s=o.target;if(o.target.files[0]){var d=o.target.files[0],l=$(s).attr("useindx"),p=t.newHousData[l].parkId,u=t.newHousData[l].id;c.append("multipartFile",d),c.append("projectId",p),c.append("schemaId",u),c.append("userId",i),$(".import").fadeOut(200),e({method:"POST",url:a.server().host2+"room/leadingIn.do",data:c,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(e){s.value="",!0===e.data.result?alert("导入成功",function(){location.reload()}):alert(e.data.message)})}},t.exportSave=function(e,o,r){if(o&&e){var n=a.server().host2,c=n+"room/export.do";t.link=c+"?schemaId="+o+"&projectId="+e+"&userId="+i}},t.DownSave=function(e,o,r,n){if(o&&e){var c=a.server().host2,s=c+"room/templet.do";t.link=s+"?schemaId="+o}}}]);