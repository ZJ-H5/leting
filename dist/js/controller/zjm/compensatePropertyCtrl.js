"use strict";angular.module("app").controller("compensatePropertyCtrl",["$http","$scope","server","$state","dict","$rootScope",function(a,t,o,e,d,r){function m(){t.topData=[],t.bottomData=[],o.server().zjqueryCompensationInfodo({propertyId:t.roomId},function(a){if(!0===a.result){if(a.data.length>0){t.deleteId=a.data[0].compensateId;for(var o=0;o<a.data.length;o++)0===a.data[o].Identification?t.topData.push(a.data[o]):t.bottomData.push(a.data[o]);for(var e=0;e<t.topData.length;e++)t.topData[e].area=Number(t.topData[e].area).toFixed(2)||0,t.topData[e].replacementRatio=Number(t.topData[e].replacementRatio)||0,t.topData[e].builtInArea=Number(t.topData[e].builtInArea).toFixed(2)||0;for(var d=0;d<t.bottomData.length;d++)t.bottomData[d].area=Number(t.bottomData[d].area).toFixed(2)||0,t.bottomData[d].compensatePrice=Number(t.bottomData[d].compensatePrice).toFixed(2)||0,t.bottomData[d].compensationAmount=Number(t.bottomData[d].compensationAmount).toFixed(2)||0,"0"==t.bottomData[d].priceMode?t.bottomData[d].compensationAmount=t.bottomData[d].compensatePrice:1===t.bottomData[d].status&&1===t.bottomData[d].isRestricted&&t.bottomData[d].restrictedArea&&t.bottomData[d].area>=t.bottomData[d].restrictedArea&&(t.bottomData[d].area=Number(t.bottomData[d].restrictedArea).toFixed(),t.bottomData[d].disablessss=!0);t.totalMoneyCompensate=t.bottomData[0].totalMoneyCompensate?Number(t.bottomData[0].totalMoneyCompensate).toFixed(2):0,t.monthlyInterimCompensate=t.bottomData[0].monthlyInterimCompensate?Number(t.bottomData[0].monthlyInterimCompensate).toFixed(2):0,t.$apply()}}else alert(a.message)})}function n(a,e){if(t.addtopData=[],t.addbottomData=[],t.topTemporaryArray=[],t.bottomTemporaryArray=[],t.planDetails=[],t.addTotalMoney=0,t.addMonthMoney=0,o.server().zjsettingsinitPeriodsdo({},function(a){!0===a.result?(t.selectval=a.data,t.$apply()):alert(a.message)},function(){}),"add"==e){for(var d=0;d<a.length;d++)0===a[d].compensationWay?t.topTemporaryArray.push(a[d]):t.bottomTemporaryArray.push(a[d]);for(var r=0;r<t.topTemporaryArray.length;r++)t.addtopData[r]={Identification:0,compensationId:t.topTemporaryArray[r].compensationTypeId,programmeValue:t.topTemporaryArray[r].compensateTypeName,childId:t.topTemporaryArray[r].childId,subtypeName:t.topTemporaryArray[r].childName,area:t.topTemporaryArray[r].area?Number(t.topTemporaryArray[r].area).toFixed(2):0,replacementRatio:t.topTemporaryArray[r].replacementRatio?Number(t.topTemporaryArray[r].replacementRatio):0,builtInArea:((Number(t.topTemporaryArray[r].area)||0)*(t.topTemporaryArray[r].replacementRatio?Number(t.topTemporaryArray[r].replacementRatio)/100:0)).toFixed(2),rebuiltTypeId:t.topTemporaryArray[r].rebuiltTypeId,builtType:t.topTemporaryArray[r].rebuiltTypeName,builtInPeriod:0,priceMode:t.topTemporaryArray[r].priceMode,disabled:!!t.topTemporaryArray[r].area,rulesId:t.topTemporaryArray[r].rulesId};for(var m=0;m<t.bottomTemporaryArray.length;m++)t.addbottomData[m]={Identification:1,compensateProjectId:t.bottomTemporaryArray[m].compensateProjectId,programmeName:t.bottomTemporaryArray[m].compensationProjectName,compensationId:t.bottomTemporaryArray[m].compensationTypeId,programmeValue:t.bottomTemporaryArray[m].compensateTypeName,childId:t.bottomTemporaryArray[m].childId,subtypeName:t.bottomTemporaryArray[m].childName,area:t.bottomTemporaryArray[m].area?Number(t.bottomTemporaryArray[m].area).toFixed(2):0,compensationAmount:"0"==t.bottomTemporaryArray[m].priceMode?Number(t.bottomTemporaryArray[m].compensationPrice).toFixed(2)||0:((Number(t.bottomTemporaryArray[m].area)||0)*(Number(t.bottomTemporaryArray[m].compensationPrice)||0)).toFixed(2),compensatePrice:t.bottomTemporaryArray[m].compensationPrice?Number(t.bottomTemporaryArray[m].compensationPrice).toFixed(2):0,priceMode:t.bottomTemporaryArray[m].priceMode,compensationAmountAjax:"0"==t.bottomTemporaryArray[m].priceMode?Number(t.bottomTemporaryArray[m].compensationPrice).toFixed(2)||0:((Number(t.bottomTemporaryArray[m].area)||0)*(Number(t.bottomTemporaryArray[m].compensationPrice)||0)).toFixed(2),disabled:"0"==t.bottomTemporaryArray[m].priceMode,status:t.bottomTemporaryArray[m].status,isRestricted:t.bottomTemporaryArray[m].isRestricted,restrictedArea:t.bottomTemporaryArray[m].restrictedArea,areaIdsabled:"0"==t.bottomTemporaryArray[m].priceMode,areaplaceholder:"0"==t.bottomTemporaryArray[m].priceMode?"补偿总价":"请输入...",rulesId:t.bottomTemporaryArray[m].rulesId};for(var n=0;n<t.addbottomData.length;n++)"0"!=t.addbottomData[n].priceMode&&1===t.addbottomData[n].status&&1===t.addbottomData[n].isRestricted&&t.addbottomData[n].restrictedArea&&t.addbottomData[n].area>=t.addbottomData[n].restrictedArea&&(t.addbottomData[n].area=Number(t.addbottomData[n].restrictedArea).toFixed(),t.addbottomData[n].compensationAmount=(t.addbottomData[n].compensatePrice*t.addbottomData[n].area).toFixed(2),t.addbottomData[n].disabled=!0),t.addbottomData[n].compensationAmount||(t.addbottomData[n].compensationAmount=0),2===t.addbottomData[n].status&&(t.addMonthMoney+=Number(t.addbottomData[n].compensationAmount)),6!=t.addbottomData[n].status&&(t.addTotalMoney+=Number(t.addbottomData[n].compensationAmount));t.addMonthMoney=t.addMonthMoney.toFixed(2),t.addTotalMoney=t.addTotalMoney.toFixed(2)}else{for(var p=0;p<a.length;p++)0===a[p].Identification?t.addtopData.push(a[p]):t.addbottomData.push(a[p]);for(var i=0;i<t.addtopData.length;i++)t.addtopData[i].area=Number(t.addtopData[i].area).toFixed(2)||0,t.addtopData[i].replacementRatio=Number(t.addtopData[i].replacementRatio)||0,t.addtopData[i].builtInArea=Number(t.addtopData[i].builtInArea).toFixed(2)||0;for(var s=0;s<t.addbottomData.length;s++)t.addbottomData[s].area=Number(t.addbottomData[s].area).toFixed(2)||0,t.addbottomData[s].compensatePrice=Number(t.addbottomData[s].compensatePrice).toFixed(2)||0,t.addbottomData[s].compensationAmount=Number(t.addbottomData[s].compensationAmount).toFixed(2)||0,"0"==t.addbottomData[s].priceMode?(t.addbottomData[s].compensationAmount=t.addbottomData[s].compensatePrice,t.addbottomData[s].disabled=!0):1===t.addbottomData[s].status&&1===t.addbottomData[s].isRestricted&&t.addbottomData[s].restrictedArea&&(t.addbottomData[s].sendareadisabled=t.addbottomData[s].area,t.addbottomData[s].area>=t.addbottomData[s].restrictedArea&&(t.addbottomData[s].area=Number(t.addbottomData[s].restrictedArea).toFixed(),t.addbottomData[s].compensationAmount=(t.addbottomData[s].compensatePrice*t.addbottomData[s].area).toFixed(2),t.addbottomData[s].senddisabled=!0));console.log(t.addbottomData),t.addTotalMoney=t.addbottomData[0].totalMoneyCompensate?Number(t.addbottomData[0].totalMoneyCompensate).toFixed(2):0,t.addMonthMoney=t.addbottomData[0].monthlyInterimCompensate?Number(t.addbottomData[0].monthlyInterimCompensate).toFixed(2):0}t.$apply()}t.roomId=e.params.roomId,t.projectId=e.params.projectid,t.updatesaveFlag=!0,t.timedata=3e3;var p=o.server().userId;t.no="-",t.list={roomId:e.params.roomId,projectId:e.params.roomId,createUser:o.server().userId,toUserId:o.server().userId,type:3,status:2},t.listtop={projectId:e.params.projectid,roomId:e.params.roomId,createUser:o.server().userId,imgHost:o.server().imgHost,questiontype:4,projectflag:2,reloadajax:1,locationflag:1},m(),t.addlis=function(){o.server().zjinitCompensateRuledo({propertyId:t.roomId},function(a){!0===a.result?a.data?(t.lists=a.data,t.$apply(),$(".addlis").dialog()):alert("您没有添加拆迁补偿规则！"):alert(a.message)},function(){})},t.Detail=function(){console.log(t.deleteId),alert("确认删除补偿方案吗",function(){o.server().zjcompensationplandetailsdeleteByIddo({id:t.deleteId,userId:p},function(a){a.result?(alert(a.message),m(),t.$apply()):alert(a.message)})})},t.topngchanges=function(a,o){t.addtopData[o].replacementRatio||alert("请输入置换比例！"),a||alert("请输入置换面积！"),a.charCodeAt()>89||(t.addtopData[o].builtInArea=(a*t.addtopData[o].replacementRatio/100).toFixed(2))},t.updatetopngchanges=function(a,o,e){t.addtopData[o].area||alert("请输入置换面积！"),a||alert("请输入置换比例！"),a.charCodeAt()>89||(t.addtopData[o].builtInArea=(a/100*t.addtopData[o].area).toFixed(2))},t.topSelect=function(a,o){a||(t.addtopData[o].builtInPeriod=0,alert("请选择还建期数！")),t.addtopData[o].builtInPeriod=a},t.Middlengchanges=function(a,o,e){if(t.addTotalMoney=0,t.addMonthMoney=0,t.addbottomData[o].compensatePrice||alert("请输入补偿单价！"),a||alert("请输入补偿面积！"),!(a.charCodeAt()>89)){console.log(a,a.charCodeAt()),t.addbottomData[o].compensationAmount=(a*t.addbottomData[o].compensatePrice).toFixed(2);for(var d=0;d<t.addbottomData.length;d++)t.addbottomData[d].compensationAmount||(t.addbottomData[d].compensationAmount=0),"update"==e?2===t.addbottomData[d].status?t.addMonthMoney+=Number(t.addbottomData[d].compensationAmount):6!=t.addbottomData[d].status&&(t.addTotalMoney+=Number(t.addbottomData[d].compensationAmount)):2===t.bottomTemporaryArray[d].status?t.addMonthMoney+=Number(t.addbottomData[d].compensationAmount):6!=t.addbottomData[d].status&&(t.addTotalMoney+=Number(t.addbottomData[d].compensationAmount));t.addTotalMoney=t.addTotalMoney.toFixed(2),t.addMonthMoney=t.addMonthMoney.toFixed(2)}},t.updateMiddlengchanges=function(a,o,e){if(t.addTotalMoney=0,t.addMonthMoney=0,t.addbottomData[o].area||alert("请输入补偿面积！"),a||alert("请输入补偿单价！"),!(a.charCodeAt()>89)){"0"==t.addbottomData[o].priceMode?t.addbottomData[o].compensationAmount=a:t.addbottomData[o].compensationAmount=(a*t.addbottomData[o].area).toFixed(2);for(var d=0;d<t.addbottomData.length;d++)t.addbottomData[d].compensationAmount||(t.addbottomData[d].compensationAmount=0),"update"==e?(2===t.addbottomData[d].status&&(t.addMonthMoney+=Number(t.addbottomData[d].compensationAmount)),6!=t.addbottomData[d].status&&(t.addTotalMoney+=Number(t.addbottomData[d].compensationAmount))):(2===t.bottomTemporaryArray[d].status&&(t.addMonthMoney+=Number(t.addbottomData[d].compensationAmount)),6!=t.addbottomData[d].status&&(t.addTotalMoney+=Number(t.addbottomData[d].compensationAmount))),t.addTotalMoney+=Number(t.addbottomData[d].compensationAmount);t.addTotalMoney=t.addTotalMoney.toFixed(2),t.addMonthMoney=t.addMonthMoney.toFixed(2)}},t.add=function(a,e){o.server().zjqueryCompenPlando({id:a,roomId:t.roomId},function(a){!0===a.result&&a.data?a.data.length>0?(n(a.data,"add"),t.$apply(),$(".addtext").dialog()):alert("您没有添加拆迁补偿规则！"):alert(a.message)},function(){})},t.update=function(){o.server().zjqueryCompensationInfodo({propertyId:t.roomId},function(a){!0===a.result?a.data.length>0?(n(a.data,"update"),t.$apply(),$(".update").dialog()):alert("请先添加补偿方案信息！"):alert(a.message)},function(){}),d.timeouts(!1,2e3,function(a){t.tim=a}),console.log(t.tim)},t.addPersonsave=function(){if(t.updatesaveFlag){t.planDetails=[];for(var a=0;a<t.addtopData.length;a++)t.addtopData[a]={Identification:0,rulesId:t.addtopData[a].rulesId,compensationId:t.addtopData[a].compensationId,programmeValue:t.addtopData[a].programmeValue,childId:t.addtopData[a].childId,subtypeName:t.addtopData[a].subtypeName,area:t.addtopData[a].area,replacementRatio:t.addtopData[a].replacementRatio,builtInArea:t.addtopData[a].builtInArea,rebuiltTypeId:t.addtopData[a].rebuiltTypeId,builtType:t.addtopData[a].builtType,builtInPeriod:t.addtopData[a].builtInPeriod,priceMode:t.addtopData[a].priceMode},t.planDetails.push(t.addtopData[a]);for(var e=0;e<t.addbottomData.length;e++)t.addbottomData[e]={Identification:1,rulesId:t.addbottomData[e].rulesId,compensateProjectId:t.addbottomData[e].compensateProjectId,programmeName:t.addbottomData[e].programmeName,compensationId:t.addbottomData[e].compensationId,programmeValue:t.addbottomData[e].programmeValue,childId:t.addbottomData[e].childId,subtypeName:t.addbottomData[e].subtypeName,area:t.addbottomData[e].area,compensationAmount:t.addbottomData[e].compensationAmount,compensatePrice:t.addbottomData[e].compensatePrice,priceMode:t.addbottomData[e].priceMode},t.planDetails.push(t.addbottomData[e]);console.log(t.planDetails,t.addbottomData),o.server().zjaddCompensationPlando({planDetails:JSON.stringify(t.planDetails),propertyId:t.roomId,totalMoneyCompensate:t.addTotalMoney,monthlyInterimCompensate:t.addMonthMoney,createUser:p,projectId:t.projectId},function(a){!0===a.result?(alert(a.message),t.planDetails=[],m(),$(".addtext").fadeOut(200),t.$apply()):alert(a.message)},function(){}),t.updatesaveFlag=!1,d.timeouts(t.updatesaveFlag,t.timedata,function(a){t.updatesaveFlag=a})}},t.updatePersonalert=function(){$(".updateremarks").dialog(),$(".update").fadeOut(200)},t.updatePersonsave=function(){if(t.updatesaveFlag){t.planDetails=[];for(var a=0;a<t.addtopData.length;a++)t.topTemporaryArray[a]={id:t.addtopData[a].id,compensateId:t.addtopData[a].compensateId,Identification:0,extendV1:t.addtopData[a].extendV1,area:t.addtopData[a].area,builtInArea:t.addtopData[a].builtInArea,builtInPeriod:t.addtopData[a].builtInPeriod,replacementRatio:t.addtopData[a].replacementRatio},t.planDetails.push(t.topTemporaryArray[a]);for(var e=0;e<t.addbottomData.length;e++)t.bottomTemporaryArray[e]={id:t.addbottomData[e].id,compensateId:t.addbottomData[e].compensateId,Identification:1,area:1===t.addbottomData[e].status&&1===t.addbottomData[e].isRestricted?t.addbottomData[e].addbottomData?t.addbottomData[e].addbottomData.toString():0:t.addbottomData[e].area?t.addbottomData[e].area.toString():0,compensationAmount:t.addbottomData[e].compensationAmount?t.addbottomData[e].compensationAmount.toString():0,compensatePrice:t.addbottomData[e].compensatePrice?t.addbottomData[e].compensatePrice.toString():0,restrictedArea:1===t.addbottomData[e].status&&1===t.addbottomData[e].isRestricted?t.addbottomData[e].area?t.addbottomData[e].area.toString():0:t.addbottomData[e].restrictedArea?t.addbottomData[e].restrictedArea.toString():0},t.planDetails.push(t.bottomTemporaryArray[e]);o.server().zjupdateCompensationInfodo({planDetails:JSON.stringify(t.planDetails),propertyId:t.roomId,totalMoneyCompensate:t.addTotalMoney,monthlyInterimCompensate:t.addMonthMoney,createUser:p,projectId:t.projectId,remarks:t.remarks},function(a){!0===a.result?(alert(a.message),t.disableds=!0,t.planDetails=[],m(),$(".update").fadeOut(200),$(".updateremarks").fadeOut(200),t.$apply()):alert(a.message)},function(){alert(data.message)}),t.updatesaveFlag=!1,d.timeouts(t.updatesaveFlag,t.timedata,function(a){t.updatesaveFlag=a})}}}]);