angular.module("app").controller("linkOrderCtrl",["$http","$scope","server",function(e,t,l){function o(){l.server().zjrelatedlistdo({roomId:t.roomId},function(e){!0===e.result?(t._data=e.data,t.$apply()):alert(e.message)},function(e){alert(e)})}function a(){l.server().zjroomsearchForConditiondo({projectId:t.projectId},function(e){if(!0===e.result){t.dataCheckbox=e.data;for(var l=0;l<t.dataCheckbox.length;l++)t.dataCheckbox[l].state=!1;t.$apply()}else alert(e.message)})}function r(e,o){t.rows=[],l.server().zjroompropertyListdo({projectId:t.projectId,schemaId:e||"",pageNo:o||1,pageSize:10},function(e){if(!0===e.result){t.rows=e.data.rows;for(var l=0;l<t.rows.length;l++)t.rows[l].state=!1;t.conf.total=Math.ceil(e.data.total/e.data.pageSize),t.conf.counts=e.data.total,t.$apply(),t.$broadcast("categoryLoaded")}else alert(e.message)})}function c(e){l.server().zjrelatedaddSavedo({userId:d,roomId:t.roomId,relatedRoomId:e},function(e){!0===e.result?($(".dialog").hide(200),o(),t.$apply()):alert(e.message)})}t.no="-",t.nothingTips=!1,t.roomId=$state.params.propertyId,t.propertyId=$state.params.propertyId,t.projectId=$state.params.projectid;var d=l.server().userId;l.server().zjprojectdeleteById({id:t.projectId,userId:d},function(e){!0===e.result?(t.project2=e.data.project,t.$apply()):alert(e.message)}),o(),t.dataDelete=function(e,a){confirm("确认删除吗？",function(){l.server().zjrelateddeleteByIddo({id:e},function(e){!0===e.result?(o(),t.$apply()):alert(e.message)})})},t.dataFollowUp=function(e,o){t.genjingId=e,l.server().signListProblem({},function(e){!0===e.result?(t.signListP=e.data,t.$apply()):alert(e.message)}),t.myFunc=function(){t.flag=!1,t.listSecondP="";for(var e=0;e<t.signListP.length;e++)if(t.signListP[e].id==t.myselect){var l=[];l.push(t.signListP[e].stage)}t.listSecondP=l,"[]"!=JSON.stringify(t.listSecondP[0])&&(t.flag=!0)},$(".hopbntshare2").dialog()},t.advice="",t.depict="",t.solution="",t.addInformation=function(e){l.server().addInformation({typeValue:2,dataId:t.roomId,orderSignType:t.myselect,orderSignName:t.myselect2,advice:t.advice,depict:t.depict,solution:t.solution,attachments:null,createUser:d},function(e){!0===e.result?($(".hopbntshare2").fadeOut(200),alert("发布成功"),t.$apply()):alert(e.message)})},t.conf={total:10,currentPage:1,itemPageLimit:10,isSelectPage:!1,isLinkPage:!1},t.$watch("conf.currentPage + conf.itemPageLimit",function(e){r(t.selected.join(","),t.conf.currentPage)}),t.selected=[],t.selectAll=!0,t.updateSelection=function(e,l,o){if(e.target.checked)t.selected.push(l);else{var a=t.selected.indexOf(l);t.selected.splice(a,1)}0===t.selected.length?t.selectAll=!0:t.selectAll=!1,r(t.selected.join(","),t.conf.currentPage)},t.checkobxAll=function(e,l){if(!1===e&&0===t.selected.length&&(t.selectAll=!0),!0===e){t.selected=[];for(var o=0;o<t.dataCheckbox.length;o++)t.dataCheckbox[o].state=!1}r(t.selected.join(","),t.conf.currentPage)},r("",1),t.showBox=function(){"block"==$(".dialog").css("display")&&(a(),r())},t.childSelected=[],t.childSelectAll=!0,t.childCheckobxAll=function(e){if(t.childSelected=[],!0===e)for(var l=0;l<t.rows.length;l++)t.rows[l].state=!0,t.childSelected.push(t.rows[l].id);else{for(var o=0;o<t.rows.length;o++)t.rows[o].state=!1;t.childSelected=[]}return t.childSelected},t.childUpdateSelection=function(e,l,o){if(e.target.checked)t.childSelected.push(l);else{var a=t.childSelected.indexOf(l);t.childSelected.splice(a,1)}t.childSelected.length<t.rows.length?t.childSelectAll=!1:t.childSelectAll=!0},t.save=function(){c(t.childSelected.join(","))}}]);